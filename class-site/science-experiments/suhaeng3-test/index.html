<!-- TEST COPY of suhaeng3/index.html before modularization -->
<!-- 단계별 리팩터링: 초기에는 원본과 동일 기능, 점진적으로 scripts/*.js 모듈로 이전 -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>[TEST] 첫걸음, 마지막 걸음 프로젝트 허브</title>
    <meta name="submission-subject" content="과학탐구실험2" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Nanum+Myeongjo:wght@400;700&display=swap" rel="stylesheet" />
    <style>/* 최소 스타일 유지 (원본 유지) */ body{font-family:'Noto Sans KR','Inter',sans-serif;background:#f3f4f6;} .tab-button-group{display:flex;flex-wrap:wrap;gap:.5rem;background:#e5e7eb;padding:.5rem;border-radius:.75rem;} .tab-button{flex-grow:1;text-align:center;padding:.75rem .5rem;border-radius:.5rem;font-weight:500;color:#4b5563;cursor:pointer;transition:.3s;border:2px solid transparent;} .tab-button.active{background:#fff;color:#4f46e5;font-weight:700;box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);} .tab-content{display:none;} .tab-content.active{display:block;} .report-page{background:#fff;padding:2.5cm 2cm;box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.05);} .report-main-title{font-size:2.25rem;font-weight:700;text-align:center;margin-bottom:1rem;border-bottom:2px solid #111827;padding-bottom:1rem;} .report-section-title{font-size:1.5rem;font-weight:700;margin-top:2.5rem;margin-bottom:1rem;padding-bottom:.5rem;border-bottom:1px solid #d1d5db;} .preview-text{white-space:pre-wrap;word-break:break-word;line-height:1.8;font-family:'Nanum Myeongjo',serif;} .preview-placeholder{color:#9ca3af;font-style:italic;} @page{size:A4 portrait;margin:2cm;} @media print{body *{visibility:hidden}.printable-area,.printable-area *{visibility:visible}.printable-area{position:absolute;left:0;top:0;width:100%;padding:0;margin:0;box-shadow:none;border:none}.no-print{display:none}} </style>
</head>
<body class="p-4 sm:p-8">
    <div class="max-w-5xl mx-auto">
        <header class="text-center bg-white p-8 rounded-xl shadow-lg mb-6 no-print">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">[TEST] 첫걸음, 마지막 걸음 프로젝트</h1>
            <p class="text-lg text-gray-600 mt-2">모듈화 리팩터링 테스트 버전</p>
            <div class="mt-4 flex flex-wrap gap-3 justify-center" id="session_links_wrapper">
                <a id="session1_link" href="./session1.html" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 hidden" aria-disabled="true">1차시 활동</a>
                <a id="session2_link" href="./session2.html" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 hidden" aria-disabled="true">2차시 활동</a>
                <span id="session_locked_notice" class="px-4 py-2 bg-gray-300 text-gray-600 rounded-lg select-none">활동 버튼은 10/13 00:00 공개 예정</span>
            </div>
        </header>
        <div class="mb-8 no-print">
            <div class="tab-button-group" aria-label="Tabs">
                <button class="tab-button active" data-tab="tab1">1. 배경</button>
                <button class="tab-button" data-tab="tab2">2. 문제</button>
                <button class="tab-button" data-tab="tab3">3. 가이드</button>
                <button class="tab-button" data-tab="tab4">4. 활동지</button>
                <button class="tab-button" data-tab="tab5">5. 미리보기</button>
            </div>
        </div>
        <main>
            <div id="tab1" class="tab-content active"><div class="bg-white p-6 rounded-lg shadow">TEST 배경</div></div>
            <div id="tab2" class="tab-content"><div class="bg-white p-6 rounded-lg shadow">TEST 문제</div></div>
            <div id="tab3" class="tab-content"><div class="bg-white p-6 rounded-lg shadow">TEST 가이드</div></div>
            <div id="tab4" class="tab-content"><div class="bg-white p-6 rounded-lg shadow space-y-6">
                <div>
                  <h2 class="text-lg font-bold mb-2">정보출처</h2>
                  <div id="sources_container"></div>
                  <button id="add_source_btn" class="mt-3 px-3 py-2 bg-indigo-600 text-white text-sm rounded hover:bg-indigo-700">출처 추가</button>
                </div>
                <div class="border-t pt-4">
                  <button id="build_report_btn" class="px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700 text-sm">보고서 HTML 생성</button>
                  <button id="download_zip_btn" class="ml-2 px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 text-sm">ZIP 다운로드</button>
                </div>
                <div class="mt-4">
                  <h3 class="font-semibold mb-2">생성 결과 (미리보기)</h3>
                  <iframe id="report_preview_frame" class="w-full border h-72 bg-white"></iframe>
                </div>
            </div></div>
            <div id="tab5" class="tab-content"><div class="bg-white p-6 rounded-lg shadow"><div id="report-content" class="report-page printable-area"><h1 class="report-main-title">[TEST] 보고서</h1><p class="preview-text"><span class="preview-placeholder">내용을 입력하세요...</span></p></div></div></div>
        </main>
    </div>
    <div id="toast-notification" class="fixed bottom-5 right-5 bg-gray-800 text-white py-3 px-5 rounded-lg shadow-lg opacity-0 transition-opacity duration-300 no-print">저장되었습니다!</div>
    <!-- 1단계: 최소 부트스트랩 스크립트 (탭 + 게이트) -->
    <script type="module">
        import { initTabs } from '../modules/dom.js';
        import { initGate } from '../modules/gate.js';
        import { initSources } from '../modules/sources.js';
        import { buildReportHTML } from '../modules/report.js';
        import { createZip } from '../modules/zip.js';

        initTabs();
        initGate({ unlockAt: '2025-10-12T15:00:00Z' });
        const sourcesApi = initSources({ key:'hub_test', containerId:'sources_container', addBtnId:'add_source_btn' });

        const buildBtn = document.getElementById('build_report_btn');
        const zipBtn = document.getElementById('download_zip_btn');
        const frame = document.getElementById('report_preview_frame');

        buildBtn.addEventListener('click', () => {
          const html = buildReportHTML({
            title: '[TEST] 보고서',
            sections: [
              { heading: '예시 섹션', body: '섹션 본문 예시\n두번째 줄' }
            ],
            sources: sourcesApi.getAll()
          });
          const blob = new Blob([html], { type:'text/html' });
          frame.src = URL.createObjectURL(blob);
        });

        zipBtn.addEventListener('click', async () => {
          const sources = sourcesApi.getAll();
            const html = buildReportHTML({
              title: '[TEST] 보고서',
              sections: [ { heading: '예시 섹션', body: 'ZIP 생성 테스트' } ],
              sources
            });
            const blob = await createZip([{ name:'report.html', content: html }]);
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'report_test.zip';
            a.click();
        });
    </script>
</body>
</html>
