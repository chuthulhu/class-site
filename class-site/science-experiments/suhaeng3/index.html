<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²«ê±¸ìŒ, ë§ˆì§€ë§‰ ê±¸ìŒ í”„ë¡œì íŠ¸ í—ˆë¸Œ</title>
    <!-- Submission Subject (easily editable) -->
    <meta name="submission-subject" content="ê³¼í•™íƒêµ¬ì‹¤í—˜2">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ZIP ìƒì„±ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- Google Fonts - Noto Sans KR & Nanum Myeongjo for serif font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Nanum+Myeongjo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        /* --- íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (from index.html) --- */
        .tab-button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem; /* 8px */
            background-color: #e5e7eb; /* gray-200 */
            padding: 0.5rem;
            border-radius: 0.75rem; /* 12px */
        }
        .tab-button {
            flex-grow: 1;
            text-align: center;
            padding: 0.75rem 0.5rem;
            border-radius: 0.5rem; /* 8px */
            font-weight: 500;
            color: #4b5563; /* gray-600 */
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .tab-button:hover {
            background-color: #f9fafb; /* gray-50 */
            color: #1f2937; /* gray-800 */
        }
        .tab-button.active {
            background-color: #ffffff;
            color: #4f46e5; /* indigo-600 */
            font-weight: 700;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* --- Styles from a previous version (ìˆ˜í–‰í‰ê°€3.html) --- */
        .tip-card {
            background: linear-gradient(135deg, #f5f3ff, #eef2ff);
            border-left: 4px solid #6366f1;
        }
        .name-explainer-card {
             background-color: #f0fdf4;
             border-left: 4px solid #22c55e;
             padding: 1.5rem;
             border-radius: 0.5rem;
        }
        .infographic-card {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .step-icon {
            background-color: #4f46e5;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.25rem;
            flex-shrink: 0;
        }
        .accordion-header button.open {
            background-color: #eef2ff;
            color: #4338ca;
        }
        .accordion-content {
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
            max-height: 0;
            overflow: hidden;
        }
        .accordion-content.open {
            max-height: 1500px;
        }
        
        /* í™œë™ì§€ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
        textarea, input[type="text"], select {
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        textarea:focus, input[type="text"]:focus, select:focus {
            border-color: #4f46e5; /* indigo-600 */
            box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
            outline: none;
        }
        
        /* --- ë¯¸ë¦¬ë³´ê¸°(ë¦¬í¬íŠ¸) ìŠ¤íƒ€ì¼ (from index.html) --- */
        .report-page {
            background-color: white;
            padding: 2.5cm 2cm;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            color: #1f2937;
        }
        .report-main-title {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 2.25rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 1rem;
            border-bottom: 2px solid #111827;
            padding-bottom: 1rem;
        }
        .report-section-title {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: #111827;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #d1d5db;
        }
        .preview-text {
            white-space: pre-wrap;
            word-break: break-word;
            min-height: 2.5em;
            line-height: 1.8;
            color: #374151;
            font-family: 'Nanum Myeongjo', serif; /* ë³¸ë¬¸ì€ ëª…ì¡°ì²´ ìœ ì§€ */
        }
        .preview-placeholder {
            color: #9ca3af;
            font-style: italic;
        }
        
        /* ì¸ì‡„ ì„¤ì • */
        @page {
            size: A4 portrait; margin: 2cm;
        }
        @media print {
            body * { visibility: hidden; }
            .printable-area, .printable-area * { visibility: visible; }
            .printable-area {
                position: absolute; left: 0; top: 0;
                width: 100%; padding: 0; margin: 0;
                box-shadow: none; border: none;
            }
            .no-print { display: none; }
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-5xl mx-auto">
        <header class="text-center bg-white p-8 rounded-xl shadow-lg mb-6 no-print">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">ì²«ê±¸ìŒ, ë§ˆì§€ë§‰ ê±¸ìŒ í”„ë¡œì íŠ¸</h1>
            <p class="text-lg text-gray-600 mt-2">S-BRTì™€ ê³µìœ  PM ì—°ê³„ë¥¼ ìœ„í•œ ì¢…í•© ì•ˆë‚´</p>
            <div class="mt-4 flex flex-wrap gap-3 justify-center" id="session_links_wrapper">
                <a id="session1_link" href="./session1.html" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 hidden" aria-disabled="true">1ì°¨ì‹œ í™œë™ (í˜„í™© ë¶„ì„Â·ê³ ë ¤ì‚¬í•­)</a>
                <a id="session2_link" href="./session2.html" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 hidden" aria-disabled="true">2ì°¨ì‹œ í™œë™ (3ê°€ì§€ ì§€ë ›ëŒ€Â·ê¸°ëŒ€íš¨ê³¼)</a>
                <span id="session_locked_notice" class="px-4 py-2 bg-gray-300 text-gray-600 rounded-lg select-none">í™œë™ ë²„íŠ¼ì€ 10/13 00:00 ê³µê°œ ì˜ˆì •</span>
            </div>
        </header>
        
        

        <!-- Tab Navigation (í—ˆë¸Œ: ë°°ê²½/ë¬¸ì œ/ê°€ì´ë“œë§Œ) -->
        <div class="mb-8 no-print">
            <div class="tab-button-group" aria-label="Tabs">
                <button class="tab-button active" data-tab="tab1">1. ë°°ê²½ ë° í˜„í™©</button>
                <button class="tab-button" data-tab="tab2">2. í”„ë¡œì íŠ¸ ë¬¸ì œ</button>
                <button class="tab-button" data-tab="tab3">3. ê³µëµ ê°€ì´ë“œ</button>
            </div>
        </div>

        <!-- Tab Content -->
        <main>
            <!-- Tab 1: ë°°ê²½ ë° í˜„í™© (Content Filled) -->
            <div id="tab1" class="tab-content active">
                <div class="bg-white p-6 sm:p-8 rounded-lg shadow-md space-y-12">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">ğŸ¤” í˜¹ì‹œ, ë‹¹ì‹ ì˜ ë“±í•˜êµ£ê¸¸ì€ ì–´ë–¤ê°€ìš”?</h2>
                        <div class="bg-indigo-50 border-l-4 border-indigo-400 p-6 rounded-lg space-y-3 text-gray-700">
                            <p>"ì•„ì¹¨ì— ë²„ìŠ¤ íƒ€ëŸ¬ ê°€ëŠ”ë°, ì¸ë„ í•œê°€ìš´ë° í‚¥ë³´ë“œê°€ ë„˜ì–´ì ¸ ìˆì–´ì„œ ì§œì¦ ë‚¬ë˜ ì ."</p>
                            <p>"ë²„ìŠ¤ë¥¼ ê¸°ë‹¤ë¦¬ëŠ”ë°, ì •ë¥˜ì¥ ì•ì— í‚¥ë³´ë“œê°€ ì—¬ëŸ¬ ëŒ€ ë„ë ¤ ìˆì–´ì„œ íƒ€ê¸° ë¶ˆí¸í–ˆë˜ ì ."</p>
                            <p>"í•™ì› ê°ˆ ë•Œ í‚¥ë³´ë“œ íƒ€ê³  S-BRT ì •ë¥˜ì¥ê¹Œì§€ ê°€ë©´ í¸í•  ê²ƒ ê°™ì€ë°, ë§‰ìƒ íƒ€ë ¤ê³  í•˜ë©´ ê·¼ì²˜ì— ì—†ê±°ë‚˜ ë°°í„°ë¦¬ê°€ ì—†ì–´ì„œ í¬ê¸°í•œ ì ."</p>
                            <p class="pt-2 font-semibold">ì´ëŸ° ê²½í—˜, í•œ ë²ˆì¯¤ ìˆì§€ ì•Šë‚˜ìš”? ì´ ì‘ì€ ë¶ˆí¸í•¨ë“¤ì´ ë°”ë¡œ ìš°ë¦¬ê°€ í•´ê²°í•˜ë ¤ëŠ” ë„ì‹œ ë¬¸ì œì˜ ì‹œì‘ì…ë‹ˆë‹¤.</p>
                        </div>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">S-BRT: ë¹›ê³¼ ê·¸ë¦¼ì</h2>
                        <p class="text-gray-600 mb-6">ì°½ì› S-BRTëŠ” ëŒ€ì¤‘êµí†µì˜ íš¨ìœ¨ì„ ë†’ì˜€ì§€ë§Œ, ìƒˆë¡œìš´ ë¬¸ì œë„ ë‚³ì•˜ìŠµë‹ˆë‹¤. ê·¸ ì„±ê³¼ë¥¼ ì¸í¬ê·¸ë˜í”½ìœ¼ë¡œ ì‚´í´ë´…ì‹œë‹¤.</p>
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <div class="relative flex items-end justify-center">
                                <div class="w-1/2 pr-4 text-center">
                                    <h3 class="text-lg font-bold text-blue-600">ê¸ì •ì  íš¨ê³¼ (ë¹›) â¬†ï¸</h3>
                                    <div class="mt-4 space-y-3">
                                        <div class="bg-blue-100 p-3 rounded-lg"><p class="text-2xl">ğŸšŒ</p><p class="font-semibold text-blue-800">ë²„ìŠ¤ í†µí–‰ì‹œê°„ ë‹¨ì¶•</p><p class="text-xl font-bold text-blue-600">-5ë¶„ 58ì´ˆ</p></div>
                                        <div class="bg-blue-100 p-3 rounded-lg"><p class="text-2xl">ğŸ“ˆ</p><p class="font-semibold text-blue-800">ë²„ìŠ¤ ì´ìš©ê° ì¦ê°€</p><p class="text-xl font-bold text-blue-600">+16.2%</p></div>
                                    </div>
                                </div>
                                <div class="w-1/2 pl-4 text-center transform -translate-y-10">
                                    <h3 class="text-lg font-bold text-red-600">ë¶€ì •ì  íš¨ê³¼ (ê·¸ë¦¼ì) â¬‡ï¸</h3>
                                    <div class="mt-4">
                                        <div class="bg-red-100 p-3 rounded-lg"><p class="text-2xl">ğŸš—</p><p class="font-semibold text-red-800">ìŠ¹ìš©ì°¨ í†µí–‰ì‹œê°„ ì¦ê°€</p><p class="text-xl font-bold text-red-600">+6ë¶„ 12ì´ˆ</p></div>
                                    </div>
                                </div>
                            </div>
                            <div class="h-2 bg-gray-400 rounded-full transform -skew-y-3"></div>
                            <div class="w-0 h-0 border-l-[25px] border-l-transparent border-r-[25px] border-r-transparent border-b-[43.3px] border-b-gray-500 mx-auto"></div>
                            <p class="text-center text-sm text-gray-600 mt-4">S-BRT ë„ì…ìœ¼ë¡œ ë²„ìŠ¤ëŠ” ë¹¨ë¼ì¡Œì§€ë§Œ, ê·¸ë§Œí¼ ìŠ¹ìš©ì°¨ëŠ” ëŠë ¤ì§€ëŠ” <strong>'í’ì„  íš¨ê³¼'</strong>ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í•œìª½ì„ ëˆ„ë¥´ë©´ ë‹¤ë¥¸ ìª½ì´ ë¶€í’€ì–´ ì˜¤ë¥´ëŠ” ê²ƒì²˜ëŸ¼, ë„ë¡œ ê³µê°„ì˜ ë³€í™”ê°€ ì„œë¡œ ë‹¤ë¥¸ ì˜í–¥ì„ ë¯¸ì¹œ ê²ƒì…ë‹ˆë‹¤.</p>
                        </div>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">ê³µìœ  PM: í¸ë¦¬í•¨ ì† ë¬´ì§ˆì„œ</h2>
                        <p class="text-gray-600 mb-6">ê³µìœ  í‚¥ë³´ë“œì™€ ìì „ê±°ëŠ” ë‹¨ê±°ë¦¬ ì´ë™ì„ í¸ë¦¬í•˜ê²Œ ë§Œë“¤ì—ˆì§€ë§Œ, ë¬´ë¶„ë³„í•œ ì£¼ì°¨ ë¬¸ì œë¼ëŠ” ê·¸ë¦¼ìë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="infographic-card"><span class="text-5xl mb-3">âœ…</span><h3 class="text-lg font-bold text-gray-800">ê¸°íšŒ: ìœ ì—°í•œ ì´ë™ì„±</h3><p class="text-gray-600 mt-2">ì•±ìœ¼ë¡œ ê°„í¸í•˜ê²Œ ëŒ€ì—¬/ë°˜ë‚©í•˜ë©°, ë²„ìŠ¤ê°€ ë‹¿ì§€ ì•ŠëŠ” ê³³ê¹Œì§€ ì—°ê²°í•˜ëŠ” í¸ë¦¬í•¨ì„ ì œê³µí•©ë‹ˆë‹¤.</p></div>
                            <div class="infographic-card"><span class="text-5xl mb-3">âš ï¸</span><h3 class="text-lg font-bold text-gray-800">ìœ„ê¸°: ë„ì‹œì˜ ë¬´ì§ˆì„œ</h3><p class="text-gray-600 mt-2">ë³´ë„, ê±´ë¬¼ ì…êµ¬ ë“±ì— ë¬´ì§ˆì„œí•˜ê²Œ ë°©ì¹˜ë˜ì–´ ë³´í–‰ ì•ˆì „ì„ ìœ„í˜‘í•˜ê³  ë„ì‹œ ë¯¸ê´€ì„ í•´ì¹©ë‹ˆë‹¤.</p></div>
                        </div>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">ë¬¸ì œì˜ ë³¸ì§ˆ: ëŠì–´ì§„ 'ì²«ê±¸ìŒ'ê³¼ 'ë§ˆì§€ë§‰ ê±¸ìŒ'</h2>
                        <p class="text-gray-600 mb-6">ëŒ€ì¤‘êµí†µì˜ ì§„ì •í•œ ì„±ê³µì€ 'ë¬¸ ì•ì—ì„œ ë¬¸ ì•ê¹Œì§€(Door-to-Door)'ì˜ ì—¬ì •ì´ ì–¼ë§ˆë‚˜ í¸ë¦¬í•œê°€ì— ë‹¬ë ¤ìˆìŠµë‹ˆë‹¤. ì§‘ì—ì„œ ë‚˜ì™€ ë²„ìŠ¤ ì •ë¥˜ì¥ê¹Œì§€ ê°€ëŠ” <strong>'ì²«ê±¸ìŒ(First Mile)'</strong>ê³¼, ì •ë¥˜ì¥ì—ì„œ ë‚´ë ¤ ìµœì¢… ëª©ì ì§€ê¹Œì§€ ê°€ëŠ” <strong>'ë§ˆì§€ë§‰ ê±¸ìŒ(Last Mile)'</strong>ì´ ë°”ë¡œ ê·¸ í•µì‹¬ì…ë‹ˆë‹¤. S-BRTëŠ” ê°„ì„ ë„ë¡œ êµ¬ê°„ì˜ ì´ë™ ì‹œê°„ì€ ë‹¨ì¶•í–ˆì§€ë§Œ, ì´ 'ì²«ê±¸ìŒ'ê³¼ 'ë§ˆì§€ë§‰ ê±¸ìŒ'ì˜ ë¶ˆí¸í•¨ì€ í•´ê²°í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë°”ë¡œ ì´ ëŠì–´ì§„ ì—°ê²°ê³ ë¦¬ê°€ ì‹œë¯¼ë“¤ì´ ìê°€ìš©ì˜ ìœ í˜¹ì„ ë¿Œë¦¬ì¹˜ì§€ ëª»í•˜ëŠ” ê°€ì¥ í° ì´ìœ ì…ë‹ˆë‹¤.</p>
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h3 class="text-lg font-semibold text-center text-gray-800 mb-4">í•˜ë‚˜ì˜ ì™„ì „í•œ ì—¬ì •: First Mile to Last Mile</h3>
                            <div class="flex items-center justify-between text-center text-xs sm:text-sm">
                                <div class="flex flex-col items-center w-1/5"><span class="text-4xl">ğŸ </span><p class="font-bold mt-1">ì§‘</p></div>
                                <div class="flex-1 text-gray-400">â€¢â€¢â€¢<p class="font-semibold text-blue-600">ì²«ê±¸ìŒ</p>â€¢â€¢â€¢</div>
                                <div class="flex flex-col items-center w-1/5"><span class="text-4xl">ğŸ›´</span><p class="font-bold mt-1">ê³µìœ PM</p></div>
                                <div class="flex-1 text-red-500 font-bold text-lg">X</div>
                                <div class="flex flex-col items-center w-1/5"><span class="text-4xl">ğŸš</span><p class="font-bold mt-1">S-BRT</p></div>
                                <div class="flex-1 text-red-500 font-bold text-lg">X</div>
                                <div class="flex flex-col items-center w-1/5"><span class="text-4xl">ğŸ›´</span><p class="font-bold mt-1">ê³µìœ PM</p></div>
                                <div class="flex-1 text-gray-400">â€¢â€¢â€¢<p class="font-semibold text-green-600">ë§ˆì§€ë§‰ ê±¸ìŒ</p>â€¢â€¢â€¢</div>
                                <div class="flex flex-col items-center w-1/5"><span class="text-4xl">ğŸ¢</span><p class="font-bold mt-1">ëª©ì ì§€</p></div>
                            </div>
                             <p class="text-center text-red-600 font-semibold mt-4">í˜„ì¬ ê³µìœ  PMê³¼ S-BRTì˜ ì—°ê³„ê°€ ëŠì–´ì ¸, ì‹œë¯¼ë“¤ì˜ ì—¬ì •ì€ ë¶ˆí¸í•˜ê³  ë„ì‹œëŠ” ë¬´ì§ˆì„œí•´ì§€ê³  ìˆìŠµë‹ˆë‹¤.<br> ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ê²ƒì´ ìš°ë¦¬ í”„ë¡œì íŠ¸ì˜ í•µì‹¬ì…ë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 2: í”„ë¡œì íŠ¸ ë¬¸ì œ ì œì‹œ (Content Filled) -->
            <div id="tab2" class="tab-content">
                <div class="bg-white p-6 sm:p-8 rounded-lg shadow-md space-y-12">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">í”„ë¡œì íŠ¸ ê°œìš”: ë„ì‹œêµí†µ ì»¨ì„¤í„´íŠ¸ ë˜ê¸°</h2>
                        <p class="text-gray-700 mt-2">ì—¬ëŸ¬ë¶„ì€ ì°½ì›ì‹œì˜ ë„ì‹œêµí†µ ì»¨ì„¤í„´íŠ¸ê°€ ë˜ì–´, 'S-BRTì™€ ê³µìœ  PMì˜ ë‹¨ì ˆ'ì´ë¼ëŠ” ì‹¤ì œ ë„ì‹œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ì°½ì˜ì ì¸ ì•„ì´ë””ì–´ ì œì•ˆì„œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.</p>
                    </div>
                    <div class="name-explainer-card">
                        <h3 class="font-bold text-lg text-green-800 mb-2">ğŸ’¡ í”„ë¡œì íŠ¸ ì´ë¦„: ì²«ê±¸ìŒ, ë§ˆì§€ë§‰ ê±¸ìŒ</h3>
                        <p class="text-green-700">ì´ ì´ë¦„ì€ êµí†µ ë¶„ì•¼ì˜ ì¤‘ìš” ê°œë…ì¸ <strong>'í¼ìŠ¤íŠ¸ ë§ˆì¼, ë¼ìŠ¤íŠ¸ ë§ˆì¼(First Mile, Last Mile)'</strong>ì—ì„œ ì˜ê°ì„ ì–»ì—ˆìŠµë‹ˆë‹¤. ì§‘ì—ì„œ ë‚˜ì™€ ëŒ€ì¤‘êµí†µì„ íƒ€ê¸°ê¹Œì§€ì˜ ì—¬ì •(<strong>ì²«ê±¸ìŒ</strong>)ê³¼, ëŒ€ì¤‘êµí†µì—ì„œ ë‚´ë ¤ ìµœì¢… ëª©ì ì§€ê¹Œì§€ ê°€ëŠ” ì—¬ì •(<strong>ë§ˆì§€ë§‰ ê±¸ìŒ</strong>)ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ í”„ë¡œì íŠ¸ì˜ ëª©í‘œëŠ” ë°”ë¡œ ì´ 'ì²«ê±¸ìŒê³¼ ë§ˆì§€ë§‰ ê±¸ìŒ'ì„ ê³µìœ  PMê³¼ ì—°ê³„í•˜ì—¬ ì™„ë²½í•˜ê³  í¸ë¦¬í•œ ì´ë™ ê²½í—˜ìœ¼ë¡œ ë§Œë“œëŠ” ê²ƒì…ë‹ˆë‹¤.</p>
                    </div>
                    
                    <div class="space-y-6">
                        <h3 class="text-xl font-bold text-indigo-700 border-b-2 border-indigo-200 pb-3">í”„ë¡œì íŠ¸ ê³¼ì œ: ìŠ¤ë§ˆíŠ¸ ëª¨ë¹Œë¦¬í‹° í—ˆë¸Œ ì•„ì´ë””ì–´ ì œì•ˆ</h3>
                        <p class="text-gray-600">
                            <strong>ê³¼ì œ ëª©í‘œ:</strong> 'ìŠ¤ë§ˆíŠ¸ ëª¨ë¹Œë¦¬í‹° í—ˆë¸Œ' ì‹œë²”ì‚¬ì—…ì„ ì„±ê³µì‹œí‚¤ê¸° ìœ„í•´, <strong>í˜„ì‹¤ì ì¸ ë¬¸ì œ ìƒí™©ì„ ë¶„ì„</strong>í•˜ê³ , <strong>'ëŒ€ìƒì§€ ì„ ì •ì„ ìœ„í•œ ê³ ë ¤ì‚¬í•­'</strong>ì„ 2ê°€ì§€ ì´ìƒ ì œì•ˆí•˜ë©°, ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ êµ¬ì²´ì ì¸ ì†”ë£¨ì…˜ê³¼ ê¸°ëŒ€íš¨ê³¼ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
                        </p>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-center mt-4">
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <span class="text-4xl">ğŸ“Š</span>
                                <h4 class="font-bold mt-2">1. í˜„í™© ë¶„ì„</h4>
                                <p class="text-sm text-gray-600 mt-1">ë¬¸ì œì˜ ì‹¬ê°ì„±ê³¼ ì¤‘ìš”ì„±ì„ íŒŒì•…í•˜ì—¬ ì •ë¦¬í•©ë‹ˆë‹¤.</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <span class="text-4xl">ğŸ¤”</span>
                                <h4 class="font-bold mt-2">2. ì„ ì • ê¸°ì¤€ ì œì‹œ</h4>
                                <p class="text-sm text-gray-600 mt-1">ì–´ë–¤ ê³³ì— í—ˆë¸Œë¥¼ ì„¤ì¹˜í•´ì•¼ ì„±ê³µí• ì§€, ê·¸ ê¸°ì¤€ì„ ì œì‹œí•©ë‹ˆë‹¤.</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <span class="text-4xl">ğŸ’¡</span>
                                <h4 class="font-bold mt-2">3. ì†”ë£¨ì…˜ ì œì•ˆ</h4>
                                <p class="text-sm text-gray-600 mt-1">'3ê°€ì§€ ì§€ë ›ëŒ€'ë¥¼ í™œìš©í•´ êµ¬ì²´ì ì¸ ì•„ì´ë””ì–´ë¥¼ ì œì‹œí•©ë‹ˆë‹¤.</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <span class="text-4xl">ğŸ“ˆ</span>
                                <h4 class="font-bold mt-2">4. ê¸°ëŒ€ íš¨ê³¼ ì‘ì„±</h4>
                                <p class="text-sm text-gray-600 mt-1">ì•„ì´ë””ì–´ê°€ ì‹¤í˜„ë˜ì—ˆì„ ë•Œì˜ ê¸ì •ì  ë³€í™”ë¥¼ ì˜ˆì¸¡í•©ë‹ˆë‹¤.</p>
                            </div>
                        </div>
                         <div class="text-center mt-6"><p class="font-semibold text-gray-800"><strong>ìµœì¢… ê²°ê³¼ë¬¼:</strong> 'ìŠ¤ë§ˆíŠ¸ ëª¨ë¹Œë¦¬í‹° í—ˆë¸Œ ì•„ì´ë””ì–´ ì œì•ˆì„œ'</p></div>
                    </div>
                </div>
            </div>

            <!-- Tab 3: í”„ë¡œì íŠ¸ ê³µëµ ê°€ì´ë“œ (Content Filled) -->
            <div id="tab3" class="tab-content">
                <div class="bg-white p-6 sm:p-8 rounded-lg shadow-md">
                    <section>
                        <h2 class="text-2xl font-bold text-indigo-700 mb-4 flex items-center">
                            <span class="step-icon mr-3">ğŸš€</span>
                            ì•„ì´ë””ì–´ ì œì•ˆì„œ ì‘ì„± ê°€ì´ë“œ
                        </h2>
                        <div class="bg-white p-6 rounded-lg shadow-sm space-y-4">
                            <p class="text-gray-700">ì´ í”„ë¡œì íŠ¸ì˜ í•µì‹¬ì€ ì •í•´ì§„ ë‹µì„ ì°¾ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ì—¬ëŸ¬ë¶„ì˜ ì°½ì˜ì ì¸ ìƒê°ê³¼ ë…¼ë¦¬ë¥¼ ììœ ë¡­ê²Œ í¼ì¹˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì•„ë˜ ê°€ì´ë“œë¥¼ ì°¸ê³ í•˜ì—¬ ë©‹ì§„ ì•„ì´ë””ì–´ë¥¼ êµ¬ì²´í™”í•´ ë³´ì„¸ìš”.</p>
                            
                            <div class="accordion-item border-t pt-4">
                                <div class="accordion-header"><button class="w-full text-left p-4 rounded-lg font-semibold text-lg text-gray-800 hover:bg-gray-100 flex justify-between items-center"><span>ğŸ“Š 1. 'í˜„í™© ë¶„ì„'ì€ ì–´ë–»ê²Œ í• ê¹Œ?</span><svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button></div>
                                <div class="accordion-content"><div class="p-4 text-gray-600 space-y-3">
                                    <p>ì¢‹ì€ í•´ê²°ì±…ì€ ì •í™•í•œ ë¬¸ì œ ì¸ì‹ì—ì„œ ì‹œì‘ë©ë‹ˆë‹¤. ì™œ ì§€ê¸ˆ S-BRTì™€ ê³µìœ  PMì˜ ì—°ê³„ê°€ ì¤‘ìš”í•œ ë¬¸ì œì¸ì§€, ìµœì‹  ë‰´ìŠ¤ ê¸°ì‚¬ë‚˜ ìë£Œë¥¼ ì°¸ê³ í•˜ì—¬ ìì‹ ì˜ ì–¸ì–´ë¡œ ì •ë¦¬í•´ë³´ì„¸ìš”.</p>
                                    <div class="tip-card p-4 rounded-lg">
                                        <h4 class="font-bold text-indigo-800">ìƒê°ì„ ë„“íˆëŠ” ì§ˆë¬¸</h4>
                                        <ul class="list-disc list-inside mt-2 text-sm">
                                            <li>ìµœê·¼ ì°½ì›ì‹œ S-BRTë‚˜ ê³µìœ  PMê³¼ ê´€ë ¨í•˜ì—¬ ì–´ë–¤ ë‰´ìŠ¤ë“¤ì´ ìˆì—ˆë‚˜ìš”?</li>
                                            <li>ì‹œë¯¼ë“¤ì€ ì´ ë¬¸ì œì— ëŒ€í•´ ì–´ë–¤ ë¶ˆí¸ì„ ê²ªê³  ìˆì„ê¹Œìš”?</li>
                                            <li>ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ì§€ ì•Šìœ¼ë©´ ë¯¸ë˜ì— ì–´ë–¤ ë” í° ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆì„ê¹Œìš”?</li>
                                        </ul>
                                    </div>
                                </div></div>
                            </div>

                            <div class="accordion-item border-t pt-4">
                                <div class="accordion-header"><button class="w-full text-left p-4 rounded-lg font-semibold text-lg text-gray-800 hover:bg-gray-100 flex justify-between items-center"><span>ğŸ¤” 2. 'ëŒ€ìƒì§€ ì„ ì •ì„ ìœ„í•œ ê³ ë ¤ì‚¬í•­'ì€ ì–´ë–»ê²Œ ì •í• ê¹Œ?</span><svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button></div>
                                <div class="accordion-content"><div class="p-4 text-gray-600 space-y-3">
                                    <p>ë§Œì•½ ì—¬ëŸ¬ë¶„ì´ ì°½ì›ì‹œì¥ì´ë¼ë©´, í•œì •ëœ ì˜ˆì‚°ìœ¼ë¡œ 'ìŠ¤ë§ˆíŠ¸ ëª¨ë¹Œë¦¬í‹° í—ˆë¸Œ'ë¥¼ ë”± í•œ ê³³ì—ë§Œ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤. ì–´ë–¤ ê¸°ì¤€ìœ¼ë¡œ ê·¸ ì¥ì†Œë¥¼ ê³¨ë¼ì•¼ ì‹œë²”ì‚¬ì—…ì´ ì„±ê³µí•˜ê³ , ì‹œë¯¼ë“¤ì—ê²Œ ê°€ì¥ í° ë„ì›€ì´ ë ê¹Œìš”? ê·¸ ê¸°ì¤€ì„ ì •í•˜ëŠ” ê²ƒì´ ì´ë²ˆ í™œë™ì˜ í•µì‹¬ì…ë‹ˆë‹¤.</p>
                                    <div class="tip-card p-4 rounded-lg">
                                        <h4 class="font-bold text-indigo-800">ìƒê°ì„ ë„“íˆëŠ” ì§ˆë¬¸</h4>
                                        <ul class="list-disc list-inside mt-2 text-sm">
                                            <li>ëˆ„ê°€ í—ˆë¸Œë¥¼ ê°€ì¥ ë§ì´ ì´ìš©í• ê¹Œìš”? (í•™ìƒ, ì§ì¥ì¸, ì£¼ë¯¼ ë“±)</li>
                                            <li>ì–´ë–¤ ë¬¸ì œë¥¼ ê°€ì¥ ì‹œê¸‰í•˜ê²Œ í•´ê²°í•´ì•¼ í• ê¹Œìš”? (ì•ˆì „, ë¶ˆí¸, ë„ì‹œ ë¯¸ê´€ ë“±)</li>
                                            <li>ì–´ë””ì— ì„¤ì¹˜í•´ì•¼ ëˆˆì— ì˜ ë„ê³  ë” ë§ì€ ì‚¬ëŒì´ ì´ìš©í•  ìˆ˜ ìˆì„ê¹Œìš”?</li>
                                        </ul>
                                    </div>
                                </div></div>
                            </div>

                            <div class="accordion-item border-t pt-4">
                                <div class="accordion-header"><button class="w-full text-left p-4 rounded-lg font-semibold text-lg text-gray-800 hover:bg-gray-100 flex justify-between items-center"><span>ğŸ’¡ 3. '3ê°€ì§€ ì§€ë ›ëŒ€' ì•„ì´ë””ì–´ ë‚´ê¸°</span><svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button></div>
                                <div class="accordion-content"><div class="p-4 text-gray-600 space-y-4">
                                    <p>í•˜ë‚˜ì˜ ì¢‹ì€ ì•„ì´ë””ì–´ëŠ” ì—¬ëŸ¬ ìš”ì†Œê°€ ê²°í•©ë˜ì—ˆì„ ë•Œ ë‚˜ì˜µë‹ˆë‹¤. 'ê³µê°„', 'í˜œíƒ', 'í˜‘ë ¥'ì´ë¼ëŠ” 3ê°€ì§€ ê´€ì ì—ì„œ ì•„ì´ë””ì–´ë¥¼ ììœ ë¡­ê²Œ ìƒìƒí•´ë³´ì„¸ìš”.</p>
                                    <p><strong>ğŸ›ï¸ ë¬¼ë¦¬ì  ì¸í”„ë¼ (ê³µê°„):</strong> "ì˜ˆìœ ë””ìì¸ì˜ ë¹„ê°€ë¦¼ë§‰ê³¼ ìŠ¤ë§ˆíŠ¸í° ì¶©ì „ê¸°ë¥¼ ì„¤ì¹˜í•˜ì!", "CCTVì™€ ì¡°ëª…ì„ ì„¤ì¹˜í•´ì„œ ë°¤ì—ë„ ì•ˆì „í•˜ê²Œ ë§Œë“¤ì!"</p>
                                    <p><strong>ğŸ’¡ ë””ì§€í„¸/ì •ì±… (í˜œíƒ):</strong> "í—ˆë¸Œì— ì£¼ì°¨í•˜ë©´ í‚¥ë³´ë“œ ìš”ê¸ˆì„ í• ì¸í•´ì£¼ì!", "S-BRTë¡œ í™˜ìŠ¹í•˜ë©´ ì¶”ê°€ í¬ì¸íŠ¸ë¥¼ ì£¼ëŠ” ì•±ì„ ë§Œë“¤ì!"</p>
                                    <p><strong>ğŸ¤ ìš´ì˜ ëª¨ë¸ (í˜‘ë ¥):</strong> "ì°½ì›ì‹œ, í‚¥ë³´ë“œ íšŒì‚¬, ë²„ìŠ¤ íšŒì‚¬ê°€ í•¨ê»˜ ìš´ì˜ ë¹„ìš©ì„ ë¶€ë‹´í•˜ì!", "í—ˆë¸Œ ì£¼ë³€ ì¹´í˜ì™€ ì œíœ´í•´ì„œ í• ì¸ ì¿ í°ì„ ì£¼ì!"</p>
                                </div></div>
                            </div>

                            <div class="accordion-item border-t pt-4">
                                <div class="accordion-header"><button class="w-full text-left p-4 rounded-lg font-semibold text-lg text-gray-800 hover:bg-gray-100 flex justify-between items-center"><span>ğŸ“ˆ 4. ê¸°ëŒ€ íš¨ê³¼, ì–´ë–»ê²Œ ì“¸ê¹Œ?</span><svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button></div>
                                <div class="accordion-content"><div class="p-4 text-gray-600 space-y-3">
                                    <p>ì—¬ëŸ¬ë¶„ì˜ ì•„ì´ë””ì–´ê°€ ë§Œë“¤ì–´ ë‚¼ ê¸ì •ì ì¸ ë¯¸ë˜ë¥¼ ìƒìƒí•´ì„œ ì ì–´ë³´ì„¸ìš”. ê±°ì°½í•˜ì§€ ì•Šì•„ë„ ê´œì°®ì•„ìš”. êµ¬ì²´ì ì¸ ëª¨ìŠµì„ ê·¸ë ¤ë³´ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.</p>
                                     <div class="tip-card p-4 rounded-lg">
                                        <h4 class="font-bold text-indigo-800">ìƒê°ì„ ë„“íˆëŠ” ì§ˆë¬¸</h4>
                                        <ul class="list-disc list-inside mt-2 text-sm">
                                            <li>ì—¬ëŸ¬ë¶„ì˜ ì•„ì´ë””ì–´ê°€ ì‹¤í˜„ë˜ë©´ ëˆ„ê°€ ê°€ì¥ ì¢‹ì•„í• ê¹Œìš”?</li>
                                            <li>ë„ì‹œì˜ ëª¨ìŠµì€ ì–´ë–»ê²Œ ë°”ë€”ê¹Œìš”? (ì˜ˆ: ê¹¨ë—í•´ì§„ë‹¤, í™œê¸°ì°¨ì§„ë‹¤ ë“±)</li>
                                            <li>ì‚¬ëŒë“¤ì˜ ìƒí™œì€ ì–´ë–»ê²Œ ë” í¸ë¦¬í•´ì§ˆê¹Œìš”?</li>
                                        </ul>
                                    </div>
                                </div></div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- Tab 4: í”„ë¡œì íŠ¸ í™œë™ì§€ -->
            <div id="tab4" class="tab-content">
                <div class="bg-white p-6 sm:p-10 rounded-lg shadow-md space-y-8">
                    <header class="text-center mb-10">
                        <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">ìŠ¤ë§ˆíŠ¸ ëª¨ë¹Œë¦¬í‹° í—ˆë¸Œ ì•„ì´ë””ì–´ ì œì•ˆì„œ</h1>
                        <p class="text-lg text-gray-600 mt-2">ì²«ê±¸ìŒ, ë§ˆì§€ë§‰ ê±¸ìŒ í”„ë¡œì íŠ¸ í™œë™ì§€</p>
                    </header>
                    
                    <section>
                        <h2 class="text-2xl font-bold text-indigo-700 mb-4">1. í˜„í™© ë¶„ì„ ë° ë¬¸ì œ ì¸ì‹</h2>
                        <div>
                            <label for="field_analysis" class="font-semibold text-gray-700 block mb-2">S-BRTì™€ ê³µìœ  PM ì—°ê³„ ë¬¸ì œì˜ í˜„í™©ê³¼ ì¤‘ìš”ì„±</label>
                            <textarea id="field_analysis" rows="6" placeholder="ìµœì‹  ë‰´ìŠ¤ë‚˜ ìë£Œë¥¼ ì°¸ê³ í•˜ì—¬, í˜„ì¬ ì°½ì›ì‹œì˜ S-BRTì™€ ê³µìœ  PM ì—°ê³„ ë¬¸ì œê°€ ì™œ ì¤‘ìš”í•˜ê³  ì‹œê¸‰í•œì§€ ìì‹ ì˜ ì–¸ì–´ë¡œ ë¶„ì„í•˜ì—¬ ì‘ì„±í•´ë³´ì„¸ìš”." class="w-full p-3 border border-gray-300 rounded-md"></textarea>
                        </div>
                    </section>

                    <section>
                        <h2 class="text-2xl font-bold text-indigo-700 mb-4">2. ì‹œë²”ì‚¬ì—… ëŒ€ìƒì§€ ì„ ì •ì„ ìœ„í•œ ê³ ë ¤ì‚¬í•­</h2>
                        <p class="text-gray-600 mb-6">ìŠ¤ë§ˆíŠ¸ ëª¨ë¹Œë¦¬í‹° í—ˆë¸Œ ì‹œë²”ì‚¬ì—…ì„ ì„±ê³µì‹œí‚¤ê¸° ìœ„í•´, ì–´ë–¤ ê¸°ì¤€ìœ¼ë¡œ ëŒ€ìƒì§€ë¥¼ ì„ ì •í•´ì•¼ í• ì§€ <strong>2ê°€ì§€ ì´ìƒì˜ ê³ ë ¤ì‚¬í•­</strong>ê³¼ ê·¸ ì´ìœ ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.</p>
                        <div class="space-y-6">
                             <div>
                                <label for="field_c1_title" class="font-semibold text-gray-700 block mb-2">ê³ ë ¤ì‚¬í•­ 1</label>
                                <input type="text" id="field_c1_title" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì²« ë²ˆì§¸ ê¸°ì¤€ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.">
                                <textarea id="field_c1_desc" rows="4" placeholder="ì™œ ì´ ê¸°ì¤€ì´ ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•˜ë‚˜ìš”? êµ¬ì²´ì ì¸ ì´ìœ ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”." class="w-full p-3 mt-2 border border-gray-300 rounded-md"></textarea>
                            </div>
                            <div>
                                <label for="field_c2_title" class="font-semibold text-gray-700 block mb-2">ê³ ë ¤ì‚¬í•­ 2</label>
                                <input type="text" id="field_c2_title" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ë‘ ë²ˆì§¸ ê¸°ì¤€ì„ í•œ ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.">
                                <textarea id="field_c2_desc" rows="4" placeholder="ì™œ ì´ ê¸°ì¤€ì´ ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•˜ë‚˜ìš”? êµ¬ì²´ì ì¸ ì´ìœ ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”." class="w-full p-3 mt-2 border border-gray-300 rounded-md"></textarea>
                            </div>
                        </div>
                    </section>
            
                    <section>
                        <h2 class="text-2xl font-bold text-indigo-700 mb-4">3. ìŠ¤ë§ˆíŠ¸ ëª¨ë¹Œë¦¬í‹° í—ˆë¸Œ ì•„ì´ë””ì–´ (3ê°€ì§€ ì§€ë ›ëŒ€)</h2>
                        <div class="space-y-6">
                            <div>
                                <label for="field_idea_infra" class="font-semibold text-gray-700 block mb-2">ğŸ›ï¸ ë¬¼ë¦¬ì  ì¸í”„ë¼ (ê³µê°„)</label>
                                <textarea id="field_idea_infra" rows="5" placeholder="ì•ˆì „í•˜ê³  í¸ë¦¬í•˜ë©° ë§¤ë ¥ì ì¸ 'ê³µê°„'ì„ ë§Œë“¤ê¸° ìœ„í•œ ì•„ì´ë””ì–´ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”. (ì˜ˆ: ë””ìì¸, í¸ì˜ì‹œì„¤, ì•ˆì „ì¥ì¹˜ ë“±)" class="w-full p-3 border border-gray-300 rounded-md"></textarea>
                            </div>
                            <div>
                                <label for="field_idea_policy" class="font-semibold text-gray-700 block mb-2">ğŸ’¡ ë””ì§€í„¸/ì •ì±… (í˜œíƒ)</label>
                                <textarea id="field_idea_policy" rows="5" placeholder="ì‚¬ëŒë“¤ì´ í—ˆë¸Œë¥¼ 'ìë°œì ìœ¼ë¡œ' ì´ìš©í•˜ê²Œ ë§Œë“¤ ì•„ì´ë””ì–´ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”. (ì˜ˆ: ìš”ê¸ˆ í• ì¸, í¬ì¸íŠ¸, ì•± ì—°ë™, ì£¼ì°¨ ê·œì¹™ ë“±)" class="w-full p-3 border border-gray-300 rounded-md"></textarea>
                            </div>
                            <div>
                                <label for="field_idea_operation" class="font-semibold text-gray-700 block mb-2">ğŸ¤ ìš´ì˜ ëª¨ë¸ (í˜‘ë ¥)</label>
                                <textarea id="field_idea_operation" rows="5" placeholder="ì´ í—ˆë¸Œë¥¼ 'ì§€ì†ê°€ëŠ¥í•˜ê²Œ' ìš´ì˜í•˜ê¸° ìœ„í•œ ì•„ì´ë””ì–´ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”. (ì˜ˆ: ì‹œ/ê¸°ì—… ì—­í•  ë¶„ë‹´, ì£¼ë³€ ìƒì ê³¼ ì œíœ´ ë“±)" class="w-full p-3 border border-gray-300 rounded-md"></textarea>
                            </div>
                        </div>
                    </section>
            
                    <section>
                        <h2 class="text-2xl font-bold text-indigo-700 mb-4">4. ê¸°ëŒ€ íš¨ê³¼</h2>
                        <div>
                            <label for="field_effects" class="font-semibold text-gray-700 block mb-2">ì•„ì´ë””ì–´ ì‹¤í˜„ í›„ ì˜ˆìƒë˜ëŠ” ê¸ì •ì  ë³€í™”</label>
                            <textarea id="field_effects" rows="6" placeholder="ì œì•ˆí•œ í—ˆë¸Œê°€ ì„±ê³µì ìœ¼ë¡œ ë„ì…ë˜ì—ˆì„ ë•Œ ì˜ˆìƒë˜ëŠ” ê¸ì •ì ì¸ ë³€í™”ë¥¼ ììœ ë¡­ê²Œ ìƒìƒí•˜ì—¬ ì‘ì„±í•´ë³´ì„¸ìš”." class="w-full p-3 border border-gray-300 rounded-md"></textarea>
                        </div>
                    </section>
                    
                    <!-- [NEW] ì¶œì²˜ ì¶”ê°€ ì„¹ì…˜ from index.html -->
                    <section>
                        <h2 class="text-2xl font-bold text-indigo-700 mb-4">5. ì •ë³´ ì¶œì²˜</h2>
                        <div>
                            <div id="sources_container" class="space-y-4"></div>
                            <button id="add_source_btn" class="mt-4 bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 transition text-sm">+ ì¶œì²˜ ì¶”ê°€</button>
                        </div>
                    </section>
                </div>
            </div>

            <!-- Tab 5: ë¯¸ë¦¬ë³´ê¸° ë° ì œì¶œ -->
            <div id="tab5" class="tab-content">
                 <div class="bg-white p-6 sm:p-8 rounded-lg shadow-md mb-6 no-print">
                    <!-- [MODIFIED] Button container -->
                    <div class="flex justify-center items-center gap-4 flex-wrap">
                        <button id="download_zip_btn" class="bg-green-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-600 transition text-base">
                            ğŸ“¦ ZIPìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ
                        </button>
                        <button id="print_btn" class="bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition text-base">
                            ğŸ–¨ï¸ PDFë¡œ ì €ì¥
                        </button>
                        <button id="preview_newtab_btn" class="bg-gray-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-700 transition text-base">
                            ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°(ìƒˆ íƒ­)
                        </button>
                        <button id="retry_upload_btn" class="hidden bg-yellow-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-yellow-600 transition text-base">
                            ğŸ”„ ì—…ë¡œë“œ ì¬ì‹œë„
                        </button>
                    </div>
                    <p class="text-center text-sm text-gray-600 mt-4" aria-live="polite" role="status"><span id="submit_status"></span></p>
                    <div id="progress_container" class="w-full max-w-xl mx-auto mt-3 hidden" aria-hidden="true">
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div id="progress_bar" class="bg-indigo-600 h-3 rounded-full" style="width:0%"></div>
                        </div>
                        <p id="progress_text" class="text-center text-xs text-gray-600 mt-1"></p>
                    </div>
                </div>
                <div class="bg-gray-200 p-4 sm:p-8 rounded-lg">
                    <div class="printable-area report-page" id="report-content">
                        <h1 id="preview_main_title" class="report-main-title">ìŠ¤ë§ˆíŠ¸ ëª¨ë¹Œë¦¬í‹° í—ˆë¸Œ ì•„ì´ë””ì–´ ì œì•ˆì„œ</h1>
                        <p class="text-right text-gray-600 mb-10" style="font-family: 'Noto Sans KR', sans-serif;">
                            <span id="preview_student_grade">1</span>í•™ë…„ <span id="preview_student_class">0</span>ë°˜ <span id="preview_student_number">00</span>ë²ˆ ì´ë¦„: <span id="preview_student_name">ã…‡ã…‡ã…‡</span>
                        </p>
                        
                        <h2 class="report-section-title">I. í˜„í™© ë¶„ì„ ë° ë¬¸ì œ ì¸ì‹</h2>
                        <p class="preview-text" id="preview_analysis"><span class="preview-placeholder">ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...</span></p>

                        <h2 class="report-section-title">II. ì‹œë²”ì‚¬ì—… ëŒ€ìƒì§€ ì„ ì •ì„ ìœ„í•œ ê³ ë ¤ì‚¬í•­</h2>
                        <h3 class="font-semibold mt-4 mb-2" id="preview_c1_title" style="font-family: 'Noto Sans KR', sans-serif;"><span class="preview-placeholder">[ê³ ë ¤ì‚¬í•­ 1 ì œëª©]</span></h3>
                        <p class="preview-text" id="preview_c1_desc"><span class="preview-placeholder">ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...</span></p>
                        <h3 class="font-semibold mt-4 mb-2" id="preview_c2_title" style="font-family: 'Noto Sans KR', sans-serif;"><span class="preview-placeholder">[ê³ ë ¤ì‚¬í•­ 2 ì œëª©]</span></h3>
                        <p class="preview-text" id="preview_c2_desc"><span class="preview-placeholder">ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...</span></p>

                        <h2 class="report-section-title">III. ìŠ¤ë§ˆíŠ¸ ëª¨ë¹Œë¦¬í‹° í—ˆë¸Œ ì•„ì´ë””ì–´</h2>
                        <h3 class="font-semibold mt-4 mb-2" style="font-family: 'Noto Sans KR', sans-serif;">ê°€. ë¬¼ë¦¬ì  ì¸í”„ë¼ (ê³µê°„)</h3>
                        <p class="preview-text" id="preview_idea_infra"><span class="preview-placeholder">ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...</span></p>
                        <h3 class="font-semibold mt-4 mb-2" style="font-family: 'Noto Sans KR', sans-serif;">ë‚˜. ë””ì§€í„¸/ì •ì±… (í˜œíƒ)</h3>
                        <p class="preview-text" id="preview_idea_policy"><span class="preview-placeholder">ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...</span></p>
                        <h3 class="font-semibold mt-4 mb-2" style="font-family: 'Noto Sans KR', sans-serif;">ë‹¤. ìš´ì˜ ëª¨ë¸ (í˜‘ë ¥)</h3>
                        <p class="preview-text" id="preview_idea_operation"><span class="preview-placeholder">ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...</span></p>

                        <h2 class="report-section-title">IV. ê¸°ëŒ€ íš¨ê³¼</h2>
                        <p class="preview-text" id="preview_effects"><span class="preview-placeholder">ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...</span></p>

                        <h2 class="report-section-title">V. ì •ë³´ ì¶œì²˜</h2>
                        <div class="preview-text" id="preview_sources"><span class="preview-placeholder">ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...</span></div>

                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals and Toasts -->
    <div id="toast-notification" class="fixed bottom-5 right-5 bg-gray-800 text-white py-3 px-5 rounded-lg shadow-lg opacity-0 transition-opacity duration-300 no-print">
        ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!
    </div>
    <div id="delete-confirm-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center z-50 no-print">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm">
            <h3 class="text-lg font-bold text-gray-800">ì‘ì„±í•œ ë‚´ìš©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h3>
            <p class="text-gray-600 mt-2">ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            <div class="mt-6 flex justify-end space-x-4">
                <button id="cancel-delete-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">ì·¨ì†Œ</button>
                <button id="confirm-delete-btn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">ì‚­ì œ</button>
            </div>
        </div>
    </div>
    <!-- [NEW] Import Modal -->
    <div id="import-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center z-50 no-print">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg">
            <h3 class="text-lg font-bold text-gray-800">ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</h3>
            <p class="text-gray-600 mt-2">'ë°ì´í„° ë‚´ë³´ë‚´ê¸°'ë¡œ ë³µì‚¬í•œ í…ìŠ¤íŠ¸ë¥¼ ì•„ë˜ì— ë¶™ì—¬ë„£ê³  'ë¶ˆëŸ¬ì˜¤ê¸°' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
            <textarea id="import_textarea" class="w-full h-32 p-2 mt-4 border border-gray-300 rounded-md"></textarea>
            <div class="mt-6 flex justify-end space-x-4">
                <button id="cancel-import-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">ì·¨ì†Œ</button>
                <button id="confirm-import-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">ë¶ˆëŸ¬ì˜¤ê¸°</button>
            </div>
        </div>
    </div>

    <!-- [NEW] iOS Save Help Modal -->
    <div id="ios-help-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center z-50 no-print" role="dialog" aria-modal="true" aria-labelledby="ios-help-title">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg">
            <h3 id="ios-help-title" class="text-lg font-bold text-gray-800">iOSì—ì„œ ZIP íŒŒì¼ ì €ì¥í•˜ê¸°</h3>
            <ol class="text-gray-700 mt-3 list-decimal list-inside space-y-2">
                <li>ì•„ë˜ "íŒŒì¼ì— ì €ì¥(ê³µìœ  ì‹œíŠ¸)" ë²„íŠ¼ì„ ëˆŒëŸ¬ ê³µìœ  ì‹œíŠ¸ë¥¼ ì—¬ì„¸ìš”.</li>
                <li>ê³µìœ  ì‹œíŠ¸ì—ì„œ "íŒŒì¼ì— ì €ì¥"ì„ ì„ íƒí•˜ì„¸ìš”.</li>
                <li>ì›í•˜ëŠ” ì €ì¥ ìœ„ì¹˜(ì˜ˆ: iCloud Drive ë˜ëŠ” ë‚´ iPhone)ì™€ í´ë”ë¥¼ ì„ íƒí•˜ê³  ì €ì¥í•˜ì„¸ìš”.</li>
            </ol>
            <p class="text-gray-500 text-sm mt-3">íŒ: ì €ì¥ í›„ "íŒŒì¼" ì•±ì—ì„œ ë°©ê¸ˆ ì €ì¥í•œ ìœ„ì¹˜ë¡œ ì´ë™í•´ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</p>
            <div class="mt-6 flex flex-col sm:flex-row justify-end gap-3">
                <button id="ios-help-download-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">ëŒ€ì‹  ë°”ë¡œ ë‹¤ìš´ë¡œë“œ</button>
                <div class="flex-1"></div>
                <button id="ios-help-close-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">ë‹«ê¸°</button>
                <button id="ios-help-confirm-btn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">íŒŒì¼ì— ì €ì¥(ê³µìœ  ì‹œíŠ¸)</button>
            </div>
        </div>
    </div>

    <!-- [NEW] Mobile Download Center Modal -->
    <div id="inapp-download-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center z-50 no-print" role="dialog" aria-modal="true" aria-labelledby="inapp-title">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg">
            <h3 id="inapp-title" class="text-lg font-bold text-gray-800">ëª¨ë°”ì¼ ë¸Œë¼ìš°ì €ì—ì„œ ì €ì¥í•˜ê¸°</h3>
            <p class="text-gray-600 mt-2">í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ë¸Œë¼ìš°ì €ì—ì„œëŠ” íŒŒì¼ ì €ì¥ì´ ì œí•œë  ìˆ˜ ìˆì–´ìš”. ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ì„œë²„ì—ì„œ ì§ì ‘ ë‚´ë ¤ë°›ì•„ ì£¼ì„¸ìš”.</p>
            <div class="mt-4 grid grid-cols-1 gap-3">
                <button id="inapp-server-download-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">ì„œë²„ì—ì„œ ë‹¤ìš´ë¡œë“œ(ê¶Œì¥)</button>
                <button id="inapp-retry-btn" class="hidden px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700">ì¬ì‹œë„</button>
            </div>
            <div class="mt-6 flex justify-end">
                <button id="inapp-close-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">ë‹«ê¸°</button>
            </div>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Session buttons gate (hub) ---
        const s1Link = document.getElementById('session1_link');
        const s2Link = document.getElementById('session2_link');
        const notice = document.getElementById('session_locked_notice');

        // Teacher bypass key support: read from URL once and store in sessionStorage
        (function persistTeacherKey(){
            try{
                const u=new URL(window.location.href);
                const k=u.searchParams.get('key');
                if(k){ sessionStorage.setItem('teacher_key', k); }
            }catch(_){}
        })();

        (async () => {
            if (!s1Link || !s2Link) return;
            try {
                const res = await fetch('/.netlify/functions/time', { cache: 'no-store' });
                if (!res.ok) throw new Error('time fetch failed');
                const data = await res.json();
                const nowUTC = typeof data?.now === 'number' ? data.now : Date.parse(data?.iso || '');
                if (!Number.isFinite(nowUTC)) throw new Error('bad time payload');

                // KST 2025-10-13 00:00 == UTC 2025-10-12T15:00:00Z
                const SHOW_UTC = Date.parse('2025-10-12T15:00:00Z');
                const teacherKey = sessionStorage.getItem('teacher_key') || '';
                const unlock = teacherKey || nowUTC >= SHOW_UTC;

                if (unlock) {
                    // Append teacher key to links if present
                    if (teacherKey) {
                        [s1Link, s2Link].forEach(a => {
                            if (!a) return; const url = new URL(a.getAttribute('href'), window.location.origin); url.searchParams.set('key', teacherKey); a.setAttribute('href', url.pathname + url.search);
                        });
                    }
                    s1Link.classList.remove('hidden');
                    s2Link.classList.remove('hidden');
                    s1Link.setAttribute('aria-disabled','false');
                    s2Link.setAttribute('aria-disabled','false');
                    if (notice) notice.classList.add('hidden');
                } else {
                    // Keep hidden until release
                    s1Link.classList.add('hidden');
                    s2Link.classList.add('hidden');
                    s1Link.setAttribute('aria-disabled','true');
                    s2Link.setAttribute('aria-disabled','true');
                    if (notice) notice.classList.remove('hidden');
                }
            } catch (_) {
                // On failure keep everything hidden (fail-safe)
                if (s1Link) { s1Link.classList.add('hidden'); s1Link.setAttribute('aria-disabled','true'); }
                if (s2Link) { s2Link.classList.add('hidden'); s2Link.setAttribute('aria-disabled','true'); }
                if (notice) notice.classList.remove('hidden');
            }
        })();
        // --- DOM Element Constants ---
        const dom = {
            tabs: document.querySelectorAll('.tab-button'),
            tabContents: document.querySelectorAll('.tab-content'),
            accordions: document.querySelectorAll('.accordion-header button'),
            deleteAllBtn: document.getElementById('delete_all_btn'),
            deleteModal: document.getElementById('delete-confirm-modal'),
            confirmDeleteBtn: document.getElementById('confirm-delete-btn'),
            cancelDeleteBtn: document.getElementById('cancel-delete-btn'),
            downloadZipBtn: document.getElementById('download_zip_btn'),
            printBtn: document.getElementById('print_btn'),
            previewNewTabBtn: document.getElementById('preview_newtab_btn'),
            retryUploadBtn: document.getElementById('retry_upload_btn'),
            addSourceBtn: document.getElementById('add_source_btn'),
            sourcesContainer: document.getElementById('sources_container'),
            toast: document.getElementById('toast-notification'),
            allInputs: document.querySelectorAll('#tab4 input, #tab4 textarea, input#student_grade, input#student_class, input#student_number, input#student_name'),
            // [NEW] Import/Export elements
            importDataBtn: document.getElementById('import_data_btn'),
            exportDataBtn: document.getElementById('export_data_btn'),
            importModal: document.getElementById('import-modal'),
            importTextarea: document.getElementById('import_textarea'),
            confirmImportBtn: document.getElementById('confirm-import-btn'),
            cancelImportBtn: document.getElementById('cancel-import-btn'),
            // Submit status
            submitStatus: document.getElementById('submit_status'),
            // iOS Help Modal
            iosHelpModal: document.getElementById('ios-help-modal'),
            iosHelpConfirmBtn: document.getElementById('ios-help-confirm-btn'),
            iosHelpCloseBtn: document.getElementById('ios-help-close-btn'),
            iosHelpDownloadBtn: document.getElementById('ios-help-download-btn'),
            // In-App Download Center
            inappModal: document.getElementById('inapp-download-modal'),
            inappCloseBtn: document.getElementById('inapp-close-btn'),
            inappServerDownloadBtn: document.getElementById('inapp-server-download-btn'),
            inappRetryBtn: document.getElementById('inapp-retry-btn'),
        };

        // --- Field Mapping for Preview ---
        const fields = {
            'student_grade': 'preview_student_grade',
            'student_class': 'preview_student_class', 'student_number': 'preview_student_number', 'student_name': 'preview_student_name',
            'field_analysis': 'preview_analysis',
            'field_c1_title': 'preview_c1_title', 'field_c1_desc': 'preview_c1_desc',
            'field_c2_title': 'preview_c2_title', 'field_c2_desc': 'preview_c2_desc',
            'field_idea_infra': 'preview_idea_infra', 'field_idea_policy': 'preview_idea_policy',
            'field_idea_operation': 'preview_idea_operation',
            'field_effects': 'preview_effects'
        };
        
        // --- Source Configuration ---
        const sourceConfig = {
            'ë…¼ë¬¸': {'ì €ì':true, 'ì—°ë„':true, 'ë…¼ë¬¸ ì œëª©':true, 'í•™ìˆ ì§€ëª…':false, 'ê¶Œ':false, 'í˜¸':false, 'í˜ì´ì§€':false},
            'ë„ì„œ': {'ì €ì':true, 'ë„ì„œëª…':true, 'ì¶œíŒì‚¬':true, 'ì—°ë„':false},
            'í•™ìˆ ì¡ì§€': {'ì¡ì§€ëª…':true, 'ê¸°ì‚¬ ì œëª©':true, 'ê¸°ìëª…':true, 'ë°œí–‰ì¼':false},
            'ì¸í„°ë„· URL': {'ì›¹ì‚¬ì´íŠ¸ëª…':true, 'ê¸€ ì œëª©':true, 'ì‘ì„±ì(ê¸°ì)':true, 'URL':true}
        };

        const storageKey = 'firstLastMileProjectData';

        // --- Event Listeners ---
        dom.tabs.forEach(tab => tab.addEventListener('click', () => switchTab(tab.dataset.tab)));
        dom.accordions.forEach(button => button.addEventListener('click', toggleAccordion));
        dom.allInputs.forEach(input => input.addEventListener('input', updatePreviewAndSave));
        
        dom.addSourceBtn.addEventListener('click', () => addSourceElement());
        dom.sourcesContainer.addEventListener('click', (e) => { if (e.target.classList.contains('delete_source_btn')) { e.target.closest('.source-entry').remove(); updatePreviewAndSave(); } });
        dom.sourcesContainer.addEventListener('change', (e) => { if (e.target.classList.contains('source-type-select')) { updateSourceInputs(e.target); updatePreviewAndSave(); } });
        dom.sourcesContainer.addEventListener('input', updatePreviewAndSave);
        
        dom.deleteAllBtn.addEventListener('click', () => dom.deleteModal.classList.remove('hidden'));
        dom.cancelDeleteBtn.addEventListener('click', () => dom.deleteModal.classList.add('hidden'));
        dom.confirmDeleteBtn.addEventListener('click', deleteAllContent);
        // Replace default ZIP download with simultaneous download + upload
        dom.downloadZipBtn.addEventListener('click', handleZipDownloadAndSubmit);
        if (dom.printBtn) dom.printBtn.addEventListener('click', printReport);
        if (dom.previewNewTabBtn) dom.previewNewTabBtn.addEventListener('click', openPreviewInNewTab);
        if (dom.retryUploadBtn) dom.retryUploadBtn.addEventListener('click', retryLastUpload);

        // iOS Help Modal events
    if (dom.iosHelpCloseBtn) dom.iosHelpCloseBtn.addEventListener('click', () => hideModal(dom.iosHelpModal));
        if (dom.iosHelpDownloadBtn) dom.iosHelpDownloadBtn.addEventListener('click', () => {
            // Fallback direct download
            if (lastZipBlob && lastMeta?.zipFilename) triggerBlobDownload(lastZipBlob, lastMeta.zipFilename);
            dom.iosHelpModal.classList.add('hidden');
        });
        if (dom.iosHelpConfirmBtn) dom.iosHelpConfirmBtn.addEventListener('click', openIOSShare);

        // In-App Download Center events
    if (dom.inappCloseBtn) dom.inappCloseBtn.addEventListener('click', () => hideModal(dom.inappModal));
        if (dom.inappServerDownloadBtn) dom.inappServerDownloadBtn.addEventListener('click', () => {
            serverDownloadLastZip();
        });
        if (dom.inappRetryBtn) dom.inappRetryBtn.addEventListener('click', () => {
            serverDownloadLastZip(true);
        });

        // Close modals on ESC for accessibility
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (dom.iosHelpModal && !dom.iosHelpModal.classList.contains('hidden')) hideModal(dom.iosHelpModal);
                if (dom.inappModal && !dom.inappModal.classList.contains('hidden')) hideModal(dom.inappModal);
            }
        });

        // --- Modal focus trap helpers ---
        let __lastTriggerEl = null;
        function getFocusable(el) {
            return el.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        }
        function showModal(el, triggerEl = null) {
            __lastTriggerEl = triggerEl || document.activeElement;
            el.classList.remove('hidden');
            const f = getFocusable(el);
            if (f.length) f[0].focus();
            function onKey(e) {
                if (e.key !== 'Tab') return;
                const focusables = Array.from(getFocusable(el));
                if (!focusables.length) return;
                const first = focusables[0];
                const last = focusables[focusables.length - 1];
                if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
                else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
            }
            el.__trapHandler = onKey;
            el.addEventListener('keydown', onKey);
        }
        function hideModal(el) {
            el.classList.add('hidden');
            if (el.__trapHandler) el.removeEventListener('keydown', el.__trapHandler);
            if (__lastTriggerEl && typeof __lastTriggerEl.focus === 'function') {
                __lastTriggerEl.focus();
            }
        }

        // [NEW] Import/Export event listeners
        dom.importDataBtn.addEventListener('click', () => dom.importModal.classList.remove('hidden'));
        dom.exportDataBtn.addEventListener('click', exportData);
        dom.cancelImportBtn.addEventListener('click', () => dom.importModal.classList.add('hidden'));
        dom.confirmImportBtn.addEventListener('click', importData);


        // --- Initialization ---
        loadFromBrowser();
        switchTab('tab1');
        updatePreview();

        // Hide PDF print button only on iOS and in-app browsers (Androidì—ì„œëŠ” ë…¸ì¶œ)
        const __env = detectInApp();
        if ((isIOS() || __env.isInApp) && dom.printBtn) {
            dom.printBtn.classList.add('hidden');
        }

        // --- Main Functions ---
        function switchTab(targetTabId) { /* ... (no changes) ... */ }
        function toggleAccordion(event) { /* ... (no changes) ... */ }
        function updatePreviewAndSave() { updatePreview(); saveToBrowser(); }
        function updatePreview() { /* ... (no changes) ... */ }
        function updateSourcesPreview() { /* ... (no changes) ... */ }
        function getFormData() { /* ... (no changes) ... */ }
        function saveToBrowser() { /* ... (no changes) ... */ }
        function loadFromBrowser() { /* ... (no changes) ... */ }
        function deleteAllContent() { /* ... (no changes) ... */ }
        function addSourceElement(sourceData = null) { /* ... (no changes) ... */ }
        function updateSourceInputs(selectElement, values = null) { /* ... (no changes) ... */ }
        function getReportFilename() { /* ... (no changes) ... */ }
        function printReport() { /* ... (no changes) ... */ }
        function downloadAsZIP() { /* ... (no changes) ... */ }
        let toastTimer;
        function showToast(message, bgColor = 'bg-gray-800') { /* ... (no changes) ... */ }

        // --- [NEW] Import/Export Functions ---
        async function exportData() {
            const dataString = localStorage.getItem(storageKey);
            if (!dataString) {
                showToast('ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'bg-red-500');
                return;
            }
            try {
                if (navigator.clipboard?.writeText) {
                    await navigator.clipboard.writeText(dataString);
                    showToast('ë°ì´í„°ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    throw new Error('Clipboard API not available');
                }
            } catch (err) {
                // Fallback
                const tempTextarea = document.createElement('textarea');
                tempTextarea.value = dataString;
                document.body.appendChild(tempTextarea);
                tempTextarea.select();
                try {
                    document.execCommand('copy');
                    showToast('ë°ì´í„°ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } catch (e) {
                    showToast('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.', 'bg-red-500');
                    prompt('ì•„ë˜ í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ë³µì‚¬í•˜ì„¸ìš”:', dataString);
                }
                document.body.removeChild(tempTextarea);
            }
        }

        function importData() {
            const dataString = dom.importTextarea.value;
            if (!dataString.trim()) {
                showToast('ë¶™ì—¬ë„£ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'bg-red-500');
                return;
            }
            try {
                const data = JSON.parse(dataString);
                // Clear existing content before loading
                dom.allInputs.forEach(input => input.value = '');
                dom.sourcesContainer.innerHTML = '';

                // Load new data
                Object.entries(data).forEach(([key, value]) => {
                    if (key === 'sources' && Array.isArray(value)) {
                        value.forEach(source => addSourceElement(source));
                    } else {
                        const el = document.getElementById(key);
                        if (el) el.value = value;
                    }
                });
                
                updatePreviewAndSave(); // Save imported data to the current browser and update preview
                dom.importModal.classList.add('hidden');
                dom.importTextarea.value = '';
                showToast('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');

            } catch (error) {
                showToast('ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'bg-red-500');
            }
        }

        // --- Unchanged Functions (for brevity in this view, but they are in the full code) ---
        function switchTab(targetTabId) { dom.tabs.forEach(t => t.classList.toggle('active', t.dataset.tab === targetTabId)); dom.tabContents.forEach(content => content.classList.toggle('active', content.id === targetTabId)); window.scrollTo(0, 0); }
        function toggleAccordion(event) { const button = event.currentTarget; const content = button.parentElement.nextElementSibling; const icon = button.querySelector('svg'); const isOpen = button.classList.toggle('open'); content.classList.toggle('open', isOpen); if (isOpen) { content.style.maxHeight = content.scrollHeight + 'px'; content.style.paddingTop = '1rem'; content.style.paddingBottom = '1rem'; if(icon) icon.style.transform = 'rotate(180deg)'; } else { content.style.maxHeight = '0'; content.style.paddingTop = '0'; content.style.paddingBottom = '0'; if(icon) icon.style.transform = 'rotate(0deg)'; } }
        function updatePreview() { Object.entries(fields).forEach(([fieldId, previewId]) => { const inputEl = document.getElementById(fieldId); const previewEl = document.getElementById(previewId); if (!inputEl || !previewEl) return; const value = inputEl.value.trim(); const placeholderSpan = previewEl.querySelector('.preview-placeholder'); const placeholderText = placeholderSpan ? placeholderSpan.textContent : `[${fieldId}]`; if (value) { previewEl.textContent = value; } else { previewEl.innerHTML = `<span class="preview-placeholder">${placeholderText}</span>`; } }); updateSourcesPreview(); }
        // Safe HTML escape
        function escapeHtml(s) {
            return String(s)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/\"/g, '&quot;')
                .replace(/'/g, '&#39;');
        }

        function updateSourcesPreview() {
            const sourcesPreview = document.getElementById('preview_sources');
            const sourceEntries = document.querySelectorAll('.source-entry');
            if (sourceEntries.length === 0) {
                sourcesPreview.innerHTML = `<span class="preview-placeholder">ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...</span>`;
                return;
            }
            let items = [];
            sourceEntries.forEach(entry => {
                const values = Array.from(entry.querySelectorAll('input')).map(i => escapeHtml(i.value.trim()));
                let parts = [];
                switch(entry.dataset.type) {
                    case 'ë…¼ë¬¸':
                        if(values[0]) parts.push(values[0]);
                        if(values[1]) parts.push(`(${values[1]})`);
                        if(values[2]) parts.push(`${values[2]}.`);
                        if(values[3]) parts.push(values[3]);
                        if(values[4] || values[5]) parts.push(`, ${values[4] || ''}(${values[5] || ''})`);
                        if(values[6]) parts.push(`, ${values[6]}`);
                        break;
                    case 'ë„ì„œ':
                        if(values[0]) parts.push(values[0]);
                        if(values[3]) parts.push(`(${values[3]})`);
                        if(values[1]) parts.push(`${values[1]}.`);
                        if(values[2]) parts.push(values[2]);
                        break;
                    case 'í•™ìˆ ì¡ì§€':
                        if(values[2]) parts.push(values[2]);
                        if(values[3]) parts.push(`(${values[3]})`);
                        if(values[1]) parts.push(`${values[1]}.`);
                        if(values[0]) parts.push(values[0]);
                        break;
                    case 'ì¸í„°ë„· URL':
                        if(values[2]) parts.push(values[2]);
                        if(values[0]) parts.push(values[0]);
                        if(values[1]) parts.push(`'${values[1]}'.`);
                        if (values[3]) parts.push(`URL: ${values[3]}`);
                        break;
                }
                let liContent = parts.join(' ').replace(/\s\./g,'.').replace(/\s,/g,',');
                items.push(`<li>${liContent}</li>`);
            });
            const html = `<ol class="list-decimal list-inside" style="line-height: 1.8;">${items.join('')}</ol>`;
            sourcesPreview.innerHTML = html;
        }
        function getFormData() { const data = {}; dom.allInputs.forEach(input => data[input.id] = input.value); data.sources = Array.from(document.querySelectorAll('.source-entry')).map(entry => ({ type: entry.dataset.type, values: Array.from(entry.querySelectorAll('input')).map(input => input.value) })); return data; }
        // Debounced local save to reduce storage/thrashing
        let __saveTimer;
        function saveToBrowser() {
            clearTimeout(__saveTimer);
            __saveTimer = setTimeout(() => {
                localStorage.setItem(storageKey, JSON.stringify(getFormData()));
                showToast('ìë™ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }, 300);
        }
        function loadFromBrowser() { const savedData = localStorage.getItem(storageKey); if (!savedData) return; const data = JSON.parse(savedData); Object.entries(data).forEach(([key, value]) => { if (key === 'sources' && Array.isArray(value)) { value.forEach(source => addSourceElement(source)); } else { const el = document.getElementById(key); if (el) el.value = value; } }); }
        function deleteAllContent() { dom.deleteModal.classList.add('hidden'); dom.allInputs.forEach(input => input.value = ''); dom.sourcesContainer.innerHTML = ''; localStorage.removeItem(storageKey); updatePreview(); showToast('ëª¨ë“  ë‚´ìš©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'bg-red-500'); }
        function addSourceElement(sourceData = null) { const entryDiv = document.createElement('div'); entryDiv.className = 'source-entry border p-4 rounded-md bg-gray-50 space-y-3'; const type = sourceData?.type || 'ë…¼ë¬¸'; entryDiv.dataset.type = type; entryDiv.innerHTML = `<div class="flex justify-between items-center"><select class="source-type-select p-2 border border-gray-300 rounded-md bg-white">${Object.keys(sourceConfig).map(option => `<option ${type === option ? 'selected' : ''}>${option}</option>`).join('')}</select><button class="delete_source_btn bg-red-500 text-white font-bold py-1 px-3 rounded-lg hover:bg-red-600 text-sm">ì‚­ì œ</button></div><div class="source-inputs grid grid-cols-1 sm:grid-cols-2 gap-2"></div>`; dom.sourcesContainer.appendChild(entryDiv); updateSourceInputs(entryDiv.querySelector('.source-type-select'), sourceData?.values); }
        function updateSourceInputs(selectElement, values = null) { const inputsContainer = selectElement.closest('.source-entry').querySelector('.source-inputs'); const type = selectElement.value; selectElement.closest('.source-entry').dataset.type = type; const fields = sourceConfig[type]; let i = 0; inputsContainer.innerHTML = Object.entries(fields).map(([field, isRequired]) => { const value = values?.[i] || ''; i++; return `<label class="block"><span class="text-gray-700 text-sm">${field}${isRequired ? '<span class="text-red-500">*</span>' : ''}</span><input type="text" placeholder="${field}" value="${value}" class="w-full p-2 mt-1 border border-gray-300 rounded-md text-sm"></label>`; }).join(''); }
        function getReportFilename() {
            const grade = (document.getElementById('student_grade').value || '1').trim();
            const studentClass = (document.getElementById('student_class').value || '0').trim().padStart(2, '0');
            const studentNumber = (document.getElementById('student_number').value || '0').trim().padStart(2, '0');
            const studentId = `${grade}${studentClass}${studentNumber}`;
            const studentName = document.getElementById('student_name').value.trim() || 'ì´ë¦„ì—†ìŒ';
            return `${studentId}_${studentName}_ìŠ¤ë§ˆíŠ¸ëª¨ë¹Œë¦¬í‹°_ì œì•ˆì„œ`;
        }
        function printReport() { const originalTitle = document.title; document.title = getReportFilename(); window.print(); setTimeout(() => { document.title = originalTitle; }, 500); }
        function downloadAsZIP() {
            const filename = getReportFilename();
            const reportContent = document.getElementById('report-content').innerHTML;
            // Use the same HTML generator as preview to ensure identical layout/styles
            const htmlContent = generateDocHtml(filename, reportContent);
            const zip = new JSZip();
            zip.file(`${filename}.html`, htmlContent);
            zip.generateAsync({ type: "blob" }).then(content => {
                const a = document.createElement('a');
                a.href = URL.createObjectURL(content);
                a.download = `${filename}.zip`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(a.href);
            });
        }
        function showToast(message, bgColor = 'bg-gray-800') { clearTimeout(toastTimer); const toast = dom.toast; toast.textContent = message; toast.className = 'fixed bottom-5 right-5 text-white py-3 px-5 rounded-lg shadow-lg transition-opacity duration-300 no-print ' + bgColor; toast.style.opacity = 1; toastTimer = setTimeout(() => { toast.style.opacity = 0; }, 2000); }

        // --- Helpers for iOS detection & download/share ---
        function isIOS() {
            const ua = navigator.userAgent || navigator.vendor || '';
            const iOSDevice = /iPad|iPhone|iPod/.test(ua);
            const iPadOSDesktopUA = navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1;
            return iOSDevice || iPadOSDesktopUA;
        }

        function triggerBlobDownload(blob, filename) {
            try {
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(a.href);
                showToast('ZIP íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
                return true;
            } catch (_) {
                return false;
            }
        }

        // Try local download first, then verify by environment heuristics and fallback to server-download
        async function saveWithPicker(blob, filename) {
            try {
                const opts = {
                    suggestedName: filename,
                    types: [{ description: 'ZIP file', accept: { 'application/zip': ['.zip'] } }],
                };
                const handle = await window.showSaveFilePicker(opts);
                const writable = await handle.createWritable();
                await writable.write(blob);
                await writable.close();
                return true;
            } catch (_) { return false; }
        }

        async function attemptLocalDownloadAndVerify(zipFilename) {
            const env = detectInApp();

            // In-app browsers are known to block/ignore a[download]/Blob â†’ fallback to server
            if (env.isInApp) {
                setStatus('ë¡œì»¬ ë‹¤ìš´ë¡œë“œê°€ ì œí•œë˜ì–´ ì„œë²„ ë‹¤ìš´ë¡œë“œë¡œ ì „í™˜í•©ë‹ˆë‹¤.');
                if (dom.inappModal) showModal(dom.inappModal, dom.downloadZipBtn);
                try { serverDownloadLastZip(); } catch(_) {}
                return;
            }

            // iOS Safari: guide to Files via share sheet
            if (isIOS()) {
                setStatus('iOS ì €ì¥ ì•ˆë‚´ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');
                if (dom.iosHelpModal) showModal(dom.iosHelpModal, dom.downloadZipBtn);
                return;
            }

            let localSaved = false;
            let usedPicker = false;
            // Prefer native Save As dialog where supported (Chromium-based)
            if (window.showSaveFilePicker && lastZipBlob) {
                usedPicker = true;
                localSaved = await saveWithPicker(lastZipBlob, zipFilename);
            }
            // Fallback to default a[download]
            if (!localSaved && lastZipBlob) {
                try { localSaved = triggerBlobDownload(lastZipBlob, zipFilename) === true; }
                catch (_) { localSaved = false; }
            }

            // Android/Samsung browsers may silently ignore a[download] for Blobs
            if (env.isAndroid || env.isSamsung) {
                if (!usedPicker) {
                    localSaved = false;
                }
            }

            if (localSaved) {
                setStatus('âœ… ë¡œì»¬ ë‹¤ìš´ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                showToast('ë¡œì»¬ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ', 'bg-green-600');
            } else {
                setStatus('ë¡œì»¬ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨ ë˜ëŠ” ì œí•œë¨, ì„œë²„ì—ì„œ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.');
                if (dom.inappModal) showModal(dom.inappModal, dom.downloadZipBtn);
                try { serverDownloadLastZip(); } catch(_) {}
            }
        }

        async function openIOSShare() {
            try {
                if (!lastZipBlob || !lastMeta?.zipFilename) {
                    showToast('ê³µìœ í•  íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.', 'bg-red-500');
                    return;
                }
                const zipFile = new File([lastZipBlob], lastMeta.zipFilename, { type: 'application/zip' });
                if (navigator.canShare && navigator.canShare({ files: [zipFile] }) && typeof navigator.share === 'function') {
                    await navigator.share({ files: [zipFile], title: lastMeta.zipFilename, text: 'íŒŒì¼ ì•±ì—ì„œ ì €ì¥ ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.' });
                    showToast('ê³µìœ  ì‹œíŠ¸ê°€ ì—´ë ¸ìŠµë‹ˆë‹¤. "íŒŒì¼ì— ì €ì¥"ì„ ì„ íƒí•˜ì„¸ìš”.', 'bg-green-600');
                } else {
                    // Fallback to direct download
                    triggerBlobDownload(lastZipBlob, lastMeta.zipFilename);
                }
            } catch (e) {
                // User cancelled or error -> fallback download
                triggerBlobDownload(lastZipBlob, lastMeta.zipFilename);
            } finally {
                if (dom.iosHelpModal) dom.iosHelpModal.classList.add('hidden');
            }
        }

        function detectInApp() {
            const uaRaw = navigator.userAgent || navigator.vendor || '';
            const ua = uaRaw.toLowerCase();
            const isIOS = /iphone|ipad|ipod/.test(ua) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
            const isAndroid = /android/.test(ua);
            const isSamsung = /samsungbrowser/i.test(uaRaw);
            const isKakao = /kakaotalk/.test(ua);
            const isNaver = /naver/.test(ua);
            const isFB = /fban|fbav|fb_iab/.test(ua);
            const isIG = /instagram/.test(ua);
            const isLine = / line\//.test(ua);
            const isIOSWebView = isIOS && !!window.webkit && !!window.webkit.messageHandlers && !/safari/i.test(uaRaw);
            const isInApp = isKakao || isNaver || isFB || isIG || isLine || isIOSWebView;
            let app = null;
            if (isKakao) app = 'kakao'; else if (isNaver) app = 'naver'; else if (isIG) app = 'instagram'; else if (isFB) app = 'facebook'; else if (isLine) app = 'line'; else if (isIOSWebView) app = 'ios-webview';
            return { isInApp, app, isIOS, isAndroid, isSamsung };
        }

        function openInChrome() {
            try {
                const url = location.href.replace(/^https?:\/\//, '');
                const scheme = location.protocol.replace(':','');
                const intentUrl = `intent://${url}#Intent;scheme=${scheme};package=com.android.chrome;end`;
                location.href = intentUrl;
            } catch (_) {
                showToast('Chromeìœ¼ë¡œ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë§í¬ë¥¼ ë³µì‚¬í•˜ê±°ë‚˜ QRì„ ì‚¬ìš©í•˜ì„¸ìš”.', 'bg-red-500');
            }
        }

        

        let __inappRetryCount = 0;
        const __inappRetryMax = 2;
        function setInappRetryVisibility(show) {
            if (!dom.inappRetryBtn) return;
            dom.inappRetryBtn.classList.toggle('hidden', !show);
        }
        function serverDownloadLastZip(isManualRetry = false) {
            try {
                if (!lastZipBlob || !lastMeta?.zipFilename) {
                    showToast('ë‹¤ìš´ë¡œë“œí•  íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.', 'bg-red-500');
                    return;
                }
                // Convert blob -> base64 then POST via a form to open in new tab
                blobToBase64(lastZipBlob).then((b64) => {
                    try {
                        const token = `${Date.now()}_${Math.random().toString(36).slice(2,8)}`;
                        // heartbeat checker
                        trackServerDownload(token, 3500);
                        const form = document.createElement('form');
                        form.method = 'POST';
                        form.action = '/.netlify/functions/download';
                        form.target = '_blank';
                        const add = (n, v) => { const i = document.createElement('input'); i.type = 'hidden'; i.name = n; i.value = v; form.appendChild(i); };
                        add('filename', lastMeta.zipFilename);
                        add('mime', 'application/zip');
                        add('contentBase64', b64);
                        add('token', token);
                        document.body.appendChild(form);
                        form.submit();
                        document.body.removeChild(form);
                        showToast('ì„œë²„ì—ì„œ ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.');
                        // ì„±ê³µ ì‹œ ëª¨ë‹¬ ë‹«ê³  ì¬ì‹œë„ ë²„íŠ¼ ìˆ¨ê¹€/ì¹´ìš´í„° ì´ˆê¸°í™”
                        __inappRetryCount = 0;
                        setInappRetryVisibility(false);
                        if (dom.inappModal) hideModal(dom.inappModal);
                    } catch (e) {
                        throw e;
                    }
                }).catch(() => {
                    // base64 ë³€í™˜ ì‹¤íŒ¨ë„ ì‹¤íŒ¨ë¡œ ì·¨ê¸‰
                    throw new Error('base64 ë³€í™˜ ì‹¤íŒ¨');
                });
            } catch (_) {
                __inappRetryCount += 1;
                if (__inappRetryCount <= __inappRetryMax) {
                    setInappRetryVisibility(true);
                    showToast(`ì„œë²„ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì¬ì‹œë„ ê°€ëŠ¥ (${__inappRetryCount}/${__inappRetryMax})`, 'bg-yellow-600');
                } else {
                    setInappRetryVisibility(false);
                    showToast('ì„œë²„ ë‹¤ìš´ë¡œë“œì— ë°˜ë³µ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.', 'bg-red-500');
                }
            }
        }

        // Poll for cookie set by server on successful attachment response
        function trackServerDownload(token, timeoutMs = 5000) {
            const deadline = Date.now() + timeoutMs;
            const key = `download_ok_${encodeURIComponent(token)}=`;
            const timer = setInterval(() => {
                const found = document.cookie.includes(key);
                if (found) {
                    clearInterval(timer);
                    setStatus('âœ… ë¡œì»¬ ì €ì¥(ì„œë²„ ì²¨ë¶€) í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    showToast('ë‹¤ìš´ë¡œë“œ ì™„ë£Œ í™•ì¸', 'bg-green-600');
                } else if (Date.now() > deadline) {
                    clearInterval(timer);
                }
            }, 300);
        }

        // SUBMIT MODULE START
        // Constants & Config
        const ENDPOINT = '/.netlify/functions/submit';
        const SUBMIT_KEY = 'S-2025-github2025subject'; // ì„œë²„ì—ì„œ 401 ì‘ë‹µ ì‹œ UI ì•ˆë‚´
    const SUBJECT = document.querySelector('meta[name="submission-subject"]')?.content || 'ê³¼í•™íƒêµ¬ì‹¤í—˜2';
        const ASSIGNMENT = 'suhaeng3';
        const SUBMIT_META_KEY = 'submit_meta';

        let lastZipBlob = null;
        let lastMeta = null;

        // Utilities
        function setStatus(text) {
            if (dom.submitStatus) dom.submitStatus.textContent = text || '';
        }

        // Progress helpers
        function showProgress(show) {
            const c = document.getElementById('progress_container');
            if (!c) return;
            c.classList.toggle('hidden', !show);
            c.setAttribute('aria-hidden', show ? 'false' : 'true');
        }
        function setProgress(percent, label = '') {
            const bar = document.getElementById('progress_bar');
            const txt = document.getElementById('progress_text');
            if (bar) bar.style.width = `${Math.max(0, Math.min(100, percent))}%`;
            if (txt) txt.textContent = label || '';
        }

        function disableSubmitUI(disabled) {
            if (dom.downloadZipBtn) dom.downloadZipBtn.disabled = disabled;
            if (dom.printBtn) dom.printBtn.disabled = disabled;
            if (dom.previewNewTabBtn) dom.previewNewTabBtn.disabled = disabled;
            if (dom.retryUploadBtn) dom.retryUploadBtn.classList.toggle('hidden', disabled || !dom.retryUploadBtn.dataset.show);
        }

        function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const result = reader.result || '';
                    const commaIdx = String(result).indexOf(',');
                    const b64 = commaIdx >= 0 ? String(result).slice(commaIdx + 1) : String(result);
                    resolve(b64);
                };
                reader.onerror = () => reject(reader.error);
                reader.readAsDataURL(blob);
            });
        }

        function bytesFromBase64(b64) {
            const len = b64.length;
            const pad = (b64.endsWith('==') ? 2 : (b64.endsWith('=') ? 1 : 0));
            return Math.floor((len * 3) / 4) - pad;
        }

        function calcSectionCode(grade, klass) {
            const g = String(grade || '').trim();
            const k = String(klass || '').trim().padStart(2, '0');
            return `${g}${k}`;
        }

        function calcStudentId(grade, klass, number) {
            const g = String(grade || '').trim();
            const k = String(klass || '').trim().padStart(2, '0');
            const n = String(number || '').trim().padStart(2, '0');
            return `${g}${k}${n}`;
        }

        function generateDocHtml(dynamicTitle, reportInnerHtml) {
            // Create HTML template with embedded CSS
            const htmlContent = `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${dynamicTitle}</title>
    <script src="https://cdn.tailwindcss.com"><\/script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Nanum+Myeongjo:wght@400;700&display=swap" rel="stylesheet">
        <style>
/* Base */
body { font-family: 'Noto Sans KR','Inter',sans-serif; background-color: #f3f4f6; margin:0; }
* { color: inherit !important; }

/* Report page layout */
.report-page {
    background-color: #ffffff;
    padding: 2.5cm 2cm;
    box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
    color: #1f2937; /* gray-800 */
}
.printable-area { width: 100%; }

/* Typography */
.report-main-title {
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 2.25rem; /* text-3xl */
    font-weight: 700;
    text-align: center;
    margin-bottom: 1rem;
    border-bottom: 2px solid #111827; /* gray-900 */
    padding-bottom: 1rem;
}
.report-section-title {
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 1.5rem;
    font-weight: 700; /* bold */
    color: #111827; /* gray-900 */
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #d1d5db; /* gray-300 */
}
.preview-text {
    white-space: pre-wrap;
    word-break: break-word;
    min-height: 2.5em;
    line-height: 1.8;
    color: #374151; /* gray-700 */
    font-family: 'Nanum Myeongjo', serif; /* ë³¸ë¬¸ì€ ëª…ì¡°ì²´ ìœ ì§€ */
}
.preview-placeholder { color: #9ca3af !important; font-style: italic; }
ol, ul { padding-left: 1.5rem; }
li { margin-bottom: 0.5rem; }

/* Print */
@page { size: A4 portrait; margin: 2cm; }
@media print {
    body * { visibility: hidden; }
    .printable-area, .printable-area * { visibility: visible; }
    .printable-area {
        position: absolute; left: 0; top: 0;
        width: 100%; padding: 0; margin: 0;
        box-shadow: none; border: none;
    }
    .no-print { display: none; }
}
        </style>
</head>
<body>
    <div class="report-page">
        <div class="printable-area">
${reportInnerHtml}
        </div>
    </div>
</body>
</html>`;

            return htmlContent;
        }

        function getDocTitle() {
            const titleEl = document.getElementById('preview_main_title');
            const t = (titleEl?.textContent || '').trim();
            return t || 'ë³´ê³ ì„œ';
        }

        function validateForm() {
            const gradeEl = document.getElementById('student_grade');
            const classEl = document.getElementById('student_class');
            const numberEl = document.getElementById('student_number');
            const nameEl = document.getElementById('student_name');
            const grade = parseInt((gradeEl.value || '').trim(), 10);
            const klass = parseInt((classEl.value || '').trim(), 10);
            const number = parseInt((numberEl.value || '').trim(), 10);
            const name = (nameEl.value || '').trim();

            if (Number.isNaN(grade) || grade < 1 || grade > 3) {
                showToast('í•™ë…„ì€ 1~3 ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.', 'bg-red-500');
                setStatus('ê²€ì¦ ì‹¤íŒ¨: í•™ë…„ ë²”ìœ„ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
                gradeEl.focus();
                return null;
            }
            if (Number.isNaN(klass) || klass < 1 || klass > 20) {
                showToast('ë°˜ì€ 1~20 ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.', 'bg-red-500');
                setStatus('ê²€ì¦ ì‹¤íŒ¨: ë°˜ ë²”ìœ„ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
                classEl.focus();
                return null;
            }
            if (Number.isNaN(number) || number < 1 || number > 40) {
                showToast('ë²ˆí˜¸ëŠ” 1~40 ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.', 'bg-red-500');
                setStatus('ê²€ì¦ ì‹¤íŒ¨: ë²ˆí˜¸ ë²”ìœ„ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
                numberEl.focus();
                return null;
            }
            if (!name) {
                showToast('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.', 'bg-red-500');
                setStatus('ê²€ì¦ ì‹¤íŒ¨: ì´ë¦„ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                nameEl.focus();
                return null;
            }

            return { grade, klass, number, name };
        }

        function saveSubmitMeta() {
            const meta = {
                grade: document.getElementById('student_grade')?.value || '',
                class: document.getElementById('student_class')?.value || '',
                number: document.getElementById('student_number')?.value || '',
                name: document.getElementById('student_name')?.value || '',
            };
            try { localStorage.setItem(SUBMIT_META_KEY, JSON.stringify(meta)); } catch (_) {}
        }

        function loadSubmitMeta() {
            try {
                const raw = localStorage.getItem(SUBMIT_META_KEY);
                if (!raw) return;
                const meta = JSON.parse(raw);
                if (meta.grade != null) document.getElementById('student_grade').value = meta.grade;
                if (meta.class != null) document.getElementById('student_class').value = meta.class;
                if (meta.number != null) document.getElementById('student_number').value = meta.number;
                if (meta.name != null) document.getElementById('student_name').value = meta.name;
            } catch (_) {}
        }

        // Wire meta autosave
        ['student_grade','student_class','student_number','student_name'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.addEventListener('input', saveSubmitMeta);
        });
        loadSubmitMeta();

        async function handleZipDownloadAndSubmit() {
            try {
                setStatus('í•™ìƒ ì •ë³´ ê²€ì¦ ì¤‘â€¦');
                dom.retryUploadBtn.dataset.show = '';
                dom.retryUploadBtn.classList.add('hidden');
                const form = validateForm();
                if (!form) return;

                disableSubmitUI(true);
                showProgress(true);
                setProgress(10, 'ë¬¸ì„œ ìƒì„± ì¤€ë¹„...');

                // Build filenames & meta
                const section = calcSectionCode(form.grade, form.klass);
                const studentId = calcStudentId(form.grade, form.klass, form.number);
                const docTitle = getDocTitle();
                // Use KST (Asia/Seoul) time with Intl for filenames
                const fmt = new Intl.DateTimeFormat('ko-KR', {
                    timeZone: 'Asia/Seoul',
                    year: 'numeric', month: '2-digit', day: '2-digit',
                    hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false
                });
                const parts = Object.fromEntries(fmt.formatToParts(new Date()).map(p => [p.type, p.value]));
                const timestamp = `${parts.year}${parts.month}${parts.day}_${parts.hour}${parts.minute}${parts.second}`;
                const baseName = `${studentId}_${form.name}_${docTitle}_${timestamp}`;
                const htmlFilename = `${baseName}.html`;
                const zipFilename = `${baseName}.zip`;

                // Generate doc HTML
                setStatus('ZIP íŒŒì¼ ìƒì„± ì¤‘â€¦');
                setProgress(25, 'ZIP ìƒì„± ì¤‘...');
                const reportContent = document.getElementById('report-content').innerHTML;
                const docHtml = generateDocHtml(baseName, reportContent);

                // Build ZIP
                const zip = new JSZip();
                zip.file(htmlFilename, docHtml);
                const zipBlob = await zip.generateAsync({ type: 'blob', compression: 'DEFLATE', compressionOptions: { level: 6 } });
                lastZipBlob = zipBlob;
                lastMeta = { studentId, name: form.name, zipFilename, section };

                // Size validation (8MB limit) BEFORE base64 to save CPU/mem
                const sizeBytes = zipBlob.size;
                if (sizeBytes > 8 * 1024 * 1024) {
                    setStatus('ì—…ë¡œë“œ ì‹¤íŒ¨: ZIP ìš©ëŸ‰ ì´ˆê³¼ (8MB)');
                    showToast('ZIP íŒŒì¼ ìš©ëŸ‰ì´ 8MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤. ë‚´ìš©ì„ ê°„ì†Œí™”í•´ì£¼ì„¸ìš”.', 'bg-red-500');
                    dom.retryUploadBtn.dataset.show = '1';
                    dom.retryUploadBtn.classList.remove('hidden');
                    return;
                }

                // Convert to base64 for upload (only after size check)
                setStatus('ì €ì¥ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”');
                setProgress(45, 'ì—…ë¡œë“œ ì¤€ë¹„...');
                const b64 = await blobToBase64(zipBlob);

                // File extension validation
                if (!zipFilename.toLowerCase().endsWith('.zip')) {
                    setStatus('ì—…ë¡œë“œ ì‹¤íŒ¨: ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹');
                    showToast('ZIP íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'bg-red-500');
                    return;
                }

                // Prepare payload in submit.js compatible format (multi-file array)
                setStatus('ì €ì¥ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”');
                const payload = {
                    studentId: studentId,
                    subject: SUBJECT, // 'science-experiments'
                    section: section, // '1í•™ë…„01ë°˜' í˜•ì‹
                    files: [{
                        filename: zipFilename,
                        contentBase64: b64,
                        mime: 'application/zip'
                    }]
                };

                // Upload with retry logic
                let uploadAttempts = 0;
                const maxAttempts = 3;

        while (uploadAttempts < maxAttempts) {
                    try {
                        uploadAttempts++;
                        if (uploadAttempts > 1) {
                            setStatus(`ì €ì¥ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”`);
                            setProgress(60, 'ì—…ë¡œë“œ ì¬ì‹œë„ ì¤‘...');
                            await new Promise(resolve => setTimeout(resolve, 1000 * uploadAttempts)); // Exponential backoff
                        }

            setProgress(60, 'ì—…ë¡œë“œ ì¤‘...');
            const res = await fetchWithTimeout(ENDPOINT, 20000, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-Submission-Key': SUBMIT_KEY,
                            },
                            body: JSON.stringify(payload),
                        });

                        const text = await res.text();
                        let data = {};
                        try {
                            data = JSON.parse(text);
                        } catch (_) {
                            data = { raw: text };
                        }

                        if (!res.ok) {
                            const errorMsg = data.error || data.detail || data.message || res.statusText || `HTTP ${res.status}`;
                            if (uploadAttempts < maxAttempts && (res.status === 429 || res.status >= 500)) {
                                // Retry on rate limit or server errors
                                continue;
                            }
                            throw new Error(`ì—…ë¡œë“œ ì‹¤íŒ¨: ${errorMsg}`);
                        }

                        // Success: upload completed, then start local download
                        const uploadedFile = data.files?.[0];
                        const filePath = uploadedFile?.name || zipFilename;
                        const fullPath = `/ê³¼ì œì œì¶œ/${SUBJECT}/${section}/${studentId}/${filePath}`;

                        // Success: try local download first, verify, then fallback if needed
                        setStatus(`âœ… ì œì¶œ ì™„ë£Œ! ì €ì¥ ê²½ë¡œ: ${fullPath} â€” ë‹¤ìš´ë¡œë“œ í™•ì¸ ì¤‘â€¦`);
                        setProgress(85, 'ë‹¤ìš´ë¡œë“œ ì¤€ë¹„...');
                        attemptLocalDownloadAndVerify(zipFilename);
                        setProgress(100, 'ì™„ë£Œ');
                        setTimeout(() => showProgress(false), 1500);

                        showToast(`ì œì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! íŒŒì¼: ${filePath}`, 'bg-green-600');

                        // Clear retry button
                        dom.retryUploadBtn.dataset.show = '';
                        dom.retryUploadBtn.classList.add('hidden');

                        return; // Success, exit function

                    } catch (fetchError) {
                        if (uploadAttempts >= maxAttempts) {
                            throw fetchError;
                        }
                        // Continue to retry
                    }
                }

            } catch (err) {
                const errorMessage = err?.message || err || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                setStatus(`âŒ ì œì¶œ ì‹¤íŒ¨: ${errorMessage}`);
                showToast(`ì œì¶œ ì‹¤íŒ¨: ${errorMessage}`, 'bg-red-500');
                setProgress(0, '');
                showProgress(false);

                // Show retry button
                if (dom.retryUploadBtn) {
                    dom.retryUploadBtn.dataset.show = '1';
                    dom.retryUploadBtn.classList.remove('hidden');
                }
            } finally {
                disableSubmitUI(false);
            }
        }

        // Fetch with timeout helper
        async function fetchWithTimeout(url, timeoutMs, options) {
            const controller = new AbortController();
            const id = setTimeout(() => controller.abort(), timeoutMs);
            try {
                return await fetch(url, { ...(options||{}), signal: controller.signal });
            } finally {
                clearTimeout(id);
            }
        }

        async function retryLastUpload() {
            try {
                if (!lastZipBlob || !lastMeta) {
                    showToast('ì¬ì‹œë„í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.', 'bg-red-500');
                    return;
                }

                disableSubmitUI(true);
                setStatus('ì €ì¥ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”');
                showProgress(true);
                setProgress(45, 'ì—…ë¡œë“œ ì¤€ë¹„...');

                const b64 = await blobToBase64(lastZipBlob);
                const sizeBytes = bytesFromBase64(b64);

                if (sizeBytes > 8 * 1024 * 1024) {
                    setStatus('ì—…ë¡œë“œ ì‹¤íŒ¨: ZIP ìš©ëŸ‰ ì´ˆê³¼ (8MB)');
                    showToast('ZIP íŒŒì¼ ìš©ëŸ‰ì´ 8MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.', 'bg-red-500');
                    return;
                }

                // Use the same multi-file format as main function
                const payload = {
                    studentId: lastMeta.studentId,
                    subject: SUBJECT,
                    section: lastMeta.section,
                    files: [{
                        filename: lastMeta.zipFilename,
                        contentBase64: b64,
                        mime: 'application/zip'
                    }]
                };

                const res = await fetchWithTimeout(ENDPOINT, 20000, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Submission-Key': SUBMIT_KEY,
                    },
                    body: JSON.stringify(payload),
                });

                const text = await res.text();
                let data = {};
                try {
                    data = JSON.parse(text);
                } catch (_) {
                    data = { raw: text };
                }

                if (!res.ok) {
                    const reason = data.error || data.detail || data.message || res.statusText || 'ì—…ë¡œë“œ ì‹¤íŒ¨';
                    setStatus(`ì œì¶œ ì‹¤íŒ¨: ${reason}`);
                    showToast(`ì œì¶œ ì‹¤íŒ¨: ${reason}`, 'bg-red-500');
                    return;
                }

                // Success
                const uploadedFile = data.files?.[0];
                const filePath = uploadedFile?.name || lastMeta.zipFilename;
                const fullPath = `/ê³¼ì œì œì¶œ/${SUBJECT}/${lastMeta.section}/${lastMeta.studentId}/${filePath}`;

                setStatus(`âœ… ì œì¶œ ì™„ë£Œ! ì €ì¥ ê²½ë¡œ: ${fullPath} â€” ë‹¤ìš´ë¡œë“œ í™•ì¸ ì¤‘â€¦`);
                setProgress(85, 'ë‹¤ìš´ë¡œë“œ ì¤€ë¹„...');
                attemptLocalDownloadAndVerify(lastMeta.zipFilename);
                setProgress(100, 'ì™„ë£Œ');
                setTimeout(() => showProgress(false), 1500);

                // Clear retry state
                dom.retryUploadBtn.dataset.show = '';
                dom.retryUploadBtn.classList.add('hidden');

            } catch (err) {
                const errorMessage = err?.message || err || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                setStatus(`âŒ ì œì¶œ ì‹¤íŒ¨: ${errorMessage}`);
                showToast(`ì œì¶œ ì‹¤íŒ¨: ${errorMessage}`, 'bg-red-500');
            } finally {
                disableSubmitUI(false);
                setProgress(0, '');
                showProgress(false);
            }
        }

        function openPreviewInNewTab() {
            try {
                const reportContent = document.getElementById('report-content').innerHTML;
                const now = new Date();
                const ts = `${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}-${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}${String(now.getSeconds()).padStart(2,'0')}`;
                const title = `ë¯¸ë¦¬ë³´ê¸°-${ts}`;
                const docHtml = generateDocHtml(title, reportContent);
                const blob = new Blob([docHtml], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                window.open(url, '_blank');
                setTimeout(() => URL.revokeObjectURL(url), 10000);
            } catch (_) {}
        }
        // SUBMIT MODULE END

    });
    </script>
</body>
</html>
