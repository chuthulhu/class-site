<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³¼í•™íƒêµ¬ì‹¤í—˜2 ìˆ˜í–‰í‰ê°€4 - ìŠ¤ë§ˆíŠ¸ ê¸°ê¸°ë¥¼ ì´ìš©í•˜ì—¬ ì£¼ë³€ì˜ ìƒë¬¼ ì¡°ì‚¬í•˜ê¸°</title>
    <meta name="submission-subject" content="ê³¼í•™íƒêµ¬ì‹¤í—˜2">
    <meta name="submission-activity" content="ìŠ¤ë§ˆíŠ¸ ê¸°ê¸°ë¥¼ ì´ìš©í•˜ì—¬ ì£¼ë³€ì˜ ìƒë¬¼ ì¡°ì‚¬í•˜ê¸°">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Nanum+Myeongjo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR','Inter',sans-serif; background-color:#f3f4f6; }
        .tab-button-group { display:flex; flex-wrap:wrap; gap:0.5rem; background-color:#e5e7eb; padding:0.5rem; border-radius:0.75rem; }
        .tab-button { flex-grow:1; text-align:center; padding:0.75rem 0.5rem; border-radius:0.625rem; font-weight:600; color:#374151; cursor:pointer; transition:all .2s ease; border:1px solid #d1d5db; background-color:#ffffff; box-shadow:0 1px 2px rgba(0,0,0,.04); }
        .tab-button:hover { background-color:#f9fafb; color:#111827; border-color:#c7d2fe; }
        .tab-button.active { background-color:#ffffff; color:#4f46e5; border-color:#4f46e5; box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06); }
        .tab-content { display:none; }
        .tab-content.active { display:block; }
        .report-page { background-color:#fff; padding:2.5cm 2cm; box-shadow:0 10px 15px -3px rgba(0,0,0,.1), 0 4px 6px -2px rgba(0,0,0,.05); color:#1f2937; }
        .report-main-title { font-family:'Noto Sans KR',sans-serif; font-size:1.875rem; font-weight:700; text-align:center; margin-bottom:1rem; border-bottom:2px solid #111827; padding-bottom:1rem; }
        .report-section-title { font-family:'Noto Sans KR',sans-serif; font-size:1.5rem; font-weight:700; color:#111827; margin-top:2.5rem; margin-bottom:1rem; padding-bottom:0.5rem; border-bottom:1px solid #d1d5db; }
        .preview-text { white-space:pre-wrap; word-break:break-word; min-height:2.5em; line-height:1.8; color:#374151; font-family:'Nanum Myeongjo',serif; }
        .preview-text a { color:#2563eb; text-decoration:underline; }
        .preview-text a:hover { color:#1d4ed8; text-decoration:underline; }
        .preview-placeholder { color:#9ca3af; font-style:italic; }
        /* ì´ë¯¸ì§€ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .image-preview img { max-width: 100%; height: auto; }
        .image-upload-area { border: 2px dashed #d1d5db; border-radius: 0.5rem; padding: 1rem; text-align: center; transition: border-color 0.2s; }
        .image-upload-area:hover { border-color: #3b82f6; }
        .image-upload-area.dragover { border-color: #3b82f6; background-color: #eff6ff; }
        /* guidance styles */
        .infographic-card { background-color:#f9fafb; border:1px solid #e5e7eb; border-radius:0.75rem; padding:1.5rem; text-align:center; }
        .tip-card { background: linear-gradient(135deg,#f5f3ff,#eef2ff); border-left:4px solid #6366f1; padding:1rem; border-radius:0.5rem; }
        /* accordion */
        .accordion-header button.open { background-color:#eef2ff; color:#4338ca; }
        .accordion-content { transition:max-height .3s ease-out, padding .3s ease-out; max-height:0; overflow:hidden; }
        .accordion-content.open { max-height:1500px; }

        /* Responsive typography & controls */
        html { font-size:16px; }
        @media (min-width: 640px) { html { font-size:16.5px; } }
        @media (min-width: 768px) { html { font-size:17px; } }
        @media (min-width: 1024px) { html { font-size:17.5px; } }
        @media (min-width: 1280px) { html { font-size:18px; } }

        .tab-button { font-size:.95rem; padding:.85rem .5rem; }
        @media (min-width: 640px) { .tab-button { font-size:1rem; } }
        @media (min-width: 1024px) { .tab-button { font-size:1.05rem; } }

        #download_zip_btn,
        #print_btn,
        #preview_newtab_btn,
        #retry_upload_btn,
        #add_source_btn,
        #clear_inputs_btn {
            font-size:.95rem; padding:.6rem 1rem;
        }
        @media (min-width: 640px) {
            #download_zip_btn,
            #print_btn,
            #preview_newtab_btn,
            #retry_upload_btn,
            #add_source_btn,
            #clear_inputs_btn { font-size:1rem; padding:.7rem 1.1rem; }
        }
        @media (min-width: 1024px) {
            #download_zip_btn,
            #print_btn,
            #preview_newtab_btn,
            #retry_upload_btn,
            #add_source_btn,
            #clear_inputs_btn { font-size:1.0625rem; padding:.8rem 1.2rem; }
        }

        label { font-size:.95rem; }
        textarea, input[type="text"], input[type="number"], select { font-size:1rem; }
        @media (min-width: 1024px) {
            textarea, input[type="text"], input[type="number"], select { font-size:1.0625rem; }
        }
        @page { 
            size: A4 portrait; 
            margin: 2cm 2cm 2cm 2cm;
        }
        
        /* ì¸ì‡„ìš© ë¨¸ë¦¬ë§ ìŠ¤íƒ€ì¼ */
        .print-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: white;
            border-bottom: 1px solid #E5E7EB;
            display: none;
            z-index: 1000;
        }
        
        .print-header .header-title {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 18px;
            font-weight: bold;
            color: #1F2937;
        }
        
        .print-header .header-student {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 12px;
            color: #6B7280;
        }
        /* ë¯¸ë¦¬ë³´ê¸° íƒ­ì—ì„œ ì œëª©ì„¹ì…˜ ìˆ¨ê¹€ */
        .header-section {
            display: none;
        }
        
        @media print { 
            body { 
                background-color: white; 
                padding-top: 0; /* ë¨¸ë¦¬ë§ ê³µê°„ ì œê±° */
            }
            .no-print { display:none; }
            .bg-gray-200 { background-color: white !important; }
            
            /* ì¸ì‡„ìš© ë¨¸ë¦¬ë§ ìˆ¨ê¹€ */
            .print-header {
                display: none !important;
            }
            
            /* ì œëª©/í•™ìƒì •ë³´ ì„¹ì…˜ë„ ìˆ¨ê¹€ (ê° ì„¹ì…˜ì— ê°œë³„ ì œëª© í¬í•¨) */
            .header-section {
                display: none;
            }
            
            .printable-area { 
                width:100%; 
                padding:0; 
                margin:0; 
                box-shadow:none; 
                border:none;
            }
            
            /* ê° ì„¹ì…˜ë§ˆë‹¤ ìƒˆ í˜ì´ì§€ì—ì„œ ì‹œì‘ */
            .content-section {
                page-break-before: always;
                margin-top: 0;
            }
            .content-section:first-child {
                page-break-before: auto; /* ì²« ë²ˆì§¸ ì„¹ì…˜ì€ í˜ì´ì§€ ë¸Œë ˆì´í¬ ì—†ìŒ */
            }
            
            .page-break-before { 
                page-break-before: always; 
            }
        }
        
        .page-break-before {
            page-break-before: always;
        }
        
        .section-container {
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
            background-color: #FAFAFA;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .section-container:last-child {
            margin-bottom: 0;
        }
        
        .section-header {
            border-bottom: 2px solid #3B82F6;
            padding-bottom: 12px;
            margin-bottom: 20px;
        }
        
        .section-title {
            color: #1F2937;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .section-subtitle {
            color: #6B7280;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        @media print {
            .page-break-before {
                page-break-before: always;
            }
            
            .section-container {
                border: 1px solid #000;
                box-shadow: none;
                background-color: white;
                page-break-inside: avoid;
            }
        }
    </style>
    <link rel="icon" href="data:,">
</head>
<body class="p-4 sm:p-8">
    <!-- ì¸ì‡„ìš© ë¨¸ë¦¬ë§ -->
    <div class="print-header">
        <div class="header-title">ê³¼í•™íƒêµ¬ì‹¤í—˜2 ìˆ˜í–‰í‰ê°€4</div>
        <div class="header-student" id="print-student-info">1í•™ë…„ 0ë°˜ 00ë²ˆ ì´ë¦„: ã…‡ã…‡ã…‡</div>
    </div>
    <div class="max-w-5xl mx-auto">
        <header class="text-center bg-white p-8 rounded-xl shadow-lg mb-6 no-print">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">ê³¼í•™íƒêµ¬ì‹¤í—˜2 ìˆ˜í–‰í‰ê°€4</h1>
            <p class="text-lg text-gray-600 mt-2">ìŠ¤ë§ˆíŠ¸ ê¸°ê¸°ë¥¼ ì´ìš©í•˜ì—¬ ì£¼ë³€ì˜ ìƒë¬¼ ì¡°ì‚¬í•˜ê¸°</p>
        </header>

        <div class="bg-white p-6 sm:p-8 rounded-lg shadow-md mb-6 no-print">
            <div class="flex flex-col sm:flex-row justify-between items-center gap-6">
                <div class="flex items-center space-x-2 flex-wrap justify-center">
                    <input type="number" id="student_grade" min="1" max="3" step="1" inputmode="numeric" class="w-20 p-2 border border-gray-300 rounded-md text-center" placeholder="í•™ë…„">
                    <label for="student_grade" class="font-semibold">í•™ë…„</label>
                    <input type="number" id="student_class" min="1" max="20" step="1" inputmode="numeric" class="w-20 p-2 border border-gray-300 rounded-md text-center" placeholder="ë°˜">
                    <label for="student_class" class="font-semibold">ë°˜</label>
                    <input type="number" id="student_number" min="1" max="40" step="1" inputmode="numeric" class="w-20 p-2 border border-gray-300 rounded-md text-center" placeholder="ë²ˆí˜¸">
                    <label for="student_number" class="font-semibold">ë²ˆ</label>
                    <input type="text" id="student_name" class="w-32 p-2 border border-gray-300 rounded-md" placeholder="ì´ë¦„">
                </div>
            </div>
        </div>

        <div class="mb-8 no-print">
            <div class="tab-button-group" aria-label="íƒ­ ë©”ë‰´">
                <button class="tab-button active" data-tab="guide1">í™œë™ ì•ˆë‚´</button>
                <button class="tab-button" data-tab="tab1">ìƒíƒœ ì¡°ì‚¬ ê³„íšì„œ</button>
                <button class="tab-button" data-tab="tab2">ìƒíƒœ ì¡°ì‚¬ ë³´ê³ ì„œ</button>
                <button class="tab-button" data-tab="tab3">ìƒë¬¼ ì¹´ë“œ ì œì‘</button>
                <button class="tab-button" data-tab="tab4">ë¯¸ë¦¬ë³´ê¸° ë° ì œì¶œ</button>
            </div>
        </div>
        
        <div id="guide1" class="tab-content active">
            <div class="bg-white p-6 sm:p-8 rounded-lg shadow-md space-y-10">
                <section>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">ìŠ¤ë§ˆíŠ¸ ê¸°ê¸°ë¥¼ ì´ìš©í•˜ì—¬ ì£¼ë³€ì˜ ìƒë¬¼ ì¡°ì‚¬í•˜ê¸°</h2>
                    <p class="text-gray-600 mb-6">ìŠ¤ë§ˆíŠ¸í°ì˜ ì¹´ë©”ë¼ì™€ ìƒë¬¼ ì‹ë³„ ì•±ì„ í™œìš©í•˜ì—¬ ì£¼ë³€ ìƒë¬¼ì„ ì¡°ì‚¬í•˜ê³ , ìƒíƒœ ì¡°ì‚¬ ê³„íšì„œì™€ ë³´ê³ ì„œë¥¼ ì‘ì„±í•˜ë©°, ìƒë¬¼ ì¹´ë“œë¥¼ ì œì‘í•©ë‹ˆë‹¤.</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="infographic-card"><span class="text-5xl mb-3">ğŸ“‹</span><h3 class="font-bold">ìƒíƒœ ì¡°ì‚¬ ê³„íšì„œ</h3><p class="text-gray-600 mt-2">ì¡°ì‚¬ ëª©ì , ë‚ ì§œ, ì¤€ë¹„ë¬¼ ë“± ê³„íš ìˆ˜ë¦½</p></div>
                        <div class="infographic-card"><span class="text-5xl mb-3">ğŸ“Š</span><h3 class="font-bold">ìƒíƒœ ì¡°ì‚¬ ë³´ê³ ì„œ</h3><p class="text-gray-600 mt-2">ì¡°ì‚¬ ê²°ê³¼ ì •ë¦¬ ë° ë¶„ì„</p></div>
                        <div class="infographic-card"><span class="text-5xl mb-3">ğŸƒ</span><h3 class="font-bold">ìƒë¬¼ ì¹´ë“œ ì œì‘</h3><p class="text-gray-600 mt-2">5ê°œ ìƒë¬¼ì˜ ìƒì„¸ ì •ë³´ ì¹´ë“œ</p></div>
                    </div>
                </section>
                
                <section>
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">í™œë™ ëª©í‘œ</h2>
                    <div class="tip-card">
                        <ul class="list-disc list-inside text-sm text-gray-700 space-y-1">
                            <li>ìŠ¤ë§ˆíŠ¸ ê¸°ê¸°ë¥¼ í™œìš©í•œ ìƒë¬¼ ì¡°ì‚¬ ë°©ë²• ìŠµë“</li>
                            <li>ìƒíƒœ ì¡°ì‚¬ ê³„íšì„œ ì‘ì„± ë° ì²´ê³„ì  ì¡°ì‚¬ ìˆ˜í–‰</li>
                            <li>ì¡°ì‚¬ ê²°ê³¼ë¥¼ ì •ë¦¬í•œ ë³´ê³ ì„œ ì‘ì„±</li>
                            <li>ë°œê²¬í•œ ìƒë¬¼ 5ì¢…ì— ëŒ€í•œ ìƒë¬¼ ì¹´ë“œ ì œì‘</li>
                        </ul>
                    </div>
                </section>
                
                <section>
                    <div class="accordion-item border-t pt-4">
                        <div class="accordion-header"><button class="w-full text-left p-4 rounded-lg font-semibold text-lg text-gray-800 hover:bg-gray-100 flex justify-between items-center"><span>ğŸ“± ìŠ¤ë§ˆíŠ¸ ê¸°ê¸° í™œìš© ë°©ë²•</span><svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button></div>
                        <div class="accordion-content"><div class="p-4 text-gray-600 space-y-3">
                            <p>ìŠ¤ë§ˆíŠ¸í°ì„ í™œìš©í•œ ìƒë¬¼ ì¡°ì‚¬ ë°©ë²•ì„ ì•Œì•„ë³´ì„¸ìš”.</p>
                            <div class="tip-card p-4 rounded-lg">
                                <h4 class="font-bold text-indigo-800">ìŠ¤ë§ˆíŠ¸ ê¸°ê¸° í™œìš©</h4>
                                <ul class="list-disc list-inside mt-2 text-sm">
                                    <li><strong>ì¹´ë©”ë¼:</strong> ìƒë¬¼ì˜ íŠ¹ì§•ì´ ì˜ ë³´ì´ë„ë¡ ì´¬ì˜</li>
                                    <li><strong>ìƒë¬¼ ì‹ë³„ ì•±:</strong> ë„¤ì´ë²„, êµ¬ê¸€ ë Œì¦ˆ, ì‹ë¬¼ë„ê° ì•± ë“± í™œìš©</li>
                                    <li><strong>GPS ê¸°ëŠ¥:</strong> ì¡°ì‚¬ ìœ„ì¹˜ ê¸°ë¡</li>
                                    <li><strong>ë©”ëª¨ ì•±:</strong> ê´€ì°° ë‚´ìš© ì¦‰ì‹œ ê¸°ë¡</li>
                                </ul>
                                <div class="mt-4 p-3 rounded-lg bg-indigo-50 border border-indigo-200">
                                    <h5 class="font-bold text-indigo-800 text-sm">ğŸ’¡ ì´¬ì˜ íŒ</h5>
                                    <ul class="text-sm text-indigo-900 mt-1 space-y-1">
                                        <li>â€¢ ìƒë¬¼ì˜ ì „ì²´ ëª¨ìŠµê³¼ íŠ¹ì§• ë¶€ìœ„ë¥¼ ëª¨ë‘ ì´¬ì˜</li>
                                        <li>â€¢ ì, ê½ƒ, ì—´ë§¤ ë“± ì‹ë³„ì— ì¤‘ìš”í•œ ë¶€ë¶„ ì´¬ì˜</li>
                                        <li>â€¢ ì„œì‹ì§€ í™˜ê²½ë„ í•¨ê»˜ ì´¬ì˜</li>
                                        <li>â€¢ ì—¬ëŸ¬ ê°ë„ì—ì„œ ì´¬ì˜í•˜ì—¬ ì •í™•í•œ ì‹ë³„</li>
                                    </ul>
                                </div>
                            </div>
                        </div></div>
                    </div>
                    
                    <div class="accordion-item border-t pt-4">
                        <div class="accordion-header"><button class="w-full text-left p-4 rounded-lg font-semibold text-lg text-gray-800 hover:bg-gray-100 flex justify-between items-center"><span>ğŸ”¬ ìƒë¬¼ ë¶„ë¥˜ ë° í•™ëª…</span><svg class="w-6 h-6 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button></div>
                        <div class="accordion-content"><div class="p-4 text-gray-600 space-y-3">
                            <p>ìƒë¬¼ì˜ ë¶„ë¥˜ ì²´ê³„ì™€ í•™ëª… ì‘ì„± ë°©ë²•ì„ ì•Œì•„ë³´ì„¸ìš”.</p>
                            <div class="tip-card p-4 rounded-lg">
                                <h4 class="font-bold text-indigo-800">ìƒë¬¼ ë¶„ë¥˜ ì²´ê³„</h4>
                                <ul class="list-disc list-inside mt-2 text-sm">
                                    <li><strong>ê³„(Kingdom):</strong> ë™ë¬¼ê³„, ì‹ë¬¼ê³„, ê· ê³„ ë“±</li>
                                    <li><strong>ë¬¸(Phylum):</strong> ì²™ì‚­ë™ë¬¼ë¬¸, ì†ì”¨ì‹ë¬¼ë¬¸ ë“±</li>
                                    <li><strong>ê°•(Class):</strong> í¬ìœ ê°•, ìŒìì—½ì‹ë¬¼ê°• ë“±</li>
                                    <li><strong>ëª©(Order):</strong> ì‹ìœ¡ëª©, ì¥ë¯¸ëª© ë“±</li>
                                    <li><strong>ê³¼(Family):</strong> ê°œê³¼, ì¥ë¯¸ê³¼ ë“±</li>
                                    <li><strong>ì†(Genus):</strong> ê°œì†, ì¥ë¯¸ì† ë“±</li>
                                    <li><strong>ì¢…(Species):</strong> ê°œ, ì¥ë¯¸ ë“±</li>
                                </ul>
                                <div class="mt-4 p-3 rounded-lg bg-indigo-50 border border-indigo-200">
                                    <h5 class="font-bold text-indigo-800 text-sm">âœï¸ í•™ëª… ì‘ì„± ì˜ˆì‹œ</h5>
                                    <p class="text-sm text-indigo-900 mt-1">
                                        <strong>ì†Œë‚˜ë¬´:</strong> <em>Pinus densiflora</em><br>
                                        <strong>ê°œ:</strong> <em>Canis lupus familiaris</em><br>
                                        <strong>ì¥ë¯¸:</strong> <em>Rosa hybrida</em>
                                    </p>
                                </div>
                            </div>
                        </div></div>
                    </div>
                </section>
            </div>
        </div>

        <main>
            <!-- ìƒíƒœ ì¡°ì‚¬ ê³„íšì„œ íƒ­ -->
            <div id="tab1" class="tab-content">
                <div class="bg-white p-6 sm:p-10 rounded-lg shadow-md space-y-8">
                    <header class="text-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">ìƒíƒœ ì¡°ì‚¬ ê³„íšì„œ</h2>
                        <p class="text-gray-600">ìƒë¬¼ ì¡°ì‚¬ë¥¼ ìœ„í•œ ê³„íšì„ ì²´ê³„ì ìœ¼ë¡œ ìˆ˜ë¦½í•˜ì„¸ìš”.</p>
                    </header>
                    
                    <section>
                        <h3 class="text-xl font-bold text-indigo-700 mb-4">ì¡°ì‚¬ ê¸°ë³¸ ì •ë³´</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="survey_date" class="font-semibold text-gray-700 block mb-2">ì¡°ì‚¬ ë‚ ì§œ</label>
                                <input type="date" id="survey_date" class="w-full p-3 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label for="survey_period" class="font-semibold text-gray-700 block mb-2">ì¡°ì‚¬ ê¸°ê°„</label>
                                <input type="text" id="survey_period" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: 2024ë…„ 3ì›” 15ì¼ ~ 3ì›” 20ì¼">
                            </div>
                        </div>
                        <div class="mt-4">
                            <label for="weather" class="font-semibold text-gray-700 block mb-2">ë‚ ì”¨</label>
                            <select id="weather" class="w-full p-3 border border-gray-300 rounded-md">
                                <option value="">ë‚ ì”¨ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="ë§‘ìŒ">ë§‘ìŒ</option>
                                <option value="êµ¬ë¦„ë§ìŒ">êµ¬ë¦„ë§ìŒ</option>
                                <option value="íë¦¼">íë¦¼</option>
                                <option value="ë¹„">ë¹„</option>
                                <option value="ëˆˆ">ëˆˆ</option>
                            </select>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-xl font-bold text-indigo-700 mb-4">ìƒíƒœì¡°ì‚¬ëª©ì </h3>
                        <div>
                            <label for="survey_purpose" class="font-semibold text-gray-700 block mb-2">ìƒíƒœì¡°ì‚¬ëª©ì </label>
                            <div class="text-sm bg-blue-50 border border-blue-200 text-blue-900 rounded-md p-3 mb-2">
                                <div class="font-semibold mb-1">ì‘ì„± ê°€ì´ë“œ</div>
                                <ul class="list-disc list-inside space-y-0.5">
                                    <li>ì™œ ì´ ì§€ì—­ì˜ ìƒë¬¼ì„ ì¡°ì‚¬í•˜ëŠ”ì§€ ëª…í™•íˆ ê¸°ìˆ </li>
                                    <li>ì˜ˆ: í•™êµ ì£¼ë³€ ìƒë¬¼ ë‹¤ì–‘ì„± íŒŒì•…, ê³„ì ˆë³„ ìƒë¬¼ ë³€í™” ê´€ì°° ë“±</li>
                                </ul>
                            </div>
                            <textarea id="survey_purpose" rows="3" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒíƒœì¡°ì‚¬ëª©ì ì„ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-xl font-bold text-indigo-700 mb-4">ìƒíƒœì¡°ì‚¬ ì¤€ë¹„ë¬¼</h3>
                        <div>
                            <label for="equipment" class="font-semibold text-gray-700 block mb-2">ìƒíƒœì¡°ì‚¬ ì¤€ë¹„ë¬¼</label>
                            <div class="text-sm bg-blue-50 border border-blue-200 text-blue-900 rounded-md p-3 mb-2">
                                <div class="font-semibold mb-1">í•„ìˆ˜ ì¤€ë¹„ë¬¼</div>
                                <ul class="list-disc list-inside space-y-0.5">
                                    <li>ìŠ¤ë§ˆíŠ¸í° (ì¹´ë©”ë¼, ìƒë¬¼ ì‹ë³„ ì•±)</li>
                                    <li>ë©”ëª¨ì¥, íœ</li>
                                    <li>ì†ì†Œë…ì œ, ë§ˆìŠ¤í¬</li>
                                    <li>ê°„ë‹¨í•œ ê°„ì‹, ë¬¼</li>
                                </ul>
                            </div>
                            <textarea id="equipment" rows="4" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒíƒœì¡°ì‚¬ì— í•„ìš”í•œ ì¤€ë¹„ë¬¼ì„ ë‚˜ì—´í•˜ì„¸ìš”"></textarea>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-xl font-bold text-indigo-700 mb-4">ì¡°ì‚¬ êµ¬ì—­ ë‚´ ì¥ì†Œ ì´ë™ ìˆœì„œ</h3>
                        <div>
                            <label for="survey_route" class="font-semibold text-gray-700 block mb-2">ì¡°ì‚¬ êµ¬ì—­ ë‚´ ì¥ì†Œ ì´ë™ ìˆœì„œ</label>
                            <div class="text-sm bg-blue-50 border border-blue-200 text-blue-900 rounded-md p-3 mb-2">
                                <div class="font-semibold mb-1">ì‘ì„± ê°€ì´ë“œ</div>
                                <ul class="list-disc list-inside space-y-0.5">
                                    <li>ì¡°ì‚¬í•  êµ¬ì²´ì ì¸ ì¥ì†Œì™€ ì´ë™ ìˆœì„œë¥¼ ëª…ì‹œ</li>
                                    <li>ì˜ˆ: 1) í•™êµ ìš´ë™ì¥ â†’ 2) í™”ë‹¨ â†’ 3) ì£¼ë³€ ê³µì›</li>
                                    <li>ê° ì¥ì†Œë³„ ì˜ˆìƒ ì†Œìš” ì‹œê°„ë„ í•¨ê»˜ ê¸°ìˆ </li>
                                </ul>
                            </div>
                            <textarea id="survey_route" rows="4" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì¡°ì‚¬ êµ¬ì—­ ë‚´ ì¥ì†Œ ì´ë™ ìˆœì„œë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-xl font-bold text-indigo-700 mb-4">ì¡°ì‚¬ ê²°ê³¼ ì´ìš© ê³„íš</h3>
                        <div>
                            <label for="survey_usage" class="font-semibold text-gray-700 block mb-2">ì¡°ì‚¬ ê²°ê³¼ ì´ìš© ê³„íš</label>
                            <div class="text-sm bg-blue-50 border border-blue-200 text-blue-900 rounded-md p-3 mb-2">
                                <div class="font-semibold mb-1">ì‘ì„± ê°€ì´ë“œ</div>
                                <ul class="list-disc list-inside space-y-0.5">
                                    <li>ì¡°ì‚¬ ê²°ê³¼ë¥¼ ì–´ë–»ê²Œ í™œìš©í• ì§€ ê³„íš</li>
                                    <li>ì˜ˆ: ìƒë¬¼ ì¹´ë“œ ì œì‘, ë³´ê³ ì„œ ì‘ì„±, ë°œí‘œ ìë£Œ ì¤€ë¹„</li>
                                    <li>ìƒíƒœê³„ ë³´ì „ì„ ìœ„í•œ í™œìš© ë°©ì•ˆë„ í¬í•¨</li>
                                </ul>
                            </div>
                            <textarea id="survey_usage" rows="4" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì¡°ì‚¬ ê²°ê³¼ ì´ìš© ê³„íšì„ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                        </div>
                    </section>
                </div>
            </div>

            <!-- ìƒíƒœ ì¡°ì‚¬ ë³´ê³ ì„œ íƒ­ -->
            <div id="tab2" class="tab-content">
                <div class="bg-white p-6 sm:p-10 rounded-lg shadow-md space-y-8">
                    <header class="text-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">ìƒíƒœ ì¡°ì‚¬ ë³´ê³ ì„œ</h2>
                        <p class="text-gray-600">ì¡°ì‚¬ ê²°ê³¼ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ì •ë¦¬í•˜ê³  ë¶„ì„í•˜ì„¸ìš”.</p>
                    </header>
                    
                    <section>
                        <h3 class="text-xl font-bold text-indigo-700 mb-4">ì¡°ì‚¬ ì¥ì†Œì˜ í™˜ê²½ì  íŠ¹ì§•</h3>
                        <div>
                            <label for="environmental_features" class="font-semibold text-gray-700 block mb-2">ì¡°ì‚¬ ì¥ì†Œì˜ í™˜ê²½ì  íŠ¹ì§•</label>
                            <div class="text-sm bg-blue-50 border border-blue-200 text-blue-900 rounded-md p-3 mb-2">
                                <div class="font-semibold mb-1">ì‘ì„± ê°€ì´ë“œ</div>
                                <ul class="list-disc list-inside space-y-0.5">
                                    <li>ì¡°ì‚¬ ì¥ì†Œì˜ ì§€í˜•, ê¸°í›„, í† ì–‘, ìˆ˜ì§ˆ ë“± í™˜ê²½ ì¡°ê±´</li>
                                    <li>ì‹ìƒì˜ ë°€ë„, ë†’ì´, ì¢…ë¥˜ ë“± ì‹ìƒ í™˜ê²½</li>
                                    <li>ì¸ê°„ í™œë™ì˜ ì˜í–¥ ì •ë„</li>
                                </ul>
                            </div>
                            <textarea id="environmental_features" rows="6" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì¡°ì‚¬ ì¥ì†Œì˜ í™˜ê²½ì  íŠ¹ì§•ì„ ìƒì„¸íˆ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-xl font-bold text-indigo-700 mb-4">ë°œê²¬í•œ ìƒë¬¼ì˜ ì¢… ìˆ˜</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="animal_species_count" class="font-semibold text-gray-700 block mb-2">ë™ë¬¼ ì¢… ìˆ˜</label>
                                <div class="text-sm bg-blue-50 border border-blue-200 text-blue-900 rounded-md p-3 mb-2">
                                    <div class="font-semibold mb-1">ì‘ì„± ê°€ì´ë“œ</div>
                                    <p>ë°œê²¬í•œ ë™ë¬¼ì˜ ì¢…ë¥˜ ìˆ˜ë¥¼ ìˆ«ìë¡œ ì…ë ¥í•˜ì„¸ìš”.</p>
                                </div>
                                <input type="number" id="animal_species_count" min="0" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: 5">
                            </div>
                            <div>
                                <label for="plant_species_count" class="font-semibold text-gray-700 block mb-2">ì‹ë¬¼ ì¢… ìˆ˜</label>
                                <div class="text-sm bg-blue-50 border border-blue-200 text-blue-900 rounded-md p-3 mb-2">
                                    <div class="font-semibold mb-1">ì‘ì„± ê°€ì´ë“œ</div>
                                    <p>ë°œê²¬í•œ ì‹ë¬¼ì˜ ì¢…ë¥˜ ìˆ˜ë¥¼ ìˆ«ìë¡œ ì…ë ¥í•˜ì„¸ìš”.</p>
                                </div>
                                <input type="number" id="plant_species_count" min="0" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: 8">
                            </div>
                        </div>
                    </section>

                    <section>
                        <h3 class="text-xl font-bold text-indigo-700 mb-4">ë°œê²¬í•œ ìƒë¬¼ì˜ íŠ¹ì§• (8ê°œ)</h3>
                        <div class="space-y-4">
                            <div class="text-sm bg-blue-50 border border-blue-200 text-blue-900 rounded-md p-3">
                                <div class="font-semibold mb-1">ì‘ì„± ê°€ì´ë“œ</div>
                                <p>ë°œê²¬í•œ ìƒë¬¼ 8ì¢…ì— ëŒ€í•´ ì´ë¦„, í•™ëª…, ë°œê²¬ì¥ì†Œ, íŠ¹ì§•ì„ ê¸°ë¡í•˜ì„¸ìš”.</p>
                            </div>
                            
                            <!-- ìƒë¬¼ 1 -->
                            <div class="border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-3">ìƒë¬¼ 1</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="species1_name" class="font-semibold text-gray-700 block mb-2">ì´ë¦„</label>
                                        <input type="text" id="species1_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: ì°¸ìƒˆ">
                                    </div>
                                    <div>
                                        <label for="species1_scientific_name" class="font-semibold text-gray-700 block mb-2">í•™ëª…</label>
                                        <input type="text" id="species1_scientific_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: Passer montanus">
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label for="species1_location" class="font-semibold text-gray-700 block mb-2">ë°œê²¬ì¥ì†Œ</label>
                                    <input type="text" id="species1_location" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: í•™êµ ìš´ë™ì¥ ë‚˜ë¬´ ìœ„">
                                </div>
                                <div class="mt-4">
                                    <label for="species1_characteristics" class="font-semibold text-gray-700 block mb-2">íŠ¹ì§•</label>
                                    <textarea id="species1_characteristics" rows="2" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ íŠ¹ì§•ì„ ìƒì„¸íˆ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                                </div>
                            </div>
                            
                            <!-- ìƒë¬¼ 2 -->
                            <div class="border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-3">ìƒë¬¼ 2</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="species2_name" class="font-semibold text-gray-700 block mb-2">ì´ë¦„</label>
                                        <input type="text" id="species2_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: ê°œë¯¸">
                                    </div>
                                    <div>
                                        <label for="species2_scientific_name" class="font-semibold text-gray-700 block mb-2">í•™ëª…</label>
                                        <input type="text" id="species2_scientific_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: Formica japonica">
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label for="species2_location" class="font-semibold text-gray-700 block mb-2">ë°œê²¬ì¥ì†Œ</label>
                                    <input type="text" id="species2_location" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: í™”ë‹¨ í™ ì†">
                                </div>
                                <div class="mt-4">
                                    <label for="species2_characteristics" class="font-semibold text-gray-700 block mb-2">íŠ¹ì§•</label>
                                    <textarea id="species2_characteristics" rows="2" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ íŠ¹ì§•ì„ ìƒì„¸íˆ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                                </div>
                            </div>
                            
                            <!-- ìƒë¬¼ 3 -->
                            <div class="border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-3">ìƒë¬¼ 3</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="species3_name" class="font-semibold text-gray-700 block mb-2">ì´ë¦„</label>
                                        <input type="text" id="species3_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: ì¥ë¯¸">
                                    </div>
                                    <div>
                                        <label for="species3_scientific_name" class="font-semibold text-gray-700 block mb-2">í•™ëª…</label>
                                        <input type="text" id="species3_scientific_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: Rosa hybrida">
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label for="species3_location" class="font-semibold text-gray-700 block mb-2">ë°œê²¬ì¥ì†Œ</label>
                                    <input type="text" id="species3_location" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: í•™êµ í™”ë‹¨">
                                </div>
                                <div class="mt-4">
                                    <label for="species3_characteristics" class="font-semibold text-gray-700 block mb-2">íŠ¹ì§•</label>
                                    <textarea id="species3_characteristics" rows="2" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ íŠ¹ì§•ì„ ìƒì„¸íˆ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                                </div>
                            </div>
                            
                            <!-- ìƒë¬¼ 4 -->
                            <div class="border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-3">ìƒë¬¼ 4</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="species4_name" class="font-semibold text-gray-700 block mb-2">ì´ë¦„</label>
                                        <input type="text" id="species4_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: ë‚˜ë¹„">
                                    </div>
                                    <div>
                                        <label for="species4_scientific_name" class="font-semibold text-gray-700 block mb-2">í•™ëª…</label>
                                        <input type="text" id="species4_scientific_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: Pieris rapae">
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label for="species4_location" class="font-semibold text-gray-700 block mb-2">ë°œê²¬ì¥ì†Œ</label>
                                    <input type="text" id="species4_location" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: í™”ë‹¨ ê½ƒ ìœ„">
                                </div>
                                <div class="mt-4">
                                    <label for="species4_characteristics" class="font-semibold text-gray-700 block mb-2">íŠ¹ì§•</label>
                                    <textarea id="species4_characteristics" rows="2" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ íŠ¹ì§•ì„ ìƒì„¸íˆ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                                </div>
                            </div>
                            
                            <!-- ìƒë¬¼ 5 -->
                            <div class="border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-3">ìƒë¬¼ 5</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="species5_name" class="font-semibold text-gray-700 block mb-2">ì´ë¦„</label>
                                        <input type="text" id="species5_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: ê°œ">
                                    </div>
                                    <div>
                                        <label for="species5_scientific_name" class="font-semibold text-gray-700 block mb-2">í•™ëª…</label>
                                        <input type="text" id="species5_scientific_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: Canis lupus familiaris">
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label for="species5_location" class="font-semibold text-gray-700 block mb-2">ë°œê²¬ì¥ì†Œ</label>
                                    <input type="text" id="species5_location" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: í•™êµ ì£¼ë³€ ê¸¸">
                                </div>
                                <div class="mt-4">
                                    <label for="species5_characteristics" class="font-semibold text-gray-700 block mb-2">íŠ¹ì§•</label>
                                    <textarea id="species5_characteristics" rows="2" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ íŠ¹ì§•ì„ ìƒì„¸íˆ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                                </div>
                            </div>
                            
                            <!-- ìƒë¬¼ 6 -->
                            <div class="border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-3">ìƒë¬¼ 6</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="species6_name" class="font-semibold text-gray-700 block mb-2">ì´ë¦„</label>
                                        <input type="text" id="species6_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: ì†Œë‚˜ë¬´">
                                    </div>
                                    <div>
                                        <label for="species6_scientific_name" class="font-semibold text-gray-700 block mb-2">í•™ëª…</label>
                                        <input type="text" id="species6_scientific_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: Pinus densiflora">
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label for="species6_location" class="font-semibold text-gray-700 block mb-2">ë°œê²¬ì¥ì†Œ</label>
                                    <input type="text" id="species6_location" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: í•™êµ ì •ì›">
                                </div>
                                <div class="mt-4">
                                    <label for="species6_characteristics" class="font-semibold text-gray-700 block mb-2">íŠ¹ì§•</label>
                                    <textarea id="species6_characteristics" rows="2" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ íŠ¹ì§•ì„ ìƒì„¸íˆ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                                </div>
                            </div>
                            
                            <!-- ìƒë¬¼ 7 -->
                            <div class="border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-3">ìƒë¬¼ 7</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="species7_name" class="font-semibold text-gray-700 block mb-2">ì´ë¦„</label>
                                        <input type="text" id="species7_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: ë©”ëšœê¸°">
                                    </div>
                                    <div>
                                        <label for="species7_scientific_name" class="font-semibold text-gray-700 block mb-2">í•™ëª…</label>
                                        <input type="text" id="species7_scientific_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: Oxya chinensis">
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label for="species7_location" class="font-semibold text-gray-700 block mb-2">ë°œê²¬ì¥ì†Œ</label>
                                    <input type="text" id="species7_location" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: ìš´ë™ì¥ ì”ë””">
                                </div>
                                <div class="mt-4">
                                    <label for="species7_characteristics" class="font-semibold text-gray-700 block mb-2">íŠ¹ì§•</label>
                                    <textarea id="species7_characteristics" rows="2" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ íŠ¹ì§•ì„ ìƒì„¸íˆ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                                </div>
                            </div>
                            
                            <!-- ìƒë¬¼ 8 -->
                            <div class="border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-3">ìƒë¬¼ 8</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="species8_name" class="font-semibold text-gray-700 block mb-2">ì´ë¦„</label>
                                        <input type="text" id="species8_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: ë¯¼ë“¤ë ˆ">
                                    </div>
                                    <div>
                                        <label for="species8_scientific_name" class="font-semibold text-gray-700 block mb-2">í•™ëª…</label>
                                        <input type="text" id="species8_scientific_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: Taraxacum officinale">
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label for="species8_location" class="font-semibold text-gray-700 block mb-2">ë°œê²¬ì¥ì†Œ</label>
                                    <input type="text" id="species8_location" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: ìš´ë™ì¥ ê°€ì¥ìë¦¬">
                                </div>
                                <div class="mt-4">
                                    <label for="species8_characteristics" class="font-semibold text-gray-700 block mb-2">íŠ¹ì§•</label>
                                    <textarea id="species8_characteristics" rows="2" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ íŠ¹ì§•ì„ ìƒì„¸íˆ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- ìƒë¬¼ ì¹´ë“œ ì œì‘ íƒ­ -->
            <div id="tab3" class="tab-content">
                <div class="bg-white p-6 sm:p-10 rounded-lg shadow-md space-y-8">
                    <header class="text-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">ìƒë¬¼ ì¹´ë“œ ì œì‘</h2>
                        <p class="text-gray-600">ë°œê²¬í•œ ìƒë¬¼ 5ì¢…ì— ëŒ€í•œ ìƒì„¸í•œ ìƒë¬¼ ì¹´ë“œë¥¼ ì œì‘í•˜ì„¸ìš”.</p>
                    </header>
                    <div class="flex justify-end -mt-2">
                        <button id="clear_inputs_btn" class="bg-red-50 text-red-700 font-semibold py-2 px-4 rounded-lg border border-red-200 hover:bg-red-100 transition text-sm">ğŸ—‘ï¸ ì…ë ¥ ë‚´ìš© ì‚­ì œ</button>
                    </div>
                    
                    <!-- ìƒë¬¼ ì¹´ë“œ 1 -->
                    <section>
                        <h3 class="text-xl font-bold text-indigo-700 mb-4">ìƒë¬¼ ì¹´ë“œ 1</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="card1_image" class="font-semibold text-gray-700 block mb-2">ìƒë¬¼ ì‚¬ì§„</label>
                                <div class="text-sm bg-blue-50 border border-blue-200 text-blue-900 rounded-md p-3 mb-2">
                                    <div class="font-semibold mb-1">ì‚¬ì§„ ì´¬ì˜ ê°€ì´ë“œ</div>
                                    <ul class="list-disc list-inside space-y-0.5">
                                        <li>ìƒë¬¼ì˜ ì „ì²´ ëª¨ìŠµê³¼ íŠ¹ì§• ë¶€ìœ„ë¥¼ ëª¨ë‘ ì´¬ì˜</li>
                                        <li>ì, ê½ƒ, ì—´ë§¤ ë“± ì‹ë³„ì— ì¤‘ìš”í•œ ë¶€ë¶„ ì´¬ì˜</li>
                                        <li>ì„œì‹ì§€ í™˜ê²½ë„ í•¨ê»˜ ì´¬ì˜</li>
                                    </ul>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <input type="file" id="card1_image" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'card1_image_preview')">
                                    <button type="button" onclick="document.getElementById('card1_image').click()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">
                                        ğŸ“· ì‚¬ì§„ ì„ íƒ
                                    </button>
                                    <div id="card1_image_preview" class="flex-1"></div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="card1_name" class="font-semibold text-gray-700 block mb-2">ìƒë¬¼ ì´ë¦„</label>
                                    <input type="text" id="card1_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: ì†Œë‚˜ë¬´">
                                </div>
                                <div>
                                    <label for="card1_scientific_name" class="font-semibold text-gray-700 block mb-2">í•™ëª…</label>
                                    <input type="text" id="card1_scientific_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: Pinus densiflora">
                                </div>
                            </div>
                            <div>
                                <label for="card1_classification" class="font-semibold text-gray-700 block mb-2">ë¶„ë¥˜</label>
                                <div class="text-sm bg-blue-50 border border-blue-200 text-blue-900 rounded-md p-3 mb-2">
                                    <div class="font-semibold mb-1">ì‘ì„± ê°€ì´ë“œ</div>
                                    <ul class="list-disc list-inside space-y-0.5">
                                        <li>ê³„, ë¬¸, ê°•, ëª©, ê³¼, ì†, ì¢… ìˆœì„œë¡œ ì‘ì„±</li>
                                        <li>ì˜ˆ: ì‹ë¬¼ê³„ > ì†ì”¨ì‹ë¬¼ë¬¸ > ìŒìì—½ì‹ë¬¼ê°• > ì†Œë‚˜ë¬´ëª© > ì†Œë‚˜ë¬´ê³¼ > ì†Œë‚˜ë¬´ì†</li>
                                    </ul>
                                </div>
                                <textarea id="card1_classification" rows="3" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ ë¶„ë¥˜ë¥¼ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                            </div>
                            <div>
                                <label for="card1_characteristics" class="font-semibold text-gray-700 block mb-2">íŠ¹ì§•</label>
                                <div class="text-sm bg-blue-50 border border-blue-200 text-blue-900 rounded-md p-3 mb-2">
                                    <div class="font-semibold mb-1">ì‘ì„± ê°€ì´ë“œ</div>
                                    <ul class="list-disc list-inside space-y-0.5">
                                        <li>ìƒë¬¼ì˜ ì™¸í˜•ì  íŠ¹ì§•ê³¼ ìƒíƒœì  íŠ¹ì§•</li>
                                        <li>ì„œì‹ì§€, ìƒí™œì‚¬, íŠ¹ë³„í•œ ìŠµì„± ë“±</li>
                                    </ul>
                                </div>
                                <textarea id="card1_characteristics" rows="4" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ íŠ¹ì§•ì„ ìƒì„¸íˆ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                            </div>
                            <div>
                                <label for="card1_habitat" class="font-semibold text-gray-700 block mb-2">ì„œì‹ì§€</label>
                                <textarea id="card1_habitat" rows="2" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì„œì‹ì§€ í™˜ê²½ì„ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                            </div>
                        </div>
                    </section>

                    <!-- ìƒë¬¼ ì¹´ë“œ 2 -->
                    <section>
                        <h3 class="text-xl font-bold text-indigo-700 mb-4">ìƒë¬¼ ì¹´ë“œ 2</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="card2_image" class="font-semibold text-gray-700 block mb-2">ìƒë¬¼ ì‚¬ì§„</label>
                                <div class="flex items-center space-x-4">
                                    <input type="file" id="card2_image" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'card2_image_preview')">
                                    <button type="button" onclick="document.getElementById('card2_image').click()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">
                                        ğŸ“· ì‚¬ì§„ ì„ íƒ
                                    </button>
                                    <div id="card2_image_preview" class="flex-1"></div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="card2_name" class="font-semibold text-gray-700 block mb-2">ìƒë¬¼ ì´ë¦„</label>
                                    <input type="text" id="card2_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: ê°œ">
                                </div>
                                <div>
                                    <label for="card2_scientific_name" class="font-semibold text-gray-700 block mb-2">í•™ëª…</label>
                                    <input type="text" id="card2_scientific_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: Canis lupus familiaris">
                                </div>
                            </div>
                            <div>
                                <label for="card2_classification" class="font-semibold text-gray-700 block mb-2">ë¶„ë¥˜</label>
                                <textarea id="card2_classification" rows="3" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ ë¶„ë¥˜ë¥¼ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                            </div>
                            <div>
                                <label for="card2_characteristics" class="font-semibold text-gray-700 block mb-2">íŠ¹ì§•</label>
                                <textarea id="card2_characteristics" rows="4" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ íŠ¹ì§•ì„ ìƒì„¸íˆ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                            </div>
                            <div>
                                <label for="card2_habitat" class="font-semibold text-gray-700 block mb-2">ì„œì‹ì§€</label>
                                <textarea id="card2_habitat" rows="2" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì„œì‹ì§€ í™˜ê²½ì„ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                            </div>
                        </div>
                    </section>

                    <!-- ìƒë¬¼ ì¹´ë“œ 3 -->
                    <section>
                        <h3 class="text-xl font-bold text-indigo-700 mb-4">ìƒë¬¼ ì¹´ë“œ 3</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="card3_image" class="font-semibold text-gray-700 block mb-2">ìƒë¬¼ ì‚¬ì§„</label>
                                <div class="flex items-center space-x-4">
                                    <input type="file" id="card3_image" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'card3_image_preview')">
                                    <button type="button" onclick="document.getElementById('card3_image').click()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">
                                        ğŸ“· ì‚¬ì§„ ì„ íƒ
                                    </button>
                                    <div id="card3_image_preview" class="flex-1"></div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="card3_name" class="font-semibold text-gray-700 block mb-2">ìƒë¬¼ ì´ë¦„</label>
                                    <input type="text" id="card3_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: ì¥ë¯¸">
                                </div>
                                <div>
                                    <label for="card3_scientific_name" class="font-semibold text-gray-700 block mb-2">í•™ëª…</label>
                                    <input type="text" id="card3_scientific_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: Rosa hybrida">
                                </div>
                            </div>
                            <div>
                                <label for="card3_classification" class="font-semibold text-gray-700 block mb-2">ë¶„ë¥˜</label>
                                <textarea id="card3_classification" rows="3" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ ë¶„ë¥˜ë¥¼ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                            </div>
                            <div>
                                <label for="card3_characteristics" class="font-semibold text-gray-700 block mb-2">íŠ¹ì§•</label>
                                <textarea id="card3_characteristics" rows="4" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ íŠ¹ì§•ì„ ìƒì„¸íˆ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                            </div>
                            <div>
                                <label for="card3_habitat" class="font-semibold text-gray-700 block mb-2">ì„œì‹ì§€</label>
                                <textarea id="card3_habitat" rows="2" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì„œì‹ì§€ í™˜ê²½ì„ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                            </div>
                        </div>
                    </section>

                    <!-- ìƒë¬¼ ì¹´ë“œ 4 -->
                    <section>
                        <h3 class="text-xl font-bold text-indigo-700 mb-4">ìƒë¬¼ ì¹´ë“œ 4</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="card4_image" class="font-semibold text-gray-700 block mb-2">ìƒë¬¼ ì‚¬ì§„</label>
                                <div class="flex items-center space-x-4">
                                    <input type="file" id="card4_image" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'card4_image_preview')">
                                    <button type="button" onclick="document.getElementById('card4_image').click()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">
                                        ğŸ“· ì‚¬ì§„ ì„ íƒ
                                    </button>
                                    <div id="card4_image_preview" class="flex-1"></div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="card4_name" class="font-semibold text-gray-700 block mb-2">ìƒë¬¼ ì´ë¦„</label>
                                    <input type="text" id="card4_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: ì°¸ìƒˆ">
                                </div>
                                <div>
                                    <label for="card4_scientific_name" class="font-semibold text-gray-700 block mb-2">í•™ëª…</label>
                                    <input type="text" id="card4_scientific_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: Passer montanus">
                                </div>
                            </div>
                            <div>
                                <label for="card4_classification" class="font-semibold text-gray-700 block mb-2">ë¶„ë¥˜</label>
                                <textarea id="card4_classification" rows="3" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ ë¶„ë¥˜ë¥¼ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                            </div>
                            <div>
                                <label for="card4_characteristics" class="font-semibold text-gray-700 block mb-2">íŠ¹ì§•</label>
                                <textarea id="card4_characteristics" rows="4" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ íŠ¹ì§•ì„ ìƒì„¸íˆ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                            </div>
                            <div>
                                <label for="card4_habitat" class="font-semibold text-gray-700 block mb-2">ì„œì‹ì§€</label>
                                <textarea id="card4_habitat" rows="2" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì„œì‹ì§€ í™˜ê²½ì„ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                            </div>
                        </div>
                    </section>

                    <!-- ìƒë¬¼ ì¹´ë“œ 5 -->
                    <section>
                        <h3 class="text-xl font-bold text-indigo-700 mb-4">ìƒë¬¼ ì¹´ë“œ 5</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="card5_image" class="font-semibold text-gray-700 block mb-2">ìƒë¬¼ ì‚¬ì§„</label>
                                <div class="flex items-center space-x-4">
                                    <input type="file" id="card5_image" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'card5_image_preview')">
                                    <button type="button" onclick="document.getElementById('card5_image').click()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">
                                        ğŸ“· ì‚¬ì§„ ì„ íƒ
                                    </button>
                                    <div id="card5_image_preview" class="flex-1"></div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="card5_name" class="font-semibold text-gray-700 block mb-2">ìƒë¬¼ ì´ë¦„</label>
                                    <input type="text" id="card5_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: ê°œë¯¸">
                                </div>
                                <div>
                                    <label for="card5_scientific_name" class="font-semibold text-gray-700 block mb-2">í•™ëª…</label>
                                    <input type="text" id="card5_scientific_name" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì˜ˆ: Formica japonica">
                                </div>
                            </div>
                            <div>
                                <label for="card5_classification" class="font-semibold text-gray-700 block mb-2">ë¶„ë¥˜</label>
                                <textarea id="card5_classification" rows="3" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ ë¶„ë¥˜ë¥¼ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                            </div>
                            <div>
                                <label for="card5_characteristics" class="font-semibold text-gray-700 block mb-2">íŠ¹ì§•</label>
                                <textarea id="card5_characteristics" rows="4" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ìƒë¬¼ì˜ íŠ¹ì§•ì„ ìƒì„¸íˆ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                            </div>
                            <div>
                                <label for="card5_habitat" class="font-semibold text-gray-700 block mb-2">ì„œì‹ì§€</label>
                                <textarea id="card5_habitat" rows="2" class="w-full p-3 border border-gray-300 rounded-md" placeholder="ì„œì‹ì§€ í™˜ê²½ì„ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                            </div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- ë¯¸ë¦¬ë³´ê¸° ë° ì œì¶œ íƒ­ -->
            <div id="tab4" class="tab-content">
                <div class="bg-white p-6 sm:p-8 rounded-lg shadow-md mb-6 no-print">
                    <div class="flex justify-center items-center gap-4 flex-wrap">
                        <button id="download_zip_btn" class="bg-green-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-600 transition text-base">ğŸ“¦ ZIPìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ</button>
                        <button id="print_btn" class="bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition text-base">ğŸ–¨ï¸ PDFë¡œ ì €ì¥</button>
                        <button id="preview_newtab_btn" class="bg-gray-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-700 transition text-base">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°(ìƒˆ íƒ­)</button>
                        <button id="retry_upload_btn" class="hidden bg-yellow-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-yellow-600 transition text-base">ğŸ”„ ì—…ë¡œë“œ ì¬ì‹œë„</button>
                    </div>
                    <p class="text-center text-sm text-gray-600 mt-4" aria-live="polite" role="status"><span id="submit_status"></span></p>
                    <div id="progress_container" class="w-full max-w-xl mx-auto mt-3 hidden" aria-hidden="true">
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div id="progress_bar" class="bg-indigo-600 h-3 rounded-full" style="width:0%"></div>
                        </div>
                        <p id="progress_text" class="text-center text-xs text-gray-600 mt-1"></p>
                    </div>
                </div>
                <div class="bg-gray-200 p-4 sm:p-8 rounded-lg space-y-8">
                    <!-- ì œëª©/í•™ìƒì •ë³´ ì„¹ì…˜ (ë¨¸ë¦¬ë§ìš©) -->
                    <div class="printable-area report-page header-section" data-student-info="">
                        <div class="section-header">
                            <h1 class="section-title">ê³¼í•™íƒêµ¬ì‹¤í—˜2 ìˆ˜í–‰í‰ê°€4</h1>
                            <p class="section-subtitle">ìŠ¤ë§ˆíŠ¸ ê¸°ê¸°ë¥¼ ì´ìš©í•˜ì—¬ ì£¼ë³€ì˜ ìƒë¬¼ ì¡°ì‚¬í•˜ê¸°</p>
                        </div>
                        <p class="text-right text-gray-600 mb-10" style="font-family: 'Noto Sans KR', sans-serif;">
                            <span id="preview_student_grade">1</span>í•™ë…„ <span id="preview_student_class">0</span>ë°˜ <span id="preview_student_number">00</span>ë²ˆ ì´ë¦„: <span id="preview_student_name">ã…‡ã…‡ã…‡</span>
                        </p>
                    </div>
                    
                    <!-- ìƒíƒœ ì¡°ì‚¬ ê³„íšì„œ ì„¹ì…˜ -->
                    <div class="printable-area report-page content-section">
                        <div class="section-header">
                            <h1 class="section-title">ê³¼í•™íƒêµ¬ì‹¤í—˜2 ìˆ˜í–‰í‰ê°€4</h1>
                            <p class="section-subtitle">ìŠ¤ë§ˆíŠ¸ ê¸°ê¸°ë¥¼ ì´ìš©í•˜ì—¬ ì£¼ë³€ì˜ ìƒë¬¼ ì¡°ì‚¬í•˜ê¸°</p>
                        </div>
                        <p class="text-right text-gray-600 mb-10" style="font-family: 'Noto Sans KR', sans-serif;">
                            <span id="preview_student_grade_plan">1</span>í•™ë…„ <span id="preview_student_class_plan">0</span>ë°˜ <span id="preview_student_number_plan">00</span>ë²ˆ ì´ë¦„: <span id="preview_student_name_plan">ã…‡ã…‡ã…‡</span>
                        </p>
                        <h2 class="report-section-title">ìƒíƒœ ì¡°ì‚¬ ê³„íšì„œ</h2>
                        <h3 class="font-semibold mt-4 mb-2" style="font-family: 'Noto Sans KR', sans-serif;">ì¡°ì‚¬ ê¸°ë³¸ ì •ë³´</h3>
                        <p class="preview-text" id="preview_survey_info"><span class="preview-placeholder">ì¡°ì‚¬ ë‚ ì§œ, ì¡°ì‚¬ ê¸°ê°„, ë‚ ì”¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”</span></p>
                        
                        <h3 class="font-semibold mt-4 mb-2" style="font-family: 'Noto Sans KR', sans-serif;">ìƒíƒœì¡°ì‚¬ëª©ì </h3>
                        <p class="preview-text" id="preview_survey_purpose"><span class="preview-placeholder">ìƒíƒœì¡°ì‚¬ëª©ì ì„ ì…ë ¥í•˜ì„¸ìš”</span></p>
                        
                        <h3 class="font-semibold mt-4 mb-2" style="font-family: 'Noto Sans KR', sans-serif;">ìƒíƒœì¡°ì‚¬ ì¤€ë¹„ë¬¼</h3>
                        <p class="preview-text" id="preview_equipment"><span class="preview-placeholder">ìƒíƒœì¡°ì‚¬ ì¤€ë¹„ë¬¼ì„ ì…ë ¥í•˜ì„¸ìš”</span></p>
                        
                        <h3 class="font-semibold mt-4 mb-2" style="font-family: 'Noto Sans KR', sans-serif;">ì¡°ì‚¬ êµ¬ì—­ ë‚´ ì¥ì†Œ ì´ë™ ìˆœì„œ</h3>
                        <p class="preview-text" id="preview_survey_route"><span class="preview-placeholder">ì¡°ì‚¬ êµ¬ì—­ ë‚´ ì¥ì†Œ ì´ë™ ìˆœì„œë¥¼ ì…ë ¥í•˜ì„¸ìš”</span></p>
                        
                        <h3 class="font-semibold mt-4 mb-2" style="font-family: 'Noto Sans KR', sans-serif;">ì¡°ì‚¬ ê²°ê³¼ ì´ìš© ê³„íš</h3>
                        <p class="preview-text" id="preview_survey_usage"><span class="preview-placeholder">ì¡°ì‚¬ ê²°ê³¼ ì´ìš© ê³„íšì„ ì…ë ¥í•˜ì„¸ìš”</span></p>

                    </div>
                    
                    <!-- ìƒíƒœ ì¡°ì‚¬ ë³´ê³ ì„œ ì„¹ì…˜ -->
                    <div class="printable-area report-page content-section">
                        <div class="section-header">
                            <h1 class="section-title">ê³¼í•™íƒêµ¬ì‹¤í—˜2 ìˆ˜í–‰í‰ê°€4</h1>
                            <p class="section-subtitle">ìŠ¤ë§ˆíŠ¸ ê¸°ê¸°ë¥¼ ì´ìš©í•˜ì—¬ ì£¼ë³€ì˜ ìƒë¬¼ ì¡°ì‚¬í•˜ê¸°</p>
                        </div>
                        <p class="text-right text-gray-600 mb-10" style="font-family: 'Noto Sans KR', sans-serif;">
                            <span id="preview_student_grade_report">1</span>í•™ë…„ <span id="preview_student_class_report">0</span>ë°˜ <span id="preview_student_number_report">00</span>ë²ˆ ì´ë¦„: <span id="preview_student_name_report">ã…‡ã…‡ã…‡</span>
                        </p>
                        <h2 class="report-section-title">ìƒíƒœ ì¡°ì‚¬ ë³´ê³ ì„œ</h2>
                        <h3 class="font-semibold mt-4 mb-2" style="font-family: 'Noto Sans KR', sans-serif;">ì¡°ì‚¬ ì¥ì†Œì˜ í™˜ê²½ì  íŠ¹ì§•</h3>
                        <p class="preview-text" id="preview_environmental_features"><span class="preview-placeholder">ì¡°ì‚¬ ì¥ì†Œì˜ í™˜ê²½ì  íŠ¹ì§•ì„ ì…ë ¥í•˜ì„¸ìš”</span></p>
                        
                        <h3 class="font-semibold mt-4 mb-2" style="font-family: 'Noto Sans KR', sans-serif;">ë°œê²¬í•œ ìƒë¬¼ì˜ ì¢… ìˆ˜</h3>
                        <p class="preview-text" id="preview_species_count"><span class="preview-placeholder">ë™ë¬¼ê³¼ ì‹ë¬¼ ì¢… ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”</span></p>
                        
                        <h3 class="font-semibold mt-4 mb-2" style="font-family: 'Noto Sans KR', sans-serif;">ë°œê²¬í•œ ìƒë¬¼ì˜ íŠ¹ì§• (8ê°œ)</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full border-collapse border border-gray-300 text-sm" style="font-family: 'Noto Sans KR', sans-serif;">
                                <thead>
                                    <tr class="bg-gray-100">
                                        <th class="border border-gray-300 px-4 py-3 text-left font-semibold">ì´ë¦„</th>
                                        <th class="border border-gray-300 px-4 py-3 text-left font-semibold">í•™ëª…</th>
                                        <th class="border border-gray-300 px-4 py-3 text-left font-semibold">ë°œê²¬ì¥ì†Œ</th>
                                        <th class="border border-gray-300 px-4 py-3 text-left font-semibold">íŠ¹ì§•</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species1_name"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species1_scientific_name"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species1_location"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species1_characteristics"><span class="preview-placeholder">-</span></td>
                                    </tr>
                                    <tr>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species2_name"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species2_scientific_name"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species2_location"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species2_characteristics"><span class="preview-placeholder">-</span></td>
                                    </tr>
                                    <tr>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species3_name"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species3_scientific_name"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species3_location"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species3_characteristics"><span class="preview-placeholder">-</span></td>
                                    </tr>
                                    <tr>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species4_name"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species4_scientific_name"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species4_location"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species4_characteristics"><span class="preview-placeholder">-</span></td>
                                    </tr>
                                    <tr>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species5_name"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species5_scientific_name"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species5_location"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species5_characteristics"><span class="preview-placeholder">-</span></td>
                                    </tr>
                                    <tr>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species6_name"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species6_scientific_name"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species6_location"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species6_characteristics"><span class="preview-placeholder">-</span></td>
                                    </tr>
                                    <tr>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species7_name"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species7_scientific_name"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species7_location"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species7_characteristics"><span class="preview-placeholder">-</span></td>
                                    </tr>
                                    <tr>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species8_name"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species8_scientific_name"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species8_location"><span class="preview-placeholder">-</span></td>
                                        <td class="border border-gray-300 px-4 py-3" id="preview_species8_characteristics"><span class="preview-placeholder">-</span></td>
                                    </tr>
                                </tbody>
                            </table>
                    </div>
                    </div>
                    <!-- ìƒë¬¼ ì¹´ë“œ ì„¹ì…˜ -->
                    <div class="printable-area report-page content-section">
                        <div class="section-header">
                            <h1 class="section-title">ê³¼í•™íƒêµ¬ì‹¤í—˜2 ìˆ˜í–‰í‰ê°€4</h1>
                            <p class="section-subtitle">ìŠ¤ë§ˆíŠ¸ ê¸°ê¸°ë¥¼ ì´ìš©í•˜ì—¬ ì£¼ë³€ì˜ ìƒë¬¼ ì¡°ì‚¬í•˜ê¸°</p>
                        </div>
                        <p class="text-right text-gray-600 mb-10" style="font-family: 'Noto Sans KR', sans-serif;">
                            <span id="preview_student_grade_card">1</span>í•™ë…„ <span id="preview_student_class_card">0</span>ë°˜ <span id="preview_student_number_card">00</span>ë²ˆ ì´ë¦„: <span id="preview_student_name_card">ã…‡ã…‡ã…‡</span>
                        </p>
                        <h2 class="report-section-title">ìƒë¬¼ ì¹´ë“œ</h2>
                        
                        <h3 class="font-semibold mt-4 mb-2" style="font-family: 'Noto Sans KR', sans-serif;">ìƒë¬¼ ì¹´ë“œ 1</h3>
                        <div id="preview_card1_image" class="mb-4"></div>
                        <p class="preview-text" id="preview_card1"><span class="preview-placeholder">ìƒë¬¼ ì¹´ë“œ 1 ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</span></p>
                        
                        <h3 class="font-semibold mt-4 mb-2" style="font-family: 'Noto Sans KR', sans-serif;">ìƒë¬¼ ì¹´ë“œ 2</h3>
                        <div id="preview_card2_image" class="mb-4"></div>
                        <p class="preview-text" id="preview_card2"><span class="preview-placeholder">ìƒë¬¼ ì¹´ë“œ 2 ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</span></p>
                        
                        <h3 class="font-semibold mt-4 mb-2" style="font-family: 'Noto Sans KR', sans-serif;">ìƒë¬¼ ì¹´ë“œ 3</h3>
                        <div id="preview_card3_image" class="mb-4"></div>
                        <p class="preview-text" id="preview_card3"><span class="preview-placeholder">ìƒë¬¼ ì¹´ë“œ 3 ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</span></p>
                        
                        <h3 class="font-semibold mt-4 mb-2" style="font-family: 'Noto Sans KR', sans-serif;">ìƒë¬¼ ì¹´ë“œ 4</h3>
                        <div id="preview_card4_image" class="mb-4"></div>
                        <p class="preview-text" id="preview_card4"><span class="preview-placeholder">ìƒë¬¼ ì¹´ë“œ 4 ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</span></p>
                        
                        <h3 class="font-semibold mt-4 mb-2" style="font-family: 'Noto Sans KR', sans-serif;">ìƒë¬¼ ì¹´ë“œ 5</h3>
                        <div id="preview_card5_image" class="mb-4"></div>
                        <p class="preview-text" id="preview_card5"><span class="preview-placeholder">ìƒë¬¼ ì¹´ë“œ 5 ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</span></p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="toast-notification" class="fixed bottom-5 right-5 bg-gray-800 text-white py-3 px-5 rounded-lg shadow-lg opacity-0 transition-opacity duration-300 no-print">ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!</div>

    <!-- iOS Save Help Modal -->
    <div id="ios-help-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center z-50 no-print" role="dialog" aria-modal="true" aria-labelledby="ios-help-title">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg">
            <h3 id="ios-help-title" class="text-lg font-bold text-gray-800">iOSì—ì„œ ZIP íŒŒì¼ ì €ì¥í•˜ê¸°</h3>
            <ol class="text-gray-700 mt-3 list-decimal list-inside space-y-2">
                <li>ì•„ë˜ "íŒŒì¼ì— ì €ì¥(ê³µìœ  ì‹œíŠ¸)" ë²„íŠ¼ì„ ëˆŒëŸ¬ ê³µìœ  ì‹œíŠ¸ë¥¼ ì—¬ì„¸ìš”.</li>
                <li>ê³µìœ  ì‹œíŠ¸ì—ì„œ "íŒŒì¼ì— ì €ì¥"ì„ ì„ íƒí•˜ì„¸ìš”.</li>
                <li>ì›í•˜ëŠ” ì €ì¥ ìœ„ì¹˜(ì˜ˆ: iCloud Drive ë˜ëŠ” ë‚´ iPhone)ì™€ í´ë”ë¥¼ ì„ íƒí•˜ê³  ì €ì¥í•˜ì„¸ìš”.</li>
            </ol>
            <p class="text-gray-500 text-sm mt-3">íŒ: ì €ì¥ í›„ "íŒŒì¼" ì•±ì—ì„œ ë°©ê¸ˆ ì €ì¥í•œ ìœ„ì¹˜ë¡œ ì´ë™í•´ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</p>
            <div class="mt-6 flex flex-col sm:flex-row justify-end gap-3">
                <button id="ios-help-download-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">ëŒ€ì‹  ë°”ë¡œ ë‹¤ìš´ë¡œë“œ</button>
                <div class="flex-1"></div>
                <button id="ios-help-close-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">ë‹«ê¸°</button>
                <button id="ios-help-confirm-btn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">íŒŒì¼ì— ì €ì¥(ê³µìœ  ì‹œíŠ¸)</button>
            </div>
        </div>
    </div>

    <!-- Mobile Download Center Modal -->
    <div id="inapp-download-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center z-50 no-print" role="dialog" aria-modal="true" aria-labelledby="inapp-title">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg">
            <h3 id="inapp-title" class="text-lg font-bold text-gray-800">ëª¨ë°”ì¼ ë¸Œë¼ìš°ì €ì—ì„œ ì €ì¥í•˜ê¸°</h3>
            <p class="text-gray-600 mt-2">í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ë¸Œë¼ìš°ì €ì—ì„œëŠ” íŒŒì¼ ì €ì¥ì´ ì œí•œë  ìˆ˜ ìˆì–´ìš”. ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ì„œë²„ì—ì„œ ì§ì ‘ ë‚´ë ¤ë°›ì•„ ì£¼ì„¸ìš”.</p>
            <div class="mt-4 grid grid-cols-1 gap-3">
                <button id="inapp-server-download-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">ì„œë²„ì—ì„œ ë‹¤ìš´ë¡œë“œ(ê¶Œì¥)</button>
                <button id="inapp-retry-btn" class="hidden px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700">ì¬ì‹œë„</button>
            </div>
            <div class="mt-6 flex justify-end">
                <button id="inapp-close-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <script>
    // ë¡œì»¬ ê°œë°œ í™˜ê²½ ê°ì§€
    const isLocalDev = window.location.hostname === 'localhost' || 
                      window.location.hostname === '127.0.0.1' ||
                      window.location.hostname.includes('192.168') ||
                      window.location.protocol === 'file:';

    // êµì‚¬í‚¤ ê²€ì¦ í•¨ìˆ˜ (ë°°í¬ í™˜ê²½ì—ì„œë§Œ ì ìš©)
    async function checkTeacherKey() {
        // ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œëŠ” êµì‚¬í‚¤ ê²€ì¦ ìš°íšŒ
        if (isLocalDev) {
            console.log('ë¡œì»¬ ê°œë°œ í™˜ê²½: êµì‚¬í‚¤ ê²€ì¦ ìš°íšŒ');
            return true;
        }
        
        try {
            const url = new URL(window.location.href);
            const providedKey = url.searchParams.get('key') || '';
            
            // êµì‚¬í‚¤ê°€ ì—†ìœ¼ë©´ ì ‘ê·¼ ì°¨ë‹¨
            if (!providedKey || providedKey.trim().length === 0) {
                showAccessDenied();
                return false;
            }
            
            // Netlify í™˜ê²½ë³€ìˆ˜ì—ì„œ êµì‚¬í‚¤ ê²€ì¦
            try {
                const response = await fetch('/.netlify/functions/verify-teacher-key', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ key: providedKey })
                });
                
                if (!response.ok) {
                    showAccessDenied();
                    return false;
                }
                
                const result = await response.json();
                if (!result.valid) {
                    showAccessDenied();
                    return false;
                }
                
                // êµì‚¬í‚¤ë¥¼ sessionStorageì— ì €ì¥ (ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ ë™ì¼)
                sessionStorage.setItem('teacher_key', providedKey);
                console.log('Teacher key validated:', providedKey.slice(0, 8) + '...');
                return true;
                
            } catch (fetchError) {
                console.error('êµì‚¬í‚¤ ê²€ì¦ API ì˜¤ë¥˜:', fetchError);
                // API ì˜¤ë¥˜ ì‹œì—ë„ êµì‚¬í‚¤ê°€ ìˆìœ¼ë©´ í—ˆìš© (fallback)
                sessionStorage.setItem('teacher_key', providedKey);
                return true;
            }
            
        } catch (error) {
            console.error('URL parsing error:', error);
            showAccessDenied();
            return false;
        }
    }
    
    // ì ‘ê·¼ ê±°ë¶€ í˜ì´ì§€ í‘œì‹œ
    function showAccessDenied() {
        document.body.innerHTML = `
            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; font-family: 'Noto Sans KR', sans-serif; background-color: #f3f4f6;">
                <div style="text-align: center; background: white; padding: 3rem; border-radius: 1rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,.1);">
                    <h1 style="font-size: 4rem; font-weight: bold; color: #ef4444; margin-bottom: 1rem;">403</h1>
                    <h2 style="font-size: 1.5rem; font-weight: 600; color: #374151; margin-bottom: 1rem;">ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤</h2>
                    <p style="color: #6b7280; margin-bottom: 2rem;">ì´ í˜ì´ì§€ëŠ” êµì‚¬í‚¤ê°€ í•„ìš”í•œ í˜ì´ì§€ì…ë‹ˆë‹¤.</p>
                    <div style="background-color: #fef2f2; border: 1px solid #fecaca; border-radius: 0.5rem; padding: 1rem; margin-top: 1rem;">
                        <p style="color: #dc2626; font-size: 0.875rem; margin: 0;">
                            ğŸ’¡ êµì‚¬ í¬í„¸ì—ì„œ ì œê³µë˜ëŠ” ë§í¬ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.
                        </p>
                    </div>
                    <div style="margin-top: 2rem;">
                        <a href="/" style="display: inline-block; background-color: #3b82f6; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; text-decoration: none; font-weight: 500;">
                            êµì‚¬ í¬í„¸ë¡œ ì´ë™
                        </a>
                    </div>
                </div>
            </div>
        `;
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ êµì‚¬í‚¤ ê²€ì¦ (ë¹„ë™ê¸°)
    checkTeacherKey().then(isValid => {
        if (!isValid) {
            // êµì‚¬í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì¤‘ë‹¨
            throw new Error('Unauthorized access');
        }
    }).catch(error => {
        console.error('êµì‚¬í‚¤ ê²€ì¦ ì‹¤íŒ¨:', error);
    });

    document.addEventListener('DOMContentLoaded', () => {
        const dom = {
            tabs: document.querySelectorAll('.tab-button'),
            tabContents: document.querySelectorAll('.tab-content'),
            accordions: document.querySelectorAll('.accordion-header button'),
            downloadZipBtn: document.getElementById('download_zip_btn'),
            printBtn: document.getElementById('print_btn'),
            previewNewTabBtn: document.getElementById('preview_newtab_btn'),
            retryUploadBtn: document.getElementById('retry_upload_btn'),
            clearBtn: document.getElementById('clear_inputs_btn'),
            toast: document.getElementById('toast-notification'),
            allInputs: document.querySelectorAll('#tab1 input, #tab1 textarea, #tab1 select, #tab2 input, #tab2 textarea, #tab3 input, #tab3 textarea, input#student_grade, input#student_class, input#student_number, input#student_name'),
            submitStatus: document.getElementById('submit_status'),
            // iOS Help Modal
            iosHelpModal: document.getElementById('ios-help-modal'),
            iosHelpConfirmBtn: document.getElementById('ios-help-confirm-btn'),
            iosHelpCloseBtn: document.getElementById('ios-help-close-btn'),
            iosHelpDownloadBtn: document.getElementById('ios-help-download-btn'),
            // In-App Download Center
            inappModal: document.getElementById('inapp-download-modal'),
            inappCloseBtn: document.getElementById('inapp-close-btn'),
            inappServerDownloadBtn: document.getElementById('inapp-server-download-btn'),
            inappRetryBtn: document.getElementById('inapp-retry-btn'),
        };

        const fields = {
            'survey_date': 'preview_survey_date',
            'survey_period': 'preview_survey_period',
            'weather': 'preview_weather',
            'survey_purpose': 'preview_survey_purpose',
            'equipment': 'preview_equipment',
            'survey_route': 'preview_survey_route',
            'survey_usage': 'preview_survey_usage',
            'environmental_features': 'preview_environmental_features',
            'animal_species_count': 'preview_animal_species_count',
            'plant_species_count': 'preview_plant_species_count',
            'species1_name': 'preview_species1_name',
            'species1_scientific_name': 'preview_species1_scientific_name',
            'species1_location': 'preview_species1_location',
            'species1_characteristics': 'preview_species1_characteristics',
            'species2_name': 'preview_species2_name',
            'species2_scientific_name': 'preview_species2_scientific_name',
            'species2_location': 'preview_species2_location',
            'species2_characteristics': 'preview_species2_characteristics',
            'species3_name': 'preview_species3_name',
            'species3_scientific_name': 'preview_species3_scientific_name',
            'species3_location': 'preview_species3_location',
            'species3_characteristics': 'preview_species3_characteristics',
            'species4_name': 'preview_species4_name',
            'species4_scientific_name': 'preview_species4_scientific_name',
            'species4_location': 'preview_species4_location',
            'species4_characteristics': 'preview_species4_characteristics',
            'species5_name': 'preview_species5_name',
            'species5_scientific_name': 'preview_species5_scientific_name',
            'species5_location': 'preview_species5_location',
            'species5_characteristics': 'preview_species5_characteristics',
            'species6_name': 'preview_species6_name',
            'species6_scientific_name': 'preview_species6_scientific_name',
            'species6_location': 'preview_species6_location',
            'species6_characteristics': 'preview_species6_characteristics',
            'species7_name': 'preview_species7_name',
            'species7_scientific_name': 'preview_species7_scientific_name',
            'species7_location': 'preview_species7_location',
            'species7_characteristics': 'preview_species7_characteristics',
            'species8_name': 'preview_species8_name',
            'species8_scientific_name': 'preview_species8_scientific_name',
            'species8_location': 'preview_species8_location',
            'species8_characteristics': 'preview_species8_characteristics',
            'card1_name': 'preview_card1_name',
            'card1_scientific_name': 'preview_card1_scientific_name',
            'card1_classification': 'preview_card1_classification',
            'card1_characteristics': 'preview_card1_characteristics',
            'card1_habitat': 'preview_card1_habitat',
            'card2_name': 'preview_card2_name',
            'card2_scientific_name': 'preview_card2_scientific_name',
            'card2_classification': 'preview_card2_classification',
            'card2_characteristics': 'preview_card2_characteristics',
            'card2_habitat': 'preview_card2_habitat',
            'card3_name': 'preview_card3_name',
            'card3_scientific_name': 'preview_card3_scientific_name',
            'card3_classification': 'preview_card3_classification',
            'card3_characteristics': 'preview_card3_characteristics',
            'card3_habitat': 'preview_card3_habitat',
            'card4_name': 'preview_card4_name',
            'card4_scientific_name': 'preview_card4_scientific_name',
            'card4_classification': 'preview_card4_classification',
            'card4_characteristics': 'preview_card4_characteristics',
            'card4_habitat': 'preview_card4_habitat',
            'card5_name': 'preview_card5_name',
            'card5_scientific_name': 'preview_card5_scientific_name',
            'card5_classification': 'preview_card5_classification',
            'card5_characteristics': 'preview_card5_characteristics',
            'card5_habitat': 'preview_card5_habitat',
        };

        const storageKey = 'scienceExperiment2ReportData';

        // ì´ë¯¸ì§€ ì••ì¶• ë° ë¦¬ì‚¬ì´ì§• í•¨ìˆ˜
        function compressImage(file, maxWidth = 800, quality = 0.8) {
            return new Promise((resolve, reject) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = function() {
                    try {
                        // ë¹„ìœ¨ ìœ ì§€í•˜ë©´ì„œ ë¦¬ì‚¬ì´ì§•
                        let { width, height } = img;
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        // ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // ì••ì¶•ëœ ì´ë¯¸ì§€ë¥¼ Blobìœ¼ë¡œ ë³€í™˜
                        canvas.toBlob((blob) => {
                            if (blob) {
                                // ì›ë³¸ íŒŒì¼ëª… ìœ ì§€í•˜ë©´ì„œ ìƒˆë¡œìš´ File ê°ì²´ ìƒì„±
                                const compressedFile = new File([blob], file.name, {
                                    type: 'image/jpeg',
                                    lastModified: Date.now()
                                });
                                resolve(compressedFile);
                            } else {
                                reject(new Error('ì´ë¯¸ì§€ ì••ì¶• ì‹¤íŒ¨'));
                            }
                        }, 'image/jpeg', quality);
                    } catch (error) {
                        reject(error);
                    }
                };
                
                img.onerror = () => reject(new Error('ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨'));
                img.src = URL.createObjectURL(file);
            });
        }

        // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬ í•¨ìˆ˜ (ê°œì„ ëœ ë²„ì „)
        window.handleImageUpload = async function(input, previewId) {
            const file = input.files[0];
            if (file) {
                try {
                    // íŒŒì¼ í¬ê¸° ì²´í¬ (10MB ì œí•œ)
                    if (file.size > 10 * 1024 * 1024) {
                        alert('ì´ë¯¸ì§€ íŒŒì¼ í¬ê¸°ê°€ 10MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤. ë” ì‘ì€ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                        input.value = '';
                        return;
                    }
                    
                    // íŒŒì¼ íƒ€ì… ì²´í¬
                    if (!file.type.startsWith('image/')) {
                        alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                        input.value = '';
                        return;
                    }
                    
                    // ë¡œë”© í‘œì‹œ
                    const preview = document.getElementById(previewId);
                    preview.innerHTML = `
                        <div class="flex items-center space-x-2 text-blue-600">
                            <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"></div>
                            <span class="text-sm">ì´ë¯¸ì§€ ì••ì¶• ì¤‘...</span>
                        </div>
                    `;
                    
                    // ì´ë¯¸ì§€ ì••ì¶•
                    const compressedFile = await compressImage(file);
                    
                    // Blob URL ìƒì„± (ë©”ëª¨ë¦¬ íš¨ìœ¨ì )
                    const blobUrl = URL.createObjectURL(compressedFile);
                    
                    preview.innerHTML = `
                        <div class="flex items-center space-x-2">
                            <img src="${blobUrl}" alt="ìƒë¬¼ ì‚¬ì§„" class="w-20 h-20 object-cover rounded-lg border border-gray-300">
                            <div class="text-sm text-gray-600">
                                <div class="font-semibold">${compressedFile.name}</div>
                                <div>${(compressedFile.size / 1024).toFixed(1)} KB (ì••ì¶•ë¨)</div>
                            </div>
                            <button type="button" onclick="removeImage('${input.id}', '${previewId}')" class="text-red-500 hover:text-red-700 text-sm">ì‚­ì œ</button>
                        </div>
                    `;
                    
                    // ì›ë³¸ íŒŒì¼ì„ ì••ì¶•ëœ íŒŒì¼ë¡œ êµì²´ (í˜¸í™˜ì„± ê°œì„ )
                    try {
                        if (window.DataTransfer && DataTransfer.prototype.items) {
                            const dataTransfer = new DataTransfer();
                            dataTransfer.items.add(compressedFile);
                            input.files = dataTransfer.files;
                            console.log('DataTransferë¡œ íŒŒì¼ êµì²´ ì„±ê³µ:', compressedFile.name);
                        } else {
                            // êµ¬í˜• ë¸Œë¼ìš°ì € ëŒ€ì‘: inputì„ ì¬ìƒì„±
                            const newInput = input.cloneNode();
                            newInput.files = [compressedFile];
                            input.parentNode.replaceChild(newInput, input);
                            newInput.addEventListener('change', () => handleImageUpload(newInput, previewId));
                            console.log('Input ì¬ìƒì„±ìœ¼ë¡œ íŒŒì¼ êµì²´ ì„±ê³µ:', compressedFile.name);
                        }
                    } catch (transferError) {
                        console.warn('DataTransfer API ì‚¬ìš© ì‹¤íŒ¨, ì›ë³¸ íŒŒì¼ ìœ ì§€:', transferError);
                        // DataTransfer ì‹¤íŒ¨ ì‹œ ì›ë³¸ íŒŒì¼ ìœ ì§€í•˜ë˜ ì••ì¶•ëœ íŒŒì¼ ì •ë³´ë¥¼ ì €ì¥
                        input._compressedFile = compressedFile;
                    }
                    
                    updatePreview();
                } catch (error) {
                    console.error('ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
                    const errorMessage = error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                    alert(`ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${errorMessage}`);
                    input.value = '';
                    document.getElementById(previewId).innerHTML = '';
                }
            }
        };

        // ì´ë¯¸ì§€ ì‚­ì œ í•¨ìˆ˜
        window.removeImage = function(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            if (input) {
                input.value = '';
                // ì••ì¶•ëœ íŒŒì¼ ì •ë³´ë„ ì‚­ì œ
                delete input._compressedFile;
            }
            
            if (preview) {
                preview.innerHTML = '';
            }
            
            updatePreview();
        };

        dom.tabs.forEach(tab => tab.addEventListener('click', () => switchTab(tab.dataset.tab)));
        if (dom.accordions) dom.accordions.forEach(button => button.addEventListener('click', toggleAccordion));
        dom.allInputs.forEach(input => input.addEventListener('input', updatePreviewAndSave));

        if (dom.downloadZipBtn) dom.downloadZipBtn.addEventListener('click', handleZipDownloadAndSubmit);
        if (dom.printBtn) dom.printBtn.addEventListener('click', printReport);
        if (dom.previewNewTabBtn) dom.previewNewTabBtn.addEventListener('click', openPreviewInNewTab);
        if (dom.retryUploadBtn) dom.retryUploadBtn.addEventListener('click', retryLastUpload);
        if (dom.clearBtn) dom.clearBtn.addEventListener('click', handleClearAll);

        // iOS Help Modal events
        if (dom.iosHelpCloseBtn) dom.iosHelpCloseBtn.addEventListener('click', () => hideModal(dom.iosHelpModal));
        if (dom.iosHelpDownloadBtn) dom.iosHelpDownloadBtn.addEventListener('click', () => {
            if (lastZipBlob && lastMeta?.zipFilename) triggerBlobDownload(lastZipBlob, lastMeta.zipFilename);
            dom.iosHelpModal.classList.add('hidden');
        });
        if (dom.iosHelpConfirmBtn) dom.iosHelpConfirmBtn.addEventListener('click', openIOSShare);

        // In-App Download Center events
        if (dom.inappCloseBtn) dom.inappCloseBtn.addEventListener('click', () => hideModal(dom.inappModal));
        if (dom.inappServerDownloadBtn) dom.inappServerDownloadBtn.addEventListener('click', () => {
            serverDownloadLastZip();
        });
        if (dom.inappRetryBtn) dom.inappRetryBtn.addEventListener('click', () => {
            serverDownloadLastZip(true);
        });

        // Close modals on ESC for accessibility
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (dom.iosHelpModal && !dom.iosHelpModal.classList.contains('hidden')) hideModal(dom.iosHelpModal);
                if (dom.inappModal && !dom.inappModal.classList.contains('hidden')) hideModal(dom.inappModal);
            }
        });

        loadFromBrowser();
        switchTab('guide1');
        updatePreview();

        // ì•„ì½”ë””ì–¸ ë©”ë‰´ë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë‘ í¼ì¹©ë‹ˆë‹¤.
        if (dom.accordions) dom.accordions.forEach(button => setAccordionState(button, true));

        // Hide PDF print button only on iOS and in-app browsers (Androidì—ì„œëŠ” ë…¸ì¶œ)
        const __env = detectInApp();
        if ((isIOS() || __env.isInApp) && dom.printBtn) {
            dom.printBtn.classList.add('hidden');
        }

        // --- Modal focus trap helpers ---
        let __lastTriggerEl = null;
        function getFocusable(el) {
            return el.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        }
        function showModal(el, triggerEl = null) {
            __lastTriggerEl = triggerEl || document.activeElement;
            el.classList.remove('hidden');
            const f = getFocusable(el);
            if (f.length) f[0].focus();
            function onKey(e) {
                if (e.key !== 'Tab') return;
                const focusables = Array.from(getFocusable(el));
                if (!focusables.length) return;
                const first = focusables[0];
                const last = focusables[focusables.length - 1];
                if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
                else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
            }
            el.__trapHandler = onKey;
            el.addEventListener('keydown', onKey);
        }
        function hideModal(el) {
            el.classList.add('hidden');
            if (el.__trapHandler) el.removeEventListener('keydown', el.__trapHandler);
            if (__lastTriggerEl && typeof __lastTriggerEl.focus === 'function') {
                __lastTriggerEl.focus();
            }
        }

        function switchTab(targetTabId) { 
            dom.tabs.forEach(t => t.classList.toggle('active', t.dataset.tab === targetTabId)); 
            dom.tabContents.forEach(content => content.classList.toggle('active', content.id === targetTabId)); 
            window.scrollTo(0,0); 
        }
        
        function setAccordionState(button, open = true) {
            const content = button.parentElement.nextElementSibling;
            const icon = button.querySelector('svg');
            button.classList.toggle('open', open);
            content.classList.toggle('open', open);
            if (open) {
                setTimeout(() => {
                    content.style.maxHeight = content.scrollHeight + 'px';
                    content.style.paddingTop = '1rem';
                    content.style.paddingBottom = '1rem';
                }, 10);
                if(icon) icon.style.transform = 'rotate(180deg)';
            } else {
                content.style.maxHeight = '0';
                content.style.paddingTop = '0';
                content.style.paddingBottom = '0';
                if(icon) icon.style.transform = 'rotate(0deg)';
            }
        }
        
        function toggleAccordion(event) { 
            const button = event.currentTarget;
            const isOpen = !button.classList.contains('open');
            setAccordionState(button, isOpen);
        }

        function updatePreviewAndSave() { updatePreview(); saveToBrowser(); }
        
        function updatePreview() { 
            // í•™ìƒ ì •ë³´ ì—…ë°ì´íŠ¸
            const studentGrade = document.getElementById('student_grade')?.value || '';
            const studentClass = document.getElementById('student_class')?.value || '';
            const studentNumber = document.getElementById('student_number')?.value || '';
            const studentName = document.getElementById('student_name')?.value || '';
            
            // ê° ì„¹ì…˜ë³„ í•™ìƒ ì •ë³´ ì—…ë°ì´íŠ¸
            const sections = [
                { prefix: 'plan', elements: ['preview_student_grade_plan', 'preview_student_class_plan', 'preview_student_number_plan', 'preview_student_name_plan'] },
                { prefix: 'report', elements: ['preview_student_grade_report', 'preview_student_class_report', 'preview_student_number_report', 'preview_student_name_report'] },
                { prefix: 'card', elements: ['preview_student_grade_card', 'preview_student_class_card', 'preview_student_number_card', 'preview_student_name_card'] }
            ];
            
            sections.forEach(section => {
                const gradeEl = document.getElementById(section.elements[0]);
                const classEl = document.getElementById(section.elements[1]);
                const numberEl = document.getElementById(section.elements[2]);
                const nameEl = document.getElementById(section.elements[3]);
                
                if (gradeEl) gradeEl.textContent = studentGrade || '1';
                if (classEl) classEl.textContent = studentClass || '0';
                if (numberEl) numberEl.textContent = studentNumber || '00';
                if (nameEl) nameEl.textContent = studentName || 'ã…‡ã…‡ã…‡';
            });
            
            // ê¸°ì¡´ ì œëª©/í•™ìƒì •ë³´ ì„¹ì…˜ì˜ í•™ìƒ ì •ë³´ë„ ì—…ë°ì´íŠ¸ (ë¯¸ë¦¬ë³´ê¸°ìš©)
            const gradeEl = document.getElementById('preview_student_grade');
            const classEl = document.getElementById('preview_student_class');
            const numberEl = document.getElementById('preview_student_number');
            const nameEl = document.getElementById('preview_student_name');
            
            if (gradeEl) gradeEl.textContent = studentGrade || '1';
            if (classEl) classEl.textContent = studentClass || '0';
            if (numberEl) numberEl.textContent = studentNumber || '00';
            if (nameEl) nameEl.textContent = studentName || 'ã…‡ã…‡ã…‡';
            
            // ë¨¸ë¦¬ë§ìš© data-student-info ì†ì„± ì—…ë°ì´íŠ¸
            const headerSection = document.querySelector('.header-section');
            if (headerSection) {
                const studentInfo = `${studentGrade || '1'}í•™ë…„ ${studentClass || '0'}ë°˜ ${studentNumber || '00'}ë²ˆ ${studentName || 'ã…‡ã…‡ã…‡'}`;
                headerSection.setAttribute('data-student-info', studentInfo);
            }
            
            // ì¸ì‡„ìš© ë¨¸ë¦¬ë§ í•™ìƒ ì •ë³´ ì—…ë°ì´íŠ¸
            const printStudentInfo = document.getElementById('print-student-info');
            if (printStudentInfo) {
                const studentInfo = `${studentGrade || '1'}í•™ë…„ ${studentClass || '0'}ë°˜ ${studentNumber || '00'}ë²ˆ ì´ë¦„: ${studentName || 'ã…‡ã…‡ã…‡'}`;
                printStudentInfo.textContent = studentInfo;
            }
            
            // ì¼ë°˜ í•„ë“œë“¤ ì²˜ë¦¬
            Object.entries(fields).forEach(([fieldId, previewId]) => { 
                const inputEl = document.getElementById(fieldId); 
                const previewEl = document.getElementById(previewId); 
                if (!inputEl || !previewEl) return; 
                
                const value = inputEl.value.trim(); 
                const placeholderSpan = previewEl.querySelector('.preview-placeholder'); 
                const placeholderText = placeholderSpan ? placeholderSpan.textContent : `[${fieldId}]`; 
                if (value) { 
                    previewEl.textContent = value; 
                } else { 
                    previewEl.innerHTML = `<span class="preview-placeholder">${placeholderText}</span>`; 
                } 
            });
            
            // ì¡°ì‚¬ ê¸°ë³¸ ì •ë³´ ì¡°í•©
            const surveyDate = document.getElementById('survey_date')?.value || '';
            const surveyPeriod = document.getElementById('survey_period')?.value || '';
            const weather = document.getElementById('weather')?.value || '';
            
            const surveyInfoParts = [];
            if (surveyDate) surveyInfoParts.push(`ì¡°ì‚¬ ë‚ ì§œ: ${surveyDate}`);
            if (surveyPeriod) surveyInfoParts.push(`ì¡°ì‚¬ ê¸°ê°„: ${surveyPeriod}`);
            if (weather) surveyInfoParts.push(`ë‚ ì”¨: ${weather}`);
            
            const surveyInfoEl = document.getElementById('preview_survey_info');
            if (surveyInfoEl) {
                if (surveyInfoParts.length > 0) {
                    surveyInfoEl.textContent = surveyInfoParts.join(', ');
                } else {
                    surveyInfoEl.innerHTML = `<span class="preview-placeholder">ì¡°ì‚¬ ë‚ ì§œ, ì¡°ì‚¬ ê¸°ê°„, ë‚ ì”¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”</span>`;
                }
            }
            
            // ë°œê²¬í•œ ìƒë¬¼ì˜ ì¢… ìˆ˜ ì¡°í•©
            const animalCount = document.getElementById('animal_species_count')?.value || '';
            const plantCount = document.getElementById('plant_species_count')?.value || '';
            
            const speciesCountEl = document.getElementById('preview_species_count');
            if (speciesCountEl) {
                if (animalCount || plantCount) {
                    const animalText = animalCount ? `ë™ë¬¼ ${animalCount}ì¢…` : '';
                    const plantText = plantCount ? `ì‹ë¬¼ ${plantCount}ì¢…` : '';
                    const separator = animalCount && plantCount ? ', ' : '';
                    speciesCountEl.textContent = `${animalText}${separator}${plantText}`;
                } else {
                    speciesCountEl.innerHTML = `<span class="preview-placeholder">ë™ë¬¼ê³¼ ì‹ë¬¼ ì¢… ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”</span>`;
                }
            }
            
            // ë°œê²¬í•œ ìƒë¬¼ì˜ íŠ¹ì§• ì¡°í•© (8ê°œ) - í‘œ í˜•ì‹ìœ¼ë¡œ ì—…ë°ì´íŠ¸
            for (let i = 1; i <= 8; i++) {
                const name = document.getElementById(`species${i}_name`)?.value.trim() || '';
                const scientificName = document.getElementById(`species${i}_scientific_name`)?.value.trim() || '';
                const location = document.getElementById(`species${i}_location`)?.value.trim() || '';
                const characteristics = document.getElementById(`species${i}_characteristics`)?.value.trim() || '';
                
                // ê° ì…€ì„ ê°œë³„ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸
                const nameEl = document.getElementById(`preview_species${i}_name`);
                const scientificNameEl = document.getElementById(`preview_species${i}_scientific_name`);
                const locationEl = document.getElementById(`preview_species${i}_location`);
                const characteristicsEl = document.getElementById(`preview_species${i}_characteristics`);
                
                if (nameEl) nameEl.textContent = name || '-';
                if (scientificNameEl) scientificNameEl.textContent = scientificName || '-';
                if (locationEl) locationEl.textContent = location || '-';
                if (characteristicsEl) characteristicsEl.textContent = characteristics || '-';
            }
            
            // ìƒë¬¼ ì¹´ë“œ ì •ë³´ ì¡°í•©
            for (let i = 1; i <= 5; i++) {
                const name = document.getElementById(`card${i}_name`)?.value.trim() || '';
                const scientificName = document.getElementById(`card${i}_scientific_name`)?.value.trim() || '';
                const classification = document.getElementById(`card${i}_classification`)?.value.trim() || '';
                const characteristics = document.getElementById(`card${i}_characteristics`)?.value.trim() || '';
                const habitat = document.getElementById(`card${i}_habitat`)?.value.trim() || '';
                
                const cardParts = [];
                if (name) cardParts.push(`ì´ë¦„: ${name}`);
                if (scientificName) cardParts.push(`í•™ëª…: ${scientificName}`);
                if (classification) cardParts.push(`ë¶„ë¥˜: ${classification}`);
                if (characteristics) cardParts.push(`íŠ¹ì§•: ${characteristics}`);
                if (habitat) cardParts.push(`ì„œì‹ì§€: ${habitat}`);
                
                const cardEl = document.getElementById(`preview_card${i}`);
                if (cardEl) {
                    if (cardParts.length > 0) {
                        cardEl.textContent = cardParts.join('\n');
                    } else {
                        cardEl.innerHTML = `<span class="preview-placeholder">ìƒë¬¼ ì¹´ë“œ ${i} ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</span>`;
                    }
                }
                
                // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ (Blob URL ì‚¬ìš©)
                const imageInput = document.getElementById(`card${i}_image`);
                const imagePreviewEl = document.getElementById(`preview_card${i}_image`);
                if (imageInput && imagePreviewEl) {
                    if (imageInput.files && imageInput.files[0]) {
                        const blobUrl = URL.createObjectURL(imageInput.files[0]);
                        imagePreviewEl.innerHTML = `
                            <div class="text-center">
                                <img src="${blobUrl}" alt="ìƒë¬¼ ì‚¬ì§„" class="max-w-xs mx-auto rounded-lg border border-gray-300 shadow-sm">
                            </div>
                        `;
                    } else {
                        imagePreviewEl.innerHTML = '';
                    }
                }
            }
        }

        function getFormData() { 
            const data = {}; 
            dom.allInputs.forEach(input => data[input.id] = input.value); 
            return data; 
        }
        
        function saveToBrowser() { 
            localStorage.setItem(storageKey, JSON.stringify(getFormData())); 
            showToast('ìë™ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.'); 
        }
        
        function loadFromBrowser() { 
            const saved = localStorage.getItem(storageKey); 
            if (!saved) return; 
            const data = JSON.parse(saved); 
            Object.entries(data).forEach(([k,v]) => { 
                const el = document.getElementById(k); 
                if (el) el.value = v; 
            }); 
            updatePreview(); 
        }
        
        function showToast(message) { 
            const toast = dom.toast; 
            if (!toast) return; 
            toast.textContent = message; 
            toast.style.opacity = 1; 
            setTimeout(()=>{ toast.style.opacity = 0; }, 1200); 
        }
        
        function handleClearAll(){ 
            try{ 
                const ok=window.confirm('ì…ë ¥í•œ ë‚´ìš©ì„ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ì–´ìš”?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); 
                if(!ok) return; 
                clearFormAndStorage(); 
                showToast('ì…ë ¥ ë‚´ìš©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'); 
            }catch(_){} 
        }
        
        function clearFormAndStorage(){ 
            try{ 
                localStorage.removeItem(storageKey); 
                localStorage.removeItem(SUBMIT_META_KEY); 
            }catch(_){} 
            Array.from(dom.allInputs).forEach(el=>{ 
                if(el.tagName==='INPUT' || el.tagName==='TEXTAREA' || el.tagName==='SELECT'){ 
                    el.value=''; 
                } 
            }); 
            if (typeof lastZipBlob!=='undefined') lastZipBlob=null; 
            if (typeof lastMeta!=='undefined') lastMeta=null; 
            setStatus(''); 
            updatePreview(); 
        }
        
        function escapeHtml(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\"/g,'&quot;').replace(/'/g,'&#39;');}

        function getReportFilename(){ 
            const grade=(document.getElementById('student_grade').value||'1').trim(); 
            const studentClass=(document.getElementById('student_class').value||'0').trim().padStart(2,'0'); 
            const studentNumber=(document.getElementById('student_number').value||'0').trim().padStart(2,'0'); 
            const studentId=`${grade}${studentClass}${studentNumber}`; 
            const studentName=document.getElementById('student_name').value.trim()||'ì´ë¦„ì—†ìŒ'; 
            return `${studentId}_${studentName}_ìŠ¤ë§ˆíŠ¸ê¸°ê¸°ìƒë¬¼ì¡°ì‚¬`; 
        }
        
        function printReport(){ 
            const originalTitle=document.title; 
            document.title=getReportFilename(); 
            window.print(); 
            setTimeout(()=>{ document.title=originalTitle; }, 500); 
        }
        
        function openPreviewInNewTab(){ 
            try{ 
                // ëª¨ë“  ì„¹ì…˜ì˜ ë‚´ìš©ì„ ìˆ˜ì§‘í•˜ì—¬ í•˜ë‚˜ì˜ ë¬¸ì„œë¡œ êµ¬ì„±
                const sections = document.querySelectorAll('.printable-area.report-page');
                let reportContent = '<div class="printable-area report-page">';
                sections.forEach((section, index) => {
                    // ê° ì„¹ì…˜ì˜ ë‚´ìš©ë§Œ ì¶”ì¶œ (div íƒœê·¸ ì œê±°)
                    const sectionContent = section.innerHTML;
                    reportContent += sectionContent;
                    
                    // ë§ˆì§€ë§‰ ì„¹ì…˜ì´ ì•„ë‹ˆë©´ í˜ì´ì§€ ë¸Œë ˆì´í¬ ì¶”ê°€
                    if (index < sections.length - 1) {
                        reportContent += '<div class="page-break-before"></div>';
                    }
                });
                reportContent += '</div>';
                
                const now=new Date(); 
                const ts=`${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}${String(now.getDate()).padStart(2,'0')}-${String(now.getHours()).padStart(2,'0')}${String(now.getMinutes()).padStart(2,'0')}${String(now.getSeconds()).padStart(2,'0')}`; 
                const title=`ë¯¸ë¦¬ë³´ê¸°-ìŠ¤ë§ˆíŠ¸ê¸°ê¸°ìƒë¬¼ì¡°ì‚¬-${ts}`; 
                const docHtml=generateDocHtml(title, reportContent); 
                const blob=new Blob([docHtml],{type:'text/html'}); 
                const url=URL.createObjectURL(blob); 
                window.open(url,'_blank'); 
                setTimeout(()=>URL.revokeObjectURL(url),10000);
            }catch(_){}
        }

        function setStatus(text){ if (dom.submitStatus) dom.submitStatus.textContent=text||''; }
        function showProgress(show){ const c=document.getElementById('progress_container'); if(!c) return; c.classList.toggle('hidden', !show); c.setAttribute('aria-hidden', show?'false':'true'); }
        function setProgress(percent,label=''){ const bar=document.getElementById('progress_bar'); const txt=document.getElementById('progress_text'); if(bar) bar.style.width=`${Math.max(0,Math.min(100,percent))}%`; if(txt) txt.textContent=label||''; }

        const ENDPOINT='/.netlify/functions/submit';
        const SUBMIT_KEY='S-2025-github2025subject';
        const SUBJECT=document.querySelector('meta[name="submission-subject"]')?.content||'ê³¼í•™íƒêµ¬ì‹¤í—˜2';
        const ACTIVITY_INPUT_DEFAULT=document.querySelector('meta[name="submission-activity"]')?.content||'ìŠ¤ë§ˆíŠ¸ê¸°ê¸°ìƒë¬¼ì¡°ì‚¬';
        const SUBMIT_META_KEY='submit_meta_scienceExperiment2';

        ['student_grade','student_class','student_number','student_name'].forEach(id=>{ const el=document.getElementById(id); if(el) el.addEventListener('input', saveSubmitMeta); });
        loadSubmitMeta();
        
        function saveSubmitMeta(){ 
            const meta={ 
                grade:document.getElementById('student_grade')?.value||'', 
                class:document.getElementById('student_class')?.value||'', 
                number:document.getElementById('student_number')?.value||'', 
                name:document.getElementById('student_name')?.value||'' 
            }; 
            try{ localStorage.setItem(SUBMIT_META_KEY, JSON.stringify(meta)); }catch(_){} 
        }
        
        function loadSubmitMeta(){ 
            try{ 
                const raw=localStorage.getItem(SUBMIT_META_KEY); 
                if(!raw) return; 
                const meta=JSON.parse(raw); 
                if(meta.grade!=null) document.getElementById('student_grade').value=meta.grade; 
                if(meta.class!=null) document.getElementById('student_class').value=meta.class; 
                if(meta.number!=null) document.getElementById('student_number').value=meta.number; 
                if(meta.name!=null) document.getElementById('student_name').value=meta.name; 
            }catch(_){} 
        }

        function generateDocHtml(dynamicTitle, reportInnerHtml){ 
            return `<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>${dynamicTitle}</title><script src="https://cdn.tailwindcss.com"><\/script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Nanum+Myeongjo:wght@400;700&display=swap" rel="stylesheet"><style>body{font-family:'Noto Sans KR','Inter',sans-serif;background-color:#f3f4f6;margin:0}*{color:inherit !important}.report-page{background-color:#fff;padding:2.5cm 2cm;box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.05);color:#1f2937}.printable-area{width:100%}.report-main-title{font-family:'Noto Sans KR',sans-serif;font-size:1.875rem;font-weight:700;text-align:center;margin-bottom:1rem;border-bottom:2px solid #111827;padding-bottom:1rem}.report-section-title{font-family:'Noto Sans KR',sans-serif;font-size:1.5rem;font-weight:700;color:#111827;margin-top:2.5rem;margin-bottom:1rem;padding-bottom:.5rem;border-bottom:1px solid #d1d5db}.preview-text{white-space:pre-wrap;word-break:break-word;min-height:2.5em;line-height:1.8;color:#374151;font-family:'Nanum Myeongjo',serif}.preview-text a{color:#2563eb !important;text-decoration:underline}.preview-placeholder{color:#9ca3af !important;font-style:italic}.page-break-before{page-break-before:always}.section-header{border-bottom:2px solid #3B82F6;padding-bottom:12px;margin-bottom:20px}.section-title{color:#1F2937;font-size:1.5rem;font-weight:bold;margin-bottom:8px}.section-subtitle{color:#6B7280;font-size:0.9rem;font-weight:500}@page{size:A4 portrait;margin:2cm}@media print{body *{visibility:hidden}.printable-area,.printable-area *{visibility:visible}.printable-area{position:absolute;left:0;top:0;width:100%;padding:0;margin:0;box-shadow:none;border:none}.no-print{display:none}.page-break-before{page-break-before:always}}</style></head><body><div class="report-page">${reportInnerHtml}</div></body></html>`; 
        }

        function calcSectionCode(grade,klass){ const g=String(grade||'').trim(); const k=String(klass||'').trim().padStart(2,'0'); return `${g}${k}`; }
        function calcStudentId(grade,klass,number){ const g=String(grade||'').trim(); const k=String(klass||'').trim().padStart(2,'0'); const n=String(number||'').trim().padStart(2,'0'); return `${g}${k}${n}`; }

        function validateForm(){ 
            const gradeEl=document.getElementById('student_grade'); 
            const classEl=document.getElementById('student_class'); 
            const numberEl=document.getElementById('student_number'); 
            const nameEl=document.getElementById('student_name'); 
            const grade=parseInt((gradeEl.value||'').trim(),10); 
            const klass=parseInt((classEl.value||'').trim(),10); 
            const number=parseInt((numberEl.value||'').trim(),10); 
            const name=(nameEl.value||'').trim(); 
            if(Number.isNaN(grade)||grade<1||grade>3){ showToast('í•™ë…„ì€ 1~3 ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.'); gradeEl.focus(); return null; } 
            if(Number.isNaN(klass)||klass<1||klass>20){ showToast('ë°˜ì€ 1~20 ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.'); classEl.focus(); return null; } 
            if(Number.isNaN(number)||number<1||number>40){ showToast('ë²ˆí˜¸ëŠ” 1~40 ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤.'); numberEl.focus(); return null; } 
            if(!name){ showToast('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.'); nameEl.focus(); return null; } 
            return { grade, klass, number, name }; 
        }

        async function blobToBase64(blob){ 
            return await new Promise((resolve,reject)=>{ 
                const reader=new FileReader(); 
                reader.onload=()=>{ 
                    const result=reader.result||''; 
                    const commaIdx=String(result).indexOf(','); 
                    const b64=commaIdx>=0?String(result).slice(commaIdx+1):String(result); 
                    resolve(b64); 
                }; 
                reader.onerror=()=>reject(reader.error); 
                reader.readAsDataURL(blob); 
            }); 
        }
        
        function bytesFromBase64(b64){ const len=b64.length; const pad=(b64.endsWith('==')?2:(b64.endsWith('=')?1:0)); return Math.floor((len*3)/4)-pad; }

        function triggerBlobDownload(blob, filename){ 
            try{ 
                const a=document.createElement('a'); 
                a.href=URL.createObjectURL(blob); 
                a.download=filename; 
                document.body.appendChild(a); 
                a.click(); 
                document.body.removeChild(a); 
                URL.revokeObjectURL(a.href); 
                showToast('ZIP íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.'); 
                return true; 
            }catch(_){ return false; } 
        }
        
        async function saveWithPicker(blob, filename){ 
            try{ 
                const opts={ suggestedName: filename, types:[{ description:'ZIP file', accept:{'application/zip':['.zip']} }] }; 
                const handle=await window.showSaveFilePicker(opts); 
                const writable=await handle.createWritable(); 
                await writable.write(blob); 
                await writable.close(); 
                return true; 
            }catch(_){ return false; } 
        }
        
        // --- Helpers for iOS detection & download/share ---
        function isIOS() {
            const ua = navigator.userAgent || navigator.vendor || '';
            const iOSDevice = /iPad|iPhone|iPod/.test(ua);
            const iPadOSDesktopUA = navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1;
            return iOSDevice || iPadOSDesktopUA;
        }

        function detectInApp(){ 
            const uaRaw=navigator.userAgent||navigator.vendor||''; 
            const ua=uaRaw.toLowerCase(); 
            const isIOS=/iphone|ipad|ipod/.test(ua)||(navigator.platform==='MacIntel'&&navigator.maxTouchPoints>1); 
            const isAndroid=/android/.test(ua); 
            const isSamsung=/samsungbrowser/i.test(uaRaw); 
            const isKakao=/kakaotalk/.test(ua); 
            const isNaver=/naver/.test(ua); 
            const isFB=/fban|fbav|fb_iab/.test(ua); 
            const isIG=/instagram/.test(ua); 
            const isLine=/ line\//.test(ua); 
            const isIOSWebView=isIOS && !!window.webkit && !!window.webkit.messageHandlers && !/safari/i.test(uaRaw); 
            const isInApp=isKakao||isNaver||isFB||isIG||isLine||isIOSWebView; 
            let app = null;
            if (isKakao) app = 'kakao'; else if (isNaver) app = 'naver'; else if (isIG) app = 'instagram'; else if (isFB) app = 'facebook'; else if (isLine) app = 'line'; else if (isIOSWebView) app = 'ios-webview';
            return { isInApp, app, isIOS, isAndroid, isSamsung }; 
        }

        async function openIOSShare() {
            try {
                if (!lastZipBlob || !lastMeta?.zipFilename) {
                    showToast('ê³µìœ í•  íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                const zipFile = new File([lastZipBlob], lastMeta.zipFilename, { type: 'application/zip' });
                if (navigator.canShare && navigator.canShare({ files: [zipFile] }) && typeof navigator.share === 'function') {
                    await navigator.share({ files: [zipFile], title: lastMeta.zipFilename, text: 'íŒŒì¼ ì•±ì—ì„œ ì €ì¥ ìœ„ì¹˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.' });
                    showToast('ê³µìœ  ì‹œíŠ¸ê°€ ì—´ë ¸ìŠµë‹ˆë‹¤. "íŒŒì¼ì— ì €ì¥"ì„ ì„ íƒí•˜ì„¸ìš”.');
                } else {
                    triggerBlobDownload(lastZipBlob, lastMeta.zipFilename);
                }
            } catch (e) {
                triggerBlobDownload(lastZipBlob, lastMeta.zipFilename);
            } finally {
                if (dom.iosHelpModal) dom.iosHelpModal.classList.add('hidden');
            }
        }

        async function attemptLocalDownloadAndVerify(zipFilename){ 
            const env=detectInApp(); 
            if (env.isInApp){ 
                setStatus('ë¡œì»¬ ë‹¤ìš´ë¡œë“œê°€ ì œí•œë˜ì–´ ì„œë²„ ë‹¤ìš´ë¡œë“œë¡œ ì „í™˜í•©ë‹ˆë‹¤.'); 
                if (dom.inappModal) showModal(dom.inappModal, dom.downloadZipBtn);
                try { serverDownloadLastZip(); } catch(_) {}
                return; 
            } 
            if (isIOS()){ 
                setStatus('iOS ì €ì¥ ì•ˆë‚´ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.'); 
                if (dom.iosHelpModal) showModal(dom.iosHelpModal, dom.downloadZipBtn);
                return; 
            }
            let localSaved=false; 
            let usedPicker=false; 
            if (window.showSaveFilePicker && lastZipBlob){ 
                usedPicker=true; 
                localSaved=await saveWithPicker(lastZipBlob, zipFilename); 
            }
            if (!localSaved && lastZipBlob){ 
                try{ 
                    localSaved=triggerBlobDownload(lastZipBlob, zipFilename)===true; 
                }catch(_){ localSaved=false; } 
            }
            if (env.isAndroid || env.isSamsung){ 
                if (!usedPicker) localSaved=false; 
            }
            if (localSaved){ 
                setStatus('âœ… ë¡œì»¬ ë‹¤ìš´ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.'); 
                showToast('ë¡œì»¬ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ'); 
            } else { 
                setStatus('ë¡œì»¬ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨ ë˜ëŠ” ì œí•œë¨, ì„œë²„ì—ì„œ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.'); 
                if (dom.inappModal) showModal(dom.inappModal, dom.downloadZipBtn);
                try { serverDownloadLastZip(); } catch(_) {}
            }
        }

        function trackServerDownload(token, timeoutMs=5000){ 
            const deadline=Date.now()+timeoutMs; 
            const key=`download_ok_${encodeURIComponent(token)}=`; 
            const timer=setInterval(()=>{ 
                const found=document.cookie.includes(key); 
                if (found){ 
                    clearInterval(timer); 
                    setStatus('âœ… ë¡œì»¬ ì €ì¥(ì„œë²„ ì²¨ë¶€) í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.'); 
                    showToast('ë‹¤ìš´ë¡œë“œ ì™„ë£Œ í™•ì¸'); 
                } else if (Date.now()>deadline){ 
                    clearInterval(timer); 
                } 
            }, 300); 
        }

        let __inappRetryCount = 0;
        const __inappRetryMax = 2;
        function setInappRetryVisibility(show) {
            if (!dom.inappRetryBtn) return;
            dom.inappRetryBtn.classList.toggle('hidden', !show);
        }
        function serverDownloadLastZip(isManualRetry = false) {
            try {
                if (!lastZipBlob || !lastMeta?.zipFilename) {
                    showToast('ë‹¤ìš´ë¡œë“œí•  íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                blobToBase64(lastZipBlob).then((b64) => {
                    try {
                        const token = `${Date.now()}_${Math.random().toString(36).slice(2,8)}`;
                        trackServerDownload(token, 3500);
                        const form = document.createElement('form');
                        form.method = 'POST';
                        form.action = '/.netlify/functions/download';
                        form.target = '_blank';
                        const add = (n, v) => { const i = document.createElement('input'); i.type = 'hidden'; i.name = n; i.value = v; form.appendChild(i); };
                        add('filename', lastMeta.zipFilename);
                        add('mime', 'application/zip');
                        add('contentBase64', b64);
                        add('token', token);
                        document.body.appendChild(form);
                        form.submit();
                        document.body.removeChild(form);
                        showToast('ì„œë²„ì—ì„œ ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.');
                        __inappRetryCount = 0;
                        setInappRetryVisibility(false);
                        if (dom.inappModal) hideModal(dom.inappModal);
                    } catch (e) {
                        throw e;
                    }
                }).catch(() => {
                    throw new Error('base64 ë³€í™˜ ì‹¤íŒ¨');
                });
            } catch (_) {
                __inappRetryCount += 1;
                if (__inappRetryCount <= __inappRetryMax) {
                    setInappRetryVisibility(true);
                    showToast(`ì„œë²„ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì¬ì‹œë„ ê°€ëŠ¥ (${__inappRetryCount}/${__inappRetryMax})`);
                } else {
                    setInappRetryVisibility(false);
                    showToast('ì„œë²„ ë‹¤ìš´ë¡œë“œì— ë°˜ë³µ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');
                }
            }
        }

        let lastZipBlob=null; 
        let lastMeta=null;

        async function handleZipDownloadAndSubmit(){ 
            try{
                setStatus('í•™ìƒ ì •ë³´ ê²€ì¦ ì¤‘â€¦'); 
                dom.retryUploadBtn.dataset.show=''; 
                dom.retryUploadBtn.classList.add('hidden'); 
                const form=validateForm(); 
                if(!form) return; 
                showProgress(true); 
                setProgress(10,'ë¬¸ì„œ ìƒì„± ì¤€ë¹„...');
                const section=calcSectionCode(form.grade, form.klass); 
                const studentId=calcStudentId(form.grade, form.klass, form.number); 
                const docTitle='ê³¼í•™íƒêµ¬ì‹¤í—˜2 ìˆ˜í–‰í‰ê°€4 - ìŠ¤ë§ˆíŠ¸ ê¸°ê¸°ë¥¼ ì´ìš©í•˜ì—¬ ì£¼ë³€ì˜ ìƒë¬¼ ì¡°ì‚¬í•˜ê¸°';
                const fmt=new Intl.DateTimeFormat('ko-KR',{ timeZone:'Asia/Seoul', year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false });
                const parts=Object.fromEntries(fmt.formatToParts(new Date()).map(p=>[p.type,p.value])); 
                const timestamp=`${parts.year}${parts.month}${parts.day}_${parts.hour}${parts.minute}${parts.second}`;
                const baseName=`${studentId}_${form.name}_${docTitle}_${timestamp}`; 
                const htmlFilename=`${baseName}.html`; 
                const zipFilename=`${baseName}.zip`;
                setStatus('ZIP íŒŒì¼ ìƒì„± ì¤‘â€¦'); 
                setProgress(25,'ZIP ìƒì„± ì¤‘...'); 
                // ëª¨ë“  ì„¹ì…˜ì˜ ë‚´ìš©ì„ ìˆ˜ì§‘í•˜ì—¬ í•˜ë‚˜ì˜ ë¬¸ì„œë¡œ êµ¬ì„±
                const sections = document.querySelectorAll('.printable-area.report-page');
                let reportContent = '<div class="printable-area report-page">';
                sections.forEach((section, index) => {
                    // ê° ì„¹ì…˜ì˜ ë‚´ìš©ë§Œ ì¶”ì¶œ (div íƒœê·¸ ì œê±°)
                    const sectionContent = section.innerHTML;
                    reportContent += sectionContent;
                    
                    // ë§ˆì§€ë§‰ ì„¹ì…˜ì´ ì•„ë‹ˆë©´ í˜ì´ì§€ ë¸Œë ˆì´í¬ ì¶”ê°€
                    if (index < sections.length - 1) {
                        reportContent += '<div class="page-break-before"></div>';
                    }
                });
                reportContent += '</div>';
                const docHtml=generateDocHtml(baseName, reportContent);
                const zip=new JSZip(); 
                zip.file(htmlFilename, docHtml);
                console.log('HTML íŒŒì¼ ì¶”ê°€ ì™„ë£Œ:', htmlFilename); 
                
                // ì´ë¯¸ì§€ íŒŒì¼ë“¤ì„ ZIPì— ì¶”ê°€
                let imageCount = 0;
                for (let i = 1; i <= 5; i++) {
                    const imageInput = document.getElementById(`card${i}_image`);
                    if (imageInput && imageInput.files && imageInput.files[0]) {
                        try {
                            imageCount++;
                            // ì••ì¶•ëœ íŒŒì¼ì´ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ ì›ë³¸ íŒŒì¼ ì‚¬ìš©
                            const imageFile = imageInput._compressedFile || imageInput.files[0];
                            
                            // íŒŒì¼ëª… ì•ˆì „ì„± ê²€ì‚¬
                            const safeFileName = imageFile.name.replace(/[^a-zA-Z0-9ê°€-í£._-]/g, '_');
                            const fileName = `ìƒë¬¼ì¹´ë“œ${i}_${safeFileName}`;
                            
                            // íŒŒì¼ í¬ê¸° í™•ì¸ (5MB ì œí•œ)
                            if (imageFile.size > 5 * 1024 * 1024) {
                                console.warn(`ì´ë¯¸ì§€ íŒŒì¼ ${i}ì´ ë„ˆë¬´ í½ë‹ˆë‹¤: ${imageFile.size} bytes`);
                                continue;
                            }
                            
                            zip.file(fileName, imageFile);
                            console.log(`ì´ë¯¸ì§€ íŒŒì¼ ì¶”ê°€: ${fileName} (${imageFile.size} bytes, ì••ì¶•ë¨: ${!!imageInput._compressedFile})`);
                        } catch (imageError) {
                            console.error(`ì´ë¯¸ì§€ íŒŒì¼ ${i} ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:`, imageError);
                        }
                    }
                }
                
                if (imageCount > 0) {
                    setProgress(35, `ì´ë¯¸ì§€ ${imageCount}ê°œ ì¶”ê°€ ì¤‘...`);
                }
                
                const zipBlob=await zip.generateAsync({type:'blob', compression:'DEFLATE', compressionOptions:{level:6}}); 
                lastZipBlob=zipBlob; 
                lastMeta={ studentId, name:form.name, zipFilename, section };
                const sizeBytes=zipBlob.size;
                console.log('ZIP ìƒì„± ì™„ë£Œ:', { sizeBytes, imageCount, zipFilename }); 
                if (sizeBytes>8*1024*1024){ 
                    setStatus('ì—…ë¡œë“œ ì‹¤íŒ¨: ZIP ìš©ëŸ‰ ì´ˆê³¼ (8MB)'); 
                    showToast('ZIP ìš©ëŸ‰ì´ 8MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.'); 
                    dom.retryUploadBtn.dataset.show='1'; 
                    dom.retryUploadBtn.classList.remove('hidden'); 
                    return; 
                }
                setStatus('ì €ì¥ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”'); 
                setProgress(45,'ì—…ë¡œë“œ ì¤€ë¹„...'); 
                const b64=await blobToBase64(zipBlob);
                if (!zipFilename.toLowerCase().endsWith('.zip')){ 
                    setStatus('ì—…ë¡œë“œ ì‹¤íŒ¨: ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹'); 
                    showToast('ZIP íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'); 
                    return; 
                }
                const activity=(ACTIVITY_INPUT_DEFAULT||'').trim();
                if(!activity){ 
                    setStatus('í™œë™ í´ë”ëª…ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. ë©”íƒ€ ë˜ëŠ” ì…ë ¥ê°’ì„ ì§€ì •í•˜ì„¸ìš”.'); 
                    showToast('í™œë™ í´ë”ëª…ì„ ì…ë ¥í•˜ê±°ë‚˜ ë©”íƒ€ë¥¼ ì„¤ì •í•˜ì„¸ìš”.'); 
                    return; 
                }
                const payload={ studentId:studentId, subject:SUBJECT, activity:activity, section:section, files:[{ filename:zipFilename, contentBase64:b64, mime:'application/zip' }] };
                console.log('ì„œë²„ ì œì¶œ ì‹œì‘:', { studentId, subject: SUBJECT, activity, section, zipFilename, payloadSize: JSON.stringify(payload).length });
                setProgress(60,'ì—…ë¡œë“œ ì¤‘...'); 
                const res=await fetch(ENDPOINT,{ method:'POST', headers:{ 'Content-Type':'application/json', 'X-Submission-Key':SUBMIT_KEY }, body:JSON.stringify(payload) });
                const text=await res.text(); 
                let data={}; 
                try{ data=JSON.parse(text); }catch(_){ data={ raw:text }; }
                if (!res.ok){ 
                    console.error('Submit failed:', { status: res.status, statusText: res.statusText, data, payload });
                    const errorMsg=data.error||data.detail||data.message||res.statusText||`HTTP ${res.status}`; 
                    throw new Error(`ì—…ë¡œë“œ ì‹¤íŒ¨: ${errorMsg}`); 
                }
                const uploadedFile=data.files?.[0]; 
                const filePath=uploadedFile?.name||zipFilename; 
                const fullPath=`/ê³¼ì œì œì¶œ/${SUBJECT}/${activity}/${section}/${studentId}/${filePath}`;
                setStatus(`âœ… ì œì¶œ ì™„ë£Œ! ì €ì¥ ê²½ë¡œ: ${fullPath} â€” ë‹¤ìš´ë¡œë“œ í™•ì¸ ì¤‘â€¦`); 
                setProgress(85,'ë‹¤ìš´ë¡œë“œ ì¤€ë¹„...');
                attemptLocalDownloadAndVerify(zipFilename); 
                setProgress(100,'ì™„ë£Œ'); 
                setTimeout(()=>showProgress(false),1500);
            }catch(err){ 
                const errorMessage=err?.message||err||'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'; 
                setStatus(`âŒ ì œì¶œ ì‹¤íŒ¨: ${errorMessage}`); 
                showToast(`ì œì¶œ ì‹¤íŒ¨: ${errorMessage}`); 
                setProgress(0,''); 
                showProgress(false); 
            }
        }

        async function retryLastUpload(){
            try{
                if(!lastZipBlob||!lastMeta){ showToast('ì¬ì‹œë„í•  í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
                setStatus('ì €ì¥ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”');
                showProgress(true);
                setProgress(45,'ì—…ë¡œë“œ ì¤€ë¹„...');
                const b64=await blobToBase64(lastZipBlob);
                const sizeBytes=bytesFromBase64(b64);
                if(sizeBytes>8*1024*1024){ setStatus('ì—…ë¡œë“œ ì‹¤íŒ¨: ZIP ìš©ëŸ‰ ì´ˆê³¼ (8MB)'); showToast('ZIP íŒŒì¼ ìš©ëŸ‰ì´ 8MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.'); return; }
                const activity=(ACTIVITY_INPUT_DEFAULT||'').trim();
                if(!activity){ setStatus('í™œë™ í´ë”ëª…ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. ë©”íƒ€ ë˜ëŠ” ì…ë ¥ê°’ì„ ì§€ì •í•˜ì„¸ìš”.'); showToast('í™œë™ í´ë”ëª…ì„ ì…ë ¥í•˜ê±°ë‚˜ ë©”íƒ€ë¥¼ ì„¤ì •í•˜ì„¸ìš”.'); return; }
                const payload={ studentId:lastMeta.studentId, subject:SUBJECT, activity:activity, section:lastMeta.section, files:[{ filename:lastMeta.zipFilename, contentBase64:b64, mime:'application/zip' }] };
                setProgress(60,'ì—…ë¡œë“œ ì¤‘...');
                const res=await fetch(ENDPOINT,{ method:'POST', headers:{ 'Content-Type':'application/json', 'X-Submission-Key':SUBMIT_KEY }, body:JSON.stringify(payload) });
                const text=await res.text();
                let data={};
                try{ data=JSON.parse(text); }catch(_){ data={ raw:text }; }
                if(!res.ok){ 
                    console.error('Retry submit failed:', { status: res.status, statusText: res.statusText, data, payload });
                    const reason=data.error||data.detail||data.message||res.statusText||'ì—…ë¡œë“œ ì‹¤íŒ¨'; 
                    setStatus(`ì œì¶œ ì‹¤íŒ¨: ${reason}`); 
                    showToast(`ì œì¶œ ì‹¤íŒ¨: ${reason}`); 
                    return; 
                }
                const uploadedFile=data.files?.[0];
                const filePath=uploadedFile?.name||lastMeta.zipFilename;
                const fullPath=`/ê³¼ì œì œì¶œ/${SUBJECT}/${activity}/${lastMeta.section}/${lastMeta.studentId}/${filePath}`;
                setStatus(`âœ… ì œì¶œ ì™„ë£Œ! ì €ì¥ ê²½ë¡œ: ${fullPath} â€” ë‹¤ìš´ë¡œë“œ í™•ì¸ ì¤‘â€¦`);
                setProgress(85,'ë‹¤ìš´ë¡œë“œ ì¤€ë¹„...');
                attemptLocalDownloadAndVerify(lastMeta.zipFilename);
                setProgress(100,'ì™„ë£Œ');
                setTimeout(()=>showProgress(false),1500);
            }catch(err){
                const errorMessage=err?.message||err||'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                setStatus(`âŒ ì œì¶œ ì‹¤íŒ¨: ${errorMessage}`);
                showToast(`ì œì¶œ ì‹¤íŒ¨: ${errorMessage}`);
            }
        }
    });
    </script>
</body>
</html>
