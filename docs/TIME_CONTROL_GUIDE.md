# 시간 기반 제어 기능 가이드

## 개요

특정 시간이나 기간으로 활성화/비활성화를 조정할 수 있는 유연한 시간 제어 시스템입니다.

## 🚀 새로운 기능

### 1. 다양한 시간 설정 방식
- **상대적 시간**: `+24h`, `+3d`, `+1w` (몇 시간/일/주 후)
- **한국 시간**: `2025-01-15 09:00 KST` (한국 시간 직접 입력)
- **시간 범위**: `2025-01-15T09:00:00Z,2025-01-15T17:00:00Z` (특정 기간만 활성화)
- **절대 시간**: `2025-01-15T00:00:00Z` (UTC 절대 시간)

### 2. 강화된 에러 처리
- 시간 함수 실패 시 **fail-open** 방식 적용
- 상세한 에러 메시지 및 디버깅 정보 제공
- 경고 토스트로 사용자에게 알림

### 3. 디버깅 기능
- 콘솔 로그를 통한 상세한 시간 정보 출력
- 서버 환경변수 정보 확인 가능
- 디버그 모드 활성화 (`DEBUG_TIME=true`)

## 사용 방법

### 환경변수 설정 (Netlify)

#### **상대적 시간 설정 (가장 편리)**
```bash
# 24시간 후 활성화
RELEASE_TIME_UTC=+24h

# 3일 후 활성화
RELEASE_TIME_UTC=+3d

# 1주일 후 활성화
RELEASE_TIME_UTC=+1w

# 즉시 활성화
RELEASE_TIME_UTC=+0h
```

#### **한국 시간 직접 입력 (가장 편리)**
```bash
# 한국 시간 오전 9시 (KST 명시)
RELEASE_TIME_UTC=2025-01-15 09:00 KST

# 한국 시간 오후 2시 (KST 명시)
RELEASE_TIME_UTC=2025-01-15 14:00 KST

# 한국 시간만 입력해도 자동 인식 (KST 생략 가능)
RELEASE_TIME_UTC=2025-01-15 09:00
RELEASE_TIME_UTC=2025-01-15 14:00
```

#### **한국 시간 기준 특정 기간만 활성화**
```bash
# 한국 시간 오전 9시부터 오후 5시까지만 활성화
RELEASE_TIME_UTC=2025-01-15 09:00,2025-01-15 17:00 KST

# 한국 시간 월요일 오전 9시부터 금요일 오후 5시까지만 활성화
RELEASE_TIME_UTC=2025-01-13 09:00,2025-01-17 17:00 KST

# KST 생략하고 한국 시간만 입력
RELEASE_TIME_UTC=2025-01-15 09:00,2025-01-15 17:00
RELEASE_TIME_UTC=2025-01-13 09:00,2025-01-17 17:00
```

#### **기타 설정**
```bash
# 디버그 모드 활성화
DEBUG_TIME=true

# 교사 키 (기존)
TEACHER_ACCESS_KEY=your_teacher_key_here
```

### URL 파라미터로 테스트

#### **즉시 활성화 테스트**
```
?release_time=+0h
?release_time=-1h
```

#### **특정 시간 후 테스트**
```
?release_time=+2h
?release_time=+1d
```

#### **한국 시간 테스트**
```
?release_time=2025-01-15 09:00 KST
?release_time=2025-01-15 14:00
```

#### **한국 시간 범위 테스트**
```
?release_time=2025-01-15 09:00,2025-01-15 17:00 KST
?release_time=2025-01-15 09:00,2025-01-15 17:00
```

### 교사 키 우선순위

1. **교사 키**: URL에 `?key=teacher_key` 또는 세션에 저장된 키
2. **시간 기반**: 환경변수 또는 URL 파라미터로 설정된 시간
3. **기본값**: 하드코딩된 기본 시간

## 디버깅

### 브라우저 콘솔에서 확인할 수 있는 정보

```javascript
// 시간 확인 과정
Checking time-based unlock...
Server time: 2025-01-15T10:30:00.000Z
Local time: 2025-01-15T19:30:00.000Z
Using server environment release time: 2025-10-12T15:00:00.000Z
Release time: 2025-10-12T15:00:00.000Z
Time until release: 216 hours
Time unlock: false
Buttons locked until release
```

### 서버 응답 예시

```json
{
  "now": 1737027000000,
  "iso": "2025-01-15T10:30:00.000Z",
  "timezone": "UTC",
  "debug": true,
  "releaseTime": 1728759600000,
  "releaseTimeISO": "2025-10-12T15:00:00.000Z",
  "isReleased": false,
  "hoursUntilRelease": 216,
  "localTime": "Wed Jan 15 2025 19:30:00 GMT+0900 (KST)",
  "environment": {
    "releaseTimeEnv": "2025-10-12T15:00:00Z",
    "debugMode": true
  }
}
```

## 문제 해결

### 시간 함수 실패 시
- 버튼이 자동으로 활성화됨 (fail-open)
- 노란색 경고 토스트 표시
- 콘솔에 상세한 에러 정보 출력

### 시간이 맞지 않는 경우
1. 서버 시간과 로컬 시간 비교
2. 환경변수 설정 확인
3. URL 파라미터 우선순위 확인

### 교사 키가 작동하지 않는 경우
1. URL에 `?key=teacher_key` 추가
2. 세션 스토리지에 키 저장 확인
3. 교사 키 우선순위 로직 확인

## 보안 고려사항

- URL 파라미터는 테스트용으로만 사용
- 프로덕션에서는 환경변수 사용 권장
- 교사 키는 안전하게 관리
- 시간 함수는 서버에서만 실행

## 🎯 실제 사용 예시

### 수업 시간에 맞춘 설정

#### **월요일 오전 9시 수업**
```bash
# 일요일 밤에 설정
RELEASE_TIME_UTC=2025-01-15 09:00 KST

# 또는 간단히
RELEASE_TIME_UTC=2025-01-15 09:00
```

#### **금요일 오후 2시 수업**
```bash
# 금요일 오전에 설정
RELEASE_TIME_UTC=2025-01-17 14:00 KST
```

### 업무시간만 활성화

#### **평일 오전 9시~오후 5시만 활성화**
```bash
# 월요일부터 금요일까지
RELEASE_TIME_UTC=2025-01-13 09:00,2025-01-17 17:00 KST
```

#### **특정 날짜의 업무시간만**
```bash
# 1월 15일 오전 9시~오후 5시만
RELEASE_TIME_UTC=2025-01-15 09:00,2025-01-15 17:00 KST
```

### 주말 비활성화

#### **금요일 오후부터 월요일 오전까지 비활성화**
```bash
# 금요일 오후 6시부터 월요일 오전 8시까지 비활성화
RELEASE_TIME_UTC=2025-01-17 18:00,2025-01-20 08:00 KST
```

### 즉시 테스트

#### **URL로 즉시 테스트**
```
# 한국 시간 오전 9시로 테스트
?release_time=2025-01-15 09:00 KST

# 한국 시간 범위로 테스트
?release_time=2025-01-15 09:00,2025-01-15 17:00 KST

# 즉시 활성화
?release_time=+0h
```

## 마이그레이션 가이드

기존 하드코딩된 시간에서 환경변수 기반으로 변경:

1. **기존**: `const SHOW_UTC = Date.parse('2025-10-12T15:00:00Z');`
2. **신규**: 환경변수 `RELEASE_TIME_UTC` 설정
3. **테스트**: URL 파라미터로 즉시 테스트 가능
4. **디버깅**: `DEBUG_TIME=true`로 상세 정보 확인
