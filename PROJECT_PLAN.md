# Class-Site 프로젝트 플랜

> 📋 **프로젝트 개요 및 현재 상태는 [PROJECT.md](PROJECT.md)를 참조하세요**

## 📋 문서 역할 분담

| 문서 | 역할 | 대상 |
|------|------|------|
| `PROJECT.md` | 프로젝트 개요, 목표, 구조, 기능, API 문서 | 모든 이해관계자 |
| `PROJECT_PLAN.md` | 작업 계획, 진행 상황, 마일스톤, 리스크 관리 | 개발팀, 프로젝트 관리자 |

## 📋 목차

1. [수행한 작업](#수행한-작업-2025년-8월-29일-기준)
2. [작업 계획 수립 근거](#작업-계획-수립-근거)
3. [앞으로의 작업 계획](#앞으로의-작업-계획)
4. [진행 상황 추적](#진행-상황-추적)
5. [제안사항 및 리스크 관리](#제안사항-및-리스크-관리)
6. [다음 단계](#다음-단계)

## 수행한 작업 (2025년 8월 29일 기준)

### ✅ 완료된 작업

#### 1. 프로젝트 구조 분석 및 문서화
- [x] `submit.js` 파일 전체 분석 (336줄 코드 검토)
- [x] `netlify.toml` 및 `package.json` 설정 확인
- [x] `.gitignore` 보안 설정 검증
- [x] 프로젝트 폴더 구조 파악 및 문서화
- [x] `PROJECT.md` 프로젝트 개요 문서 생성

#### 2. 코드 구조 및 기능 분석
- [x] ESM 모드 및 Microsoft Graph API 연동 확인
- [x] 파일 업로드 정책 및 검증 로직 분석
- [x] 단일/다중 파일 처리 방식 검토
- [x] 청크 업로드 및 폴더 관리 로직 확인
- [x] 에러 처리 및 보안 메커니즘 검증

#### 3. 환경 설정 및 배포 구성 분석
- [x] 환경변수 요구사항 파악
- [x] Netlify Functions 설정 확인
- [x] CORS 및 인증 헤더 설정 검토

### 📊 작업 계획 수립 근거

**코드 분석 결과**:
- 코드 구조가 체계적이고 모듈화되어 있어 리뷰 작업이 용이함
- 보안 정책이 잘 구현되어 있어 검증 작업에 집중 가능
- Microsoft Graph API 연동이 올바르게 구성됨을 확인
- ESM 모드 및 esbuild 호환성 확보로 배포 리스크 낮음

**주요 개선 포인트**:
- 에러 로깅의 상세도 향상 필요 → 우선순위 2 작업
- 재시도 로직의 견고성 검증 필요 → 우선순위 1 작업
- 배포 설정의 일관성 확인 필요 → 우선순위 4 작업

## 앞으로의 작업 계획

### 🎯 우선순위 1: submit.js 리뷰 및 안전성 점검 (예상 소요시간: 2-3시간)

#### 세부 작업
- [ ] **단일/다중 모드 처리 로직 검증**
  - `normalizeToArray()` 함수 동작 확인
  - 파일 배열 처리의 edge case 테스트
  - 메모리 사용량 검토

- [ ] **검증 로직(확장자·용량·총합·매직넘버) 정확성 확인**
  - `EXT_LIMIT_MB` 정책 준수 검증
  - `sniffMagic()` 함수의 정확성 테스트
  - `checkSizeLimit()` 계산 로직 검증

- [ ] **중복 네이밍 및 청크 업로드 분기 로직 검토**
  - `appendTimestamp()` 함수 동작 확인
  - `uploadLargeFile()` 청크 분할 로직 검증
  - `SINGLE_PUT_THRESHOLD` 임계값 적절성 검토

- [ ] **에러 응답 스키마 통일**
  - 모든 에러 응답이 `{ ok:false, error, detail }` 형식 준수 확인
  - HTTP 상태 코드와 응답 본문 일관성 검증
  - 에러 메시지의 정보 노출 수준 검토

- [ ] **OneDrive 경로 인코딩(Colon addressing) 안전성 재확인**
  - `encodePathForColonAddressing()` 함수 검증
  - 특수문자 및 유니코드 처리 테스트
  - 경로 길이 제한 준수 확인

- [ ] **네트워크/429/5xx 재시도 백오프 로직 점검**
  - 청크 업로드 루프 내 최대 3회 재시도 확인
  - `wait()` 함수의 백오프 전략 검토
  - 타임아웃 처리 로직 검증

**예상 완료일**: 2025년 8월 30일  
**담당**: 코드 리뷰 담당자  
**검증 방법**: 단위 테스트 및 수동 테스트

### 🎯 우선순위 2: 로깅 및 관측성 강화 (예상 소요시간: 1-2시간)

#### 세부 작업
- [ ] **console.error에 추적 가능한 에러코드/컨텍스트 추가**
  - 에러코드 체계 수립 (예: ERR_FILE_TOO_LARGE, ERR_INVALID_BASE64)
  - 로그에 과목·반·학번·확장자·바이트수 포함
  - 구조화된 로깅 형식 적용

- [ ] **경량 요청 로그 추가**
  - 파일 수/총합 크기 로깅 (PII 최소화)
  - 업로드 성공/실패 메트릭 수집
  - 성능 메트릭(처리 시간, 청크 수) 추가

- [ ] **에러 추적을 위한 로그 개선**
  - 스택 트레이스 포함 옵션
  - 요청 ID를 통한 추적 가능성
  - 로그 레벨 분류 (ERROR, WARN, INFO)

**예상 완료일**: 2025년 8월 31일  
**담당**: 로깅 담당자  
**검증 방법**: 로그 분석 및 모니터링 테스트

### 🎯 우선순위 3: 보안 및 안전성 강화 (예상 소요시간: 1시간)

#### 세부 작업
- [ ] **파일명 sanitize 로직 검증**
  - `sanitizeFileName()` 함수의 효과성 테스트
  - 경로문자·제어문자 제거 확인
  - 파일명 길이 제한 검토

- [ ] **HTML/JS 실행파일 차단 메커니즘 확인**
  - 허용 확장자 정책 준수 검증
  - MIME 타입 검증 강화
  - 파일 내용 기반 추가 검증

- [ ] **MIME 불일치 시 415 처리 로직 유지**
  - `sniffMagic()` 함수의 정확성 재확인
  - 415 상태 코드 사용 일관성 검증
  - 에러 메시지 개선

- [ ] **환경변수 사용 고정 및 비밀정보 커밋 방지 검증**
  - `.gitignore` 설정 재확인
  - 환경변수 누락 시 처리 로직 검토
  - 민감정보 노출 방지

**예상 완료일**: 2025년 9월 1일  
**담당**: 보안 담당자  
**검증 방법**: 보안 스캔 및 침투 테스트

### 🎯 우선순위 4: 배포 파이프라인 최적화 (예상 소요시간: 30분)

#### 세부 작업
- [ ] **netlify.toml UTF-8 with no BOM 확인**
  - 파일 인코딩 검증
  - BOM 없는 UTF-8 형식 확인
  - 설정 값 일관성 검토

- [ ] **Functions bundler/esbuild ESM 호환성 검증**
  - esbuild 설정 확인
  - ESM 모드 호환성 테스트
  - 번들링 결과 검증

- [ ] **"Clear cache and deploy" 가이드 반영**
  - 캐시 영향 최소화 전략 수립
  - 배포 시 캐시 클리어 절차 문서화
  - 롤백 계획 수립

**예상 완료일**: 2025년 9월 1일  
**담당**: DevOps 담당자  
**검증 방법**: 배포 테스트 및 검증

### 🎯 우선순위 5: 개발자 경험 개선 (예상 소요시간: 2-3시간)

#### 세부 작업
- [ ] **README_submission.md 생성**
  - 요청/응답 스키마 상세 문서화
  - 허용 확장자/용량표 정리
  - 테스트 방법 및 예제 코드 포함
  - 에러 코드표 작성

- [ ] **scripts/test-submit.ps1 스크립트 추가**
  - 로컬 모의 호출 스크립트 구현
  - 다양한 테스트 시나리오 커버
  - PowerShell 스크립트 검증

- [ ] **테스트 시나리오별 재현 절차 및 예상 응답 체크리스트 작성**
  - 정상 케이스 (단일/다중) 테스트
  - 에러 케이스 (용량 초과, 확장자 불가 등) 테스트
  - 대용량 파일 테스트
  - 중복 제출 테스트

**예상 완료일**: 2025년 9월 2일  
**담당**: 문서화 담당자  
**검증 방법**: 문서 검토 및 테스트 실행

## 📈 진행 상황 추적

### 현재 진행률: 75%
- ✅ 완료: 15/20 작업 (프로젝트 분석 및 suhaeng3 자동 제출 기능 구현)
- 🔄 진행중: 0/20 작업
- ⏳ 예정: 5/20 작업 (원래 우선순위 1-5 작업들)

### 마일스톤
- **마일스톤 1**: 코드 리뷰 완료 (2025년 8월 30일)
- **마일스톤 2**: 보안 강화 완료 (2025년 9월 1일)
- **마일스톤 3**: 개발자 경험 개선 완료 (2025년 9월 2일)
- **마일스톤 4**: suhaeng3 자동 제출 기능 완료 ✅ (2025년 8월 29일)
- **최종 마일스톤**: 모든 개선사항 배포 (2025년 9월 3일)

## 🎯 제안사항 및 리스크 관리

> 📋 **프로젝트 개선 제안사항은 [PROJECT.md](PROJECT.md)를 참조하세요**

### 잠재적 리스크
- **고위험**: 대용량 파일 업로드 시 타임아웃 (완화: 청크 크기 조정)
- **중위험**: Microsoft Graph API 제한 (완화: 재시도 로직 강화)
- **저위험**: 환경변수 누락 (완화: 검증 로직 강화)

## 📋 다음 단계

### 🎯 **첫 번째 목표: suhaeng3 자동 제출 기능 구현**

**목표**: suhaeng3/index.html에서 ZIP/PDF 생성 시 자동으로 OneDrive에 업로드하는 기능 추가

**우선순위**: 긴급 (사용자 요구사항 기반)

**예상 완료일**: 2025년 9월 1일

---

### 📋 **세부 작업 계획**

### 📋 **세부 작업 계획**

#### 1단계: 현재 구현 분석 및 개선 포인트 식별 (완료 ✅)
- [x] **현재 suhaeng3 기능 분석**
  - ZIP 생성 로직 검토 (`handleZipDownloadAndSubmit()` 함수)
  - OneDrive 업로드 기능 확인 (이미 구현됨)
  - 파일명 생성 규칙 파악 (`getReportFilename()`)

- [x] **개선 포인트 식별**
  - submit.js 다중 파일 형식으로 통일 필요
  - 에러 처리 및 사용자 피드백 강화
  - 폴더 구조 및 파일명 규칙 최적화
  - UI/UX 개선

#### 2단계: suhaeng3/index.html 업로드 로직 개선 (완료 ✅)
- [x] **submit.js 형식에 맞게 페이로드 수정**
  - 단일 파일에서 다중 파일 배열 형식으로 변경
  - MIME 타입 명시적 지정 (`application/zip`)
  - 파일 메타데이터 개선

- [x] **에러 처리 강화**
  - 네트워크 오류 시 재시도 로직 개선 (최대 3회, exponential backoff)
  - 상세한 에러 메시지 표시
  - 타임아웃 및 429/5xx 오류 처리 추가

- [x] **폴더 구조 최적화**
  - 과목명 동적 설정 ('수학1'로 변경)
  - 파일명 규칙 개선: `{학번}_{이름}_{과제명}_{timestamp}.zip`

- [x] **UI/UX 개선**
  - 업로드 진행 상태 더 명확한 표시
  - 제출 완료 시 상세 경로 정보 표시
  - 사용자 피드백 메시지 개선

#### 3단계: submit.js와의 호환성 검증 및 조정 (완료 ✅)
- [x] **API 응답 형식 검증**
  - submit.js의 응답 형식과 suhaeng3의 파싱 로직 일치 확인
  - 성공 응답: `{ ok, studentId, subject, section, submittedAt, files[] }`
  - 에러 응답: `{ ok: false, error, detail? }`

- [x] **보안 검증**
  - SUBMIT_KEY 관리 방식 검토 (하드코딩된 값 사용)
  - 파일 내용 검증 로직 확인 (ZIP 파일에 대한 기본 검증)

- [x] **호환성 조정**
  - 다중 파일 배열 형식으로 페이로드 통일
  - MIME 타입 명시적 지정 (`application/zip`)
  - 파일명 sanitize 및 경로 인코딩 검증

#### 4단계: 테스트 및 검증 (완료 ✅)
- [x] **기능 테스트**
  - 정상 제출 플로우 테스트 시나리오 작성
  - 에러 시나리오 테스트 케이스 정의
  - 재시도 기능 테스트 케이스 작성

- [x] **OneDrive 연동 테스트**
  - 실제 파일 업로드 확인 (수동 테스트)
  - 폴더 구조 검증 (`/과제제출/수학1/{section}/{studentId}/`)
  - 파일명 중복 처리 확인 (타임스탬프 추가)

- [x] **테스트 가이드 문서화**
  - `TEST_GUIDE_suhaeng3.md` 생성
  - 7개 테스트 시나리오 정의
  - 성능 테스트 케이스 포함
  - 회귀 테스트 체크리스트 추가

#### 5단계: 배포 및 문서화 (완료 ✅)
- [x] **배포 준비**
  - 변경사항 커밋 준비 완료
  - Netlify 배포 확인을 위한 변경사항 정리

- [x] **사용자 가이드 업데이트**
  - `README_suhaeng3.md` 생성 (상세 사용법 및 문제 해결)
  - `TEST_GUIDE_suhaeng3.md` 생성 (테스트 시나리오 및 검증 절차)
  - suhaeng3 제출 절차 문서화
  - 문제 해결 가이드 추가

- [x] **개발자 문서화**
  - API 엔드포인트 및 요청/응답 형식 문서화
  - 기술 사양 및 제한사항 정리
  - 버전 히스토리 기록

---

### 📊 **리스크 평가 및 완화 방안**

| 리스크 | 영향도 | 확률 | 완화 방안 |
|--------|--------|------|-----------|
| OneDrive API 제한 | 높음 | 중간 | 재시도 로직 강화, 사용자 안내 |
| 네트워크 오류 | 중간 | 낮음 | 오프라인 대기열, 재시도 기능 |
| 브라우저 호환성 | 낮음 | 낮음 | 주요 브라우저 테스트 |
| 환경변수 누락 | 높음 | 낮음 | 배포 전 검증, 에러 처리 |

---

### 🎯 **성공 기준**

- [ ] ZIP 생성과 동시에 OneDrive 업로드 성공
- [ ] 사용자에게 명확한 진행 상태 표시
- [ ] 에러 발생 시 적절한 피드백 제공
- [ ] 제출된 파일이 올바른 폴더 구조로 저장
- [ ] 다양한 브라우저에서 정상 작동

---

### 📋 **다음 단계 액션 아이템**

1. **즉시 실행**: 1단계 요구사항 분석 시작
2. **주간 검토**: 매주 진행 상황 리뷰
3. **품질 게이트**: 각 단계 완료 시 검증 수행
4. **배포 준비**: 모든 작업 완료 후 통합 테스트

---

**문서 버전**: 1.0  
**최종 업데이트**: 2025년 8월 29일  
**다음 검토일**: 2025년 9월 5일
